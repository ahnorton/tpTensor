(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    558521,      15375]
NotebookOptionsPosition[    517815,      14241]
NotebookOutlinePosition[    518365,      14264]
CellTagsIndexPosition[    518277,      14259]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Part 2   ---   Gradient, series, and metric", "Section",
 CellChangeTimes->{{3.615259800256303*^9, 3.615259803264525*^9}, {
  3.615259893664855*^9, 3.615259894576767*^9}, {3.6552451606982813`*^9, 
  3.655245194745967*^9}}],

Cell[CellGroupData[{

Cell["Unused code:  factorNumberOfSlot,  vectorSlotQ", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
   3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
   3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
   3.467126548768611*^9, 3.467126560140989*^9}, {3.467126913123894*^9, 
   3.46712691617785*^9}, {3.467198505051484*^9, 3.467198515544077*^9}, {
   3.467198638607828*^9, 3.467198678182335*^9}, {3.46728810114199*^9, 
   3.467288103412177*^9}, {3.46729806668237*^9, 3.467298070130729*^9}, {
   3.467366220056041*^9, 3.467366231775698*^9}, {3.477593909994389*^9, 
   3.477593937634802*^9}, {3.477774233553933*^9, 3.47777427363809*^9}, 
   3.477774306207101*^9, {3.478525276227503*^9, 3.478525489860358*^9}, {
   3.478543633707505*^9, 3.478543650738982*^9}, {3.478806640101739*^9, 
   3.478806645027829*^9}, {3.480312710700892*^9, 3.480312716892429*^9}, 
   3.480335517973274*^9, 3.6142914573220654`*^9, {3.6142955122421303`*^9, 
   3.614295557225572*^9}}],

Cell["\<\
This code was written  06/06/2014  to speed things up because contracting on \
tensor products with > 8 factors was very slow.  
However, the problem was not with the contraction, it was the conditional \
rule checking for tensor products of SeriesData.
That probem has been fixed. This new code is not being used because it is \
actually sightly slower. I suppose it might be faster 
if the tensor products had 100s of factors, so I\[CloseCurlyQuote]ve left it \
here just in case it is wanted some day (it works -- just make the 
cells initialization cells, no other changes).

This returns True if slot j of the tensor product  c  is known to be the slot \
of a vector (deg=1) factor of  c. It returns False otherwise,\
\>", "Text",
 CellChangeTimes->{{3.478521348524732*^9, 3.478521367997245*^9}, {
   3.478521995402616*^9, 3.478522005330361*^9}, {3.478522082794157*^9, 
   3.478522380056022*^9}, 3.478522415777293*^9, {3.478522542569283*^9, 
   3.478522547072749*^9}, {3.478522672464452*^9, 3.47852282811114*^9}, {
   3.478522866720887*^9, 3.478522910998042*^9}, {3.478523013006232*^9, 
   3.478523063845325*^9}, {3.478523294797873*^9, 3.478523315180198*^9}, {
   3.478523421036623*^9, 3.478523455373287*^9}, {3.478523509195832*^9, 
   3.478523578355614*^9}, {3.478523821778841*^9, 3.478524070826569*^9}, {
   3.478524122176394*^9, 3.478524185184386*^9}, {3.478524340830039*^9, 
   3.478524400607762*^9}, {3.478524843318779*^9, 3.478525228555697*^9}, {
   3.478525654133307*^9, 3.47852582850393*^9}, {3.47852588911241*^9, 
   3.47852622600454*^9}, {3.478526677795962*^9, 3.478526776484335*^9}, {
   3.478526889750424*^9, 3.478526949794981*^9}, {3.47852727452154*^9, 
   3.4785272751774*^9}, {3.478527306713869*^9, 3.47852733310468*^9}, {
   3.478527406985081*^9, 3.478527413939544*^9}, {3.478528120382391*^9, 
   3.47852812958848*^9}, {3.478528192756685*^9, 3.478528220109628*^9}, {
   3.478529193768579*^9, 3.478529219839461*^9}, {3.478529292912798*^9, 
   3.478529294543033*^9}, {3.478529493455744*^9, 3.47852950568608*^9}, {
   3.478532420268942*^9, 3.478532480480057*^9}, 3.478703460819037*^9, {
   3.478703667748659*^9, 3.4787036791852*^9}, {3.478703842688146*^9, 
   3.478703858827889*^9}, {3.478704637672439*^9, 3.478704863019877*^9}, {
   3.478704899735583*^9, 3.478704924252704*^9}, {3.478705143616218*^9, 
   3.478705179720568*^9}, {3.47877489559973*^9, 3.478774907484824*^9}, {
   3.478781148750663*^9, 3.478781217983201*^9}, 3.478782148012889*^9, {
   3.478799110671136*^9, 3.478799151557989*^9}, {3.6110226285621653`*^9, 
   3.611022670866194*^9}, {3.611022713362474*^9, 3.611022888067275*^9}, {
   3.6110238566487513`*^9, 3.611023869351859*^9}, {3.611023900952121*^9, 
   3.611023903432049*^9}, {3.6110369646833963`*^9, 3.611036977069903*^9}, {
   3.611037274187324*^9, 3.6110376546836348`*^9}, {3.614295582197983*^9, 
   3.614295588929377*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"vectorSlotQ", "[", 
   RowBox[{"c_", ",", "j_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"d", ",", "s", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"d", "=", 
      RowBox[{"deg", "[", 
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "c"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{"s", "<", "j"}], ",", 
       RowBox[{
        RowBox[{"i", "=", 
         RowBox[{"i", "+", "1"}]}], ";", 
        RowBox[{"s", "=", 
         RowBox[{"s", "+", 
          RowBox[{"d", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"d", "[", 
       RowBox[{"[", "i", "]"}], "]"}], "===", "1"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.611018632797689*^9, 3.611018647331114*^9}, {
  3.6110186793635473`*^9, 3.611018727590193*^9}, {3.611018762407055*^9, 
  3.611018771320829*^9}, {3.611018945275682*^9, 3.611018952522563*^9}, {
  3.6110191063643*^9, 3.611019296409214*^9}, {3.611019381929661*^9, 
  3.611019440173067*^9}, {3.611019503267693*^9, 3.611019512219071*^9}, {
  3.611025695832708*^9, 3.611025698932868*^9}}],

Cell["\<\
This returns the factor number (1, 2, 3, etc. for 1st, 2nd, 3rd factor) that \
contains slot  j  in the tensor product  c,\
\>", "Text",
 CellChangeTimes->{{3.478521348524732*^9, 3.478521367997245*^9}, {
   3.478521995402616*^9, 3.478522005330361*^9}, {3.478522082794157*^9, 
   3.478522380056022*^9}, 3.478522415777293*^9, {3.478522542569283*^9, 
   3.478522547072749*^9}, {3.478522672464452*^9, 3.47852282811114*^9}, {
   3.478522866720887*^9, 3.478522910998042*^9}, {3.478523013006232*^9, 
   3.478523063845325*^9}, {3.478523294797873*^9, 3.478523315180198*^9}, {
   3.478523421036623*^9, 3.478523455373287*^9}, {3.478523509195832*^9, 
   3.478523578355614*^9}, {3.478523821778841*^9, 3.478524070826569*^9}, {
   3.478524122176394*^9, 3.478524185184386*^9}, {3.478524340830039*^9, 
   3.478524400607762*^9}, {3.478524843318779*^9, 3.478525228555697*^9}, {
   3.478525654133307*^9, 3.47852582850393*^9}, {3.47852588911241*^9, 
   3.47852622600454*^9}, {3.478526677795962*^9, 3.478526776484335*^9}, {
   3.478526889750424*^9, 3.478526949794981*^9}, {3.47852727452154*^9, 
   3.4785272751774*^9}, {3.478527306713869*^9, 3.47852733310468*^9}, {
   3.478527406985081*^9, 3.478527413939544*^9}, {3.478528120382391*^9, 
   3.47852812958848*^9}, {3.478528192756685*^9, 3.478528220109628*^9}, {
   3.478529193768579*^9, 3.478529219839461*^9}, {3.478529292912798*^9, 
   3.478529294543033*^9}, {3.478529493455744*^9, 3.47852950568608*^9}, {
   3.478532420268942*^9, 3.478532480480057*^9}, 3.478703460819037*^9, {
   3.478703667748659*^9, 3.4787036791852*^9}, {3.478703842688146*^9, 
   3.478703858827889*^9}, {3.478704637672439*^9, 3.478704863019877*^9}, {
   3.478704899735583*^9, 3.478704924252704*^9}, {3.478705143616218*^9, 
   3.478705179720568*^9}, {3.47877489559973*^9, 3.478774907484824*^9}, {
   3.478781148750663*^9, 3.478781217983201*^9}, 3.478782148012889*^9, {
   3.478799110671136*^9, 3.478799151557989*^9}, {3.6110226285621653`*^9, 
   3.611022670866194*^9}, {3.611022713362474*^9, 3.611022888067275*^9}, {
   3.6110238566487513`*^9, 3.611023869351859*^9}, {3.611023900952121*^9, 
   3.611023903432049*^9}, {3.611025639457162*^9, 3.611025678783999*^9}, 
   3.611025718656413*^9, {3.611037940702173*^9, 3.611038104606391*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"factorNumberOfSlot", "[", 
   RowBox[{"c_", ",", "j_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"d", ",", "s", ",", "i"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"d", "=", 
      RowBox[{"deg", "[", 
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "c"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{"s", "<", "j"}], ",", 
       RowBox[{
        RowBox[{"i", "=", 
         RowBox[{"i", "+", "1"}]}], ";", 
        RowBox[{"s", "=", 
         RowBox[{"s", "+", 
          RowBox[{"d", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "i"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.611025567093728*^9, 3.61102563061224*^9}, {
  3.611025685412732*^9, 3.611025712841394*^9}, {3.611025900374522*^9, 
  3.611025900742625*^9}, {3.611026420790648*^9, 3.611026422614756*^9}}],

Cell["\<\
If the contraction is on a pair of vector factors within c, then contract the \
vectors and remove them from c,\
\>", "Text",
 CellChangeTimes->{{3.611037702129105*^9, 3.611037781309807*^9}, {
  3.611037821901038*^9, 3.61103787022092*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", "c_CircleTimes", "\[RightAngleBracket]"}], 
    
    RowBox[{"a_", ",", "b_"}]], "/;", 
   RowBox[{
    RowBox[{"a", "<", "b"}], "&&", " ", 
    RowBox[{"Length", "[", "c", "]"}], "&&", 
    RowBox[{"vectorSlotQ", "[", 
     RowBox[{"c", ",", "a"}], "]"}], "&&", 
    RowBox[{"vectorSlotQ", "[", 
     RowBox[{"c", ",", "b"}], "]"}]}]}], "^:=", 
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"c", "[", 
      RowBox[{"[", 
       RowBox[{"factorNumberOfSlot", "[", 
        RowBox[{"c", ",", "a"}], "]"}], "]"}], "]"}], ",", 
     RowBox[{"c", "[", 
      RowBox[{"[", 
       RowBox[{"factorNumberOfSlot", "[", 
        RowBox[{"c", ",", "a"}], "]"}], "]"}], "]"}]}], 
    "\[RightAngleBracket]"}], "  ", 
   RowBox[{"Drop", "[", 
    RowBox[{
     RowBox[{"Drop", "[", 
      RowBox[{"c", ",", 
       RowBox[{"{", 
        RowBox[{"factorNumberOfSlot", "[", 
         RowBox[{"c", ",", "b"}], "]"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"factorNumberOfSlot", "[", 
       RowBox[{"c", ",", "a"}], "]"}], "}"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.611019586794856*^9, 3.6110196452893267`*^9}, {
   3.611019778908613*^9, 3.611019793788453*^9}, {3.611019830140751*^9, 
   3.611019894559907*^9}, {3.611019951090851*^9, 3.611020029099022*^9}, 
   3.611023244649988*^9, {3.611024051953269*^9, 3.6110240778399467`*^9}, {
   3.611026118890675*^9, 3.61102614267975*^9}, {3.611036331211343*^9, 
   3.6110363514453363`*^9}, {3.611036434147696*^9, 3.6110365159206944`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["A faster Simplify[ ] :   SimplifyTensor[X] ", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119352821146*^9}, {
   3.467370985602835*^9, 3.46737099050696*^9}, {3.478969712456913*^9, 
   3.47896975380715*^9}, {3.479394610229672*^9, 3.479394650876189*^9}, {
   3.479402628163701*^9, 3.479402643661632*^9}, 3.6554109746175137`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"?", "SimplifyTensor"}]], "Input",
 CellChangeTimes->{{3.47983253941774*^9, 3.479832546675367*^9}}],

Cell[BoxData[
 StyleBox["\<\"?\[VeryThinSpace]SimplifyTensor\\n\\nSimplifyTensor [ X ]   is \
a better way to apply  Simplify [ ]  to tensor expressions. It is very much \
faster.\\n\\nIf  X  is a power-series (an expression with head SeriesData) \
then  SimplifyTensor[ ]  is applied to each coefficient in the series.\\nIf  \
deg [ X ]  =  0 , then  SimplifyTensor [ X ]  is eqivalent to  Simplify [ X ] \
.\\n\\nAdditional information:\\n\\nSimplifyTensor [ X ]   breaks up the \
problem of simplifying  X  into smaller pieces by separately applying  \
Simplify [ ]  to each \\n'co-strut'  (defined below) of the tensor expression \
 X.  Tensor expressions for which  Simplify [ ]  will totally fail on because \
the \\nexpression  X  is too large, will sometimes simplify in just a few \
seconds.  \\n\\nA co-strut of a tensor \
\!\(\*\\nStyleBox[\\\"expression\\\",\\nFontSlant->\\\"Italic\\\"]\)  X  is a \
bit like a component --- it is the coefficient of a 'strut'.  The struts of  \
X  are the\\nelementary tensor products that appear in the expanded version \
of  X.  For example, the struts of the tensor expression\\nX  =  (3 + y) \
\[Eta] \[CircleTimes] a + 2 f (x) b \[CircleTimes] b \[CircleTimes] c ,  are  \
 { \[Eta] \[CircleTimes] a ,  b \[CircleTimes] b \[CircleTimes] c } ,  and \
the co-struts are  { (3 + y) , 2 f (x) } .\\n\\nLet V be the tensor-product \
vector space where X lives. Then the struts of X may or may not span the \
space V, and they may \\nor may not be linearly independent as elements of V. \
 Nevertheless, the only way that the expression  X  can simplify (without \
\\nintroducing additional relations) is if the co-struts of  X  individually \
simplify.  So it is better to apply Simplify [ ]  to the co-struts \\nof  X  \
than to  X  as a whole.\\n\\nIf all the struts of  X  are tensor products of \
basis vectors, then the co-struts of the expression  X  will include all of \
the non-zero \\ncomponents of the tensor  X  in that basis (and possibly also \
some components that simplify to zero).\\n\\nAll of the routines discussed \
here can be used with Clifford expressions (sums of terms with mixed degree). \
 \\n\\n[The 'struts / co-struts' nomenclature is something I made up. Maybe \
there is something already established ? - ahn]  \\n\\nSee also:  struts [ X \
] ,  costruts [ X ] ,  strutPair [ X ]\"\>", "MSG"]], "Print", "PrintUsage",
 CellChangeTimes->{3.614391271044022*^9},
 CellTags->"Info3614427270-5255022"]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
struts[ ]     -----    original defn,  working.   Replaced  15/10/2011  for \
compatibility with Clifford package.   No initialization cells here.\
\>", "Subsubsection",
 CellChangeTimes->{{3.52764638257008*^9, 3.527646486488145*^9}}],

Cell["This  is not a user function...", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479401472002525*^9, 3.479401485343273*^9}, 
   3.479832517403714*^9}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "struts0", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts0", "[", "expr_Plus", "]"}], ":=", 
  RowBox[{"Union", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Map", "[", 
     RowBox[{"struts0", ",", 
      RowBox[{"Apply", "[", 
       RowBox[{"List", ",", "expr"}], "]"}]}], "]"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts0", "[", 
   RowBox[{"c_", " ", "expr_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"struts0", "[", "expr", "]"}], "/;", 
   RowBox[{
    RowBox[{"deg", "[", "c", "]"}], "\[Equal]", 
    "0"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts0", "[", "expr_CircleTimes", "]"}], ":=", "expr"}]}], "Input",\

 CellChangeTimes->{{3.479399851064685*^9, 3.479399885356187*^9}, {
   3.479400205794046*^9, 3.479400215963167*^9}, 3.479400329535476*^9, 
   3.47972198687444*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"struts0", "[", 
  RowBox[{
   RowBox[{"3", " ", 
    RowBox[{"a1", "\[CircleTimes]", "b1", " ", "\[CircleTimes]", "c1"}]}], 
   "+", " ", 
   RowBox[{"4", " ", 
    RowBox[{"c2", "\[CircleTimes]", "b1"}]}], " ", "+", " ", 
   RowBox[{"5", " ", "b3"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.479398937672015*^9, 3.479399053739008*^9}, 
   3.479399860291601*^9, {3.479400339934007*^9, 3.479400341512233*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"c2", "\[CircleTimes]", "b1"}], ",", 
   RowBox[{"a1", "\[CircleTimes]", "b1", "\[CircleTimes]", "c1"}], ",", 
   RowBox[{"struts0", "[", "b3", "]"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.479399055605478*^9, {3.479399864184676*^9, 3.479399893683456*^9}, {
   3.479400334088946*^9, 3.479400343071827*^9}, 3.479454091478112*^9, 
   3.479832775266256*^9, 3.479919159281701*^9, 3.480312931470042*^9, 
   3.480317274925847*^9, 3.480328333177413*^9, 3.480328586824921*^9, 
   3.48033347466149*^9, 3.480333970171782*^9, 3.48033470079783*^9, 
   3.480661310716619*^9, 3.480661695233296*^9, 3.480662408693177*^9, 
   3.518081130544454*^9, 3.6137168363269787`*^9, 3.6137185092208757`*^9, 
   3.613718692252035*^9}]
}, Open  ]],

Cell["\<\
Now deal with struts that have no CircleTimes[ ]   (like  b3 in the above \
example)   by applying  struts0[ ]  twice and making it idempotent and \
listable,\
\>", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479834915762649*^9, 3.479834916303495*^9}, {
   3.480768616487534*^9, 3.480768641846802*^9}, 3.480768757882673*^9}],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"struts0", ",", "Listable"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts0", "[", "expr_struts0", "]"}], ":=", 
  RowBox[{"First", "[", "expr", "]"}]}]}], "Input",
 CellChangeTimes->{{3.479400437825051*^9, 3.479400440828382*^9}, {
  3.479402522517516*^9, 3.479402524491043*^9}}],

Cell["\<\
If there is just a single strut, make sure it is returned as a single element \
list...\
\>", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
  3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
  3.479400381847396*^9}, {3.479834915762649*^9, 3.479834916303495*^9}, {
  3.480768429789364*^9, 3.480768502332599*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "struts", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts", "[", "expr_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ans", ",", "d"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"d", "=", 
      RowBox[{"deg", "[", "expr", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"IntegerQ", "[", "d", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<Un-declared field or constant (non-integer tensor degree):  \n\
struts[X_] called with deg[X] = \>\"", ",", "d", ",", 
          "\"\<\nFor field declaration, see:  ?NewField, ?NewConstant\>\""}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"d", "\[Equal]", "0"}], ",", 
       RowBox[{"{", "1", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ans", "=", 
         RowBox[{"struts0", "[", 
          RowBox[{"struts0", "[", "expr", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "ans", "]"}], "===", "List"}], ",", "ans", 
          ",", 
          RowBox[{"{", "ans", "}"}]}], "]"}]}]}], "]"}]}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.479400019868565*^9, 3.479400034774264*^9}, {
   3.47940008235393*^9, 3.479400094298324*^9}, 3.479400252458944*^9, {
   3.480767657983204*^9, 3.480767722647428*^9}, {3.4807678117623*^9, 
   3.480767813737629*^9}, {3.481893741969734*^9, 3.481893827420497*^9}, {
   3.48189393374766*^9, 3.481894126290685*^9}, {3.481894160130852*^9, 
   3.48189424120562*^9}, 3.481894293689923*^9, {3.481894366618201*^9, 
   3.481894368321437*^9}, {3.481894417659071*^9, 3.481894421785182*^9}, {
   3.481894598498503*^9, 3.481894820280403*^9}, {3.481894868743066*^9, 
   3.481894924447212*^9}, {3.48189495575987*^9, 3.481895094871174*^9}, {
   3.481895134280376*^9, 3.481895142671037*^9}, {3.481895182894965*^9, 
   3.48189519803551*^9}, {3.481895237743282*^9, 3.481895244934694*^9}, {
   3.481906598858588*^9, 3.481906787074156*^9}, {3.481907025586663*^9, 
   3.481907027458092*^9}}],

Cell["Now we get the b3 without  struts0[ ] wrapper...", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
  3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
  3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"struts", "[", 
  RowBox[{
   RowBox[{"3", " ", 
    RowBox[{"a1", "\[CircleTimes]", "b1", " ", "\[CircleTimes]", "c1"}]}], 
   "+", " ", 
   RowBox[{"4", " ", 
    RowBox[{"c2", "\[CircleTimes]", "b1"}]}], " ", "+", " ", 
   RowBox[{"5", " ", "b3"}]}], "]"}]], "Input",
 CellChangeTimes->{3.479400352566396*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Un-declared field or constant (non-integer tensor degree):  \
\\nstruts[X_] called with deg[X] = \"\>", "\[InvisibleSpace]", 
   "Indeterminate", 
   "\[InvisibleSpace]", "\<\"\\nFor field declaration, see:  ?NewField, \
?NewConstant\"\>"}],
  SequenceForm[
  "Un-declared field or constant (non-integer tensor degree):  \nstruts[X_] \
called with deg[X] = ", Indeterminate, 
   "\nFor field declaration, see:  ?NewField, ?NewConstant"],
  Editable->False]], "Print",
 CellChangeTimes->{3.5180811305929403`*^9, 3.613716836389183*^9, 
  3.613718509275425*^9, 3.61371869230907*^9}],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{
  3.479400354461056*^9, {3.479400457504843*^9, 3.479400474410589*^9}, 
   3.479400560957867*^9, 3.479400703949837*^9, 3.479454091651455*^9, 
   3.479832775403851*^9, 3.479919159424829*^9, 3.480312931595841*^9, 
   3.48031727499817*^9, 3.48032833325487*^9, 3.480328586978023*^9, 
   3.480333474844967*^9, 3.480333970246554*^9, 3.480334700912556*^9, 
   3.480661310727511*^9, 3.480661695291658*^9, 3.480662408764993*^9, 
   3.518081130598724*^9, 3.613716836392684*^9, 3.613718509279221*^9, 
   3.6137186923139353`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["struts[ ]    ", "Subsubsection",
 CellChangeTimes->{{3.52764638257008*^9, 3.527646486488145*^9}, 
   3.527646622377865*^9}],

Cell["\<\
Have got rid of the extra fn.  struts0[ ]   and limited use of  deg[  ] ,  so \
that struts[ ]   can be used on mixed degree Clifford expressions.
This works because  \[CircleTimes]   automatically distributes over +.  Ie.,  \
(a + b)\[CircleTimes] c  \[Rule]  a\[CircleTimes]c + b\[CircleTimes]c   \
before struts can ever be used. 
In the Clifford case a strut can not have mixed degree because then a factor \
in it would have to be a sum, but sums are expanded.\
\>", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479401472002525*^9, 3.479401485343273*^9}, 
   3.479832517403714*^9, {3.527646675705654*^9, 3.5276467852094307`*^9}, {
   3.527647081291662*^9, 3.527647103899762*^9}, {3.527647142492105*^9, 
   3.527647152076004*^9}, {3.527647202796248*^9, 3.527647351198969*^9}, {
   3.527647970418757*^9, 3.527647975490534*^9}, {3.527648733864395*^9, 
   3.527648761620357*^9}, {3.527649802813294*^9, 3.527649879179681*^9}, {
   3.5276512765837717`*^9, 3.52765130307517*^9}, {3.5276513716204243`*^9, 
   3.5276513823558817`*^9}, {3.5276524945725517`*^9, 
   3.5276525015777683`*^9}, {3.527656697709354*^9, 3.527656699036887*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "struts", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts", "[", "expr_Plus", "]"}], ":=", 
  RowBox[{"Union", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Map", "[", 
     RowBox[{"struts", ",", 
      RowBox[{"Apply", "[", 
       RowBox[{"List", ",", "expr"}], "]"}]}], "]"}], "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts", "[", 
   RowBox[{"c_", " ", "expr_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"struts", "[", "expr", "]"}], "/;", 
   RowBox[{
    RowBox[{"deg", "[", "c", "]"}], "\[Equal]", 
    "0"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts", "[", "expr_CircleTimes", "]"}], ":=", 
  RowBox[{"{", "expr", "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts", "[", "c_", "]"}], ":=", 
  RowBox[{
   RowBox[{"{", "1", "}"}], "/;", 
   RowBox[{
    RowBox[{"deg", "[", "c", "]"}], "\[Equal]", 
    "0"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"struts", "[", "c_", "]"}], ":=", 
  RowBox[{
   RowBox[{"{", "c", "}"}], "/;", 
   RowBox[{
    RowBox[{"IntegerQ", "[", 
     RowBox[{"deg", "[", "c", "]"}], "]"}], "&&", 
    RowBox[{
     RowBox[{"deg", "[", "c", "]"}], "\[NotEqual]", "0"}]}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479399851064685*^9, 3.479399885356187*^9}, {
   3.479400205794046*^9, 3.479400215963167*^9}, 3.479400329535476*^9, 
   3.47972198687444*^9, {3.527646773316293*^9, 3.527646776996127*^9}, {
   3.527647394841905*^9, 3.5276474745725403`*^9}, {3.527647716605056*^9, 
   3.527647762846023*^9}, {3.5276512422347193`*^9, 3.527651254161751*^9}, {
   3.52765649724754*^9, 3.527656509665463*^9}, {3.527656664517215*^9, 
   3.5276566764992657`*^9}}],

Cell["Added 10/04/2012,", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
   3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
   3.479402186494101*^9}, {3.484463200397948*^9, 3.484463369735323*^9}, {
   3.484463457877739*^9, 3.484463470013881*^9}, {3.527653227549862*^9, 
   3.527653317326805*^9}, {3.527653387262616*^9, 3.527653406509026*^9}, 
   3.527653975776517*^9, 3.542534361840562*^9, {3.543034772201591*^9, 
   3.5430347825051813`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"struts", "[", "c_List", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"struts", ",", "c"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.5430347239002247`*^9, 3.543034755454212*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"costruts", "[", "c_List", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"costruts", ",", "c"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.543035807987584*^9, 3.5430358132513123`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"strutPair", "[", "c_List", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"strutPair", ",", "c"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.543034851531839*^9, 3.543034866287169*^9}, {
  3.543034906783614*^9, 3.543034950127203*^9}}],

Cell["Note that   struts[0] = { 1 }.   ", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
   3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
   3.479402186494101*^9}, {3.484463200397948*^9, 3.484463369735323*^9}, {
   3.484463457877739*^9, 3.484463470013881*^9}, {3.527653227549862*^9, 
   3.527653317326805*^9}, {3.527653387262616*^9, 3.527653406509026*^9}, 
   3.527653975776517*^9, 3.542534361840562*^9, {3.543034772201591*^9, 
   3.5430347825051813`*^9}, {3.545161076016271*^9, 3.5451611204801807`*^9}, {
   3.545161321120359*^9, 3.545161344927905*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["costruts[ ]   and  rest of code", "Subsubsection",
 CellChangeTimes->{{3.52764638257008*^9, 3.527646486488145*^9}, {
  3.527646569337536*^9, 3.527646586824863*^9}}],

Cell["\<\
To work out the coefficient of the strut  \[OpenCurlyDoubleQuote]1\
\[CloseCurlyDoubleQuote], we need to subtract the sum of all the other terms \
in X. 
This is only ever needed in Clifford computations  (a tensor with strut \
\[OpenCurlyDoubleQuote]1\[CloseCurlyDoubleQuote]  is a scalar, in which case  \
struts[X] = {1}) .

The symbol  Strut1Coeff   will be used as a place-marker for where to put the \
coefficient of  strut  \[OpenCurlyDoubleQuote]1\[CloseCurlyDoubleQuote]  once \
we work out what it is.\
\>", "Text",
 CellChangeTimes->{{3.527653586616891*^9, 3.527653801537096*^9}, {
  3.542534565170822*^9, 3.542534675922657*^9}, {3.545161016513089*^9, 
  3.545161028736073*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "Strut1Coeff", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "strutCoefficient", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strutCoefficient", "[", 
   RowBox[{"X_", ",", "s_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"!", 
     RowBox[{"FreeQ", "[", 
      RowBox[{"s", ",", "SeriesData"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Print", "[", 
      "\"\<strutCoefficient: The strut (2nd argument in strutCoefficient[]) \
must be FreeQ of SeriesData.\>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Hold", "[", " ", 
       RowBox[{"strutCoefficient", "[", 
        RowBox[{"X", ",", "s"}], "]"}], "]"}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"s", "===", "1"}], ",", "Strut1Coeff", ",", 
      RowBox[{"Coefficient", "[", 
       RowBox[{"X", ",", "s"}], "]"}]}], "]"}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.527650927225032*^9, 3.5276509425047483`*^9}, {
   3.542528154964563*^9, 3.542528182166654*^9}, 3.5425333311624107`*^9, {
   3.542534530578106*^9, 3.542534541488544*^9}, {3.616276532873995*^9, 
   3.616276652606474*^9}, {3.616276714238263*^9, 3.616276800080847*^9}}],

Cell["\<\
06/08/2014:    If the strut  s  in the above code involves  SeriesData[ ]  \
then   Coefficient[ X, s ]  gives 0.  For example,\
\>", "Text",
 CellChangeTimes->{{3.616275227782522*^9, 3.616275336838357*^9}, {
   3.616275521477961*^9, 3.616275663302321*^9}, 3.61627573111016*^9, 
   3.616275794357889*^9, {3.616276247061212*^9, 3.616276265813221*^9}, 
   3.616276821012699*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Coefficient", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"2", "r"}], "+", 
    SuperscriptBox[
     RowBox[{"O", "[", "r", "]"}], "2"]}], ",", 
   RowBox[{"r", "+", 
    SuperscriptBox[
     RowBox[{"O", "[", "r", "]"}], "2"]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6162756746549664`*^9, 3.616275719771346*^9}}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.616275722345028*^9}]
}, Open  ]],

Cell[TextData[{
 "... this should never happen because struts should never  involve  \
SeriesData[ ]. But it did happen:   \[LeftAngleBracket] SeriesData[ ]  ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[RightAngleBracket]", "ab__List"], TraditionalForm]]],
 "  had not been defined to\ndistribute over series terms (after changing \
from single to multi-subscript brackets) and therefore the whole expression \
became a strut. Something like \nthat could happen again so that\
\[CloseCurlyQuote]s why we check. "
}], "Text",
 CellChangeTimes->{{3.616275808246348*^9, 3.616275818101799*^9}, {
  3.616275948021986*^9, 3.616276214325519*^9}, {3.616276281973753*^9, 
  3.6162762868697233`*^9}, {3.616276837413011*^9, 3.616276890116969*^9}}],

Cell["This returns the pair    { struts[ ],   costruts[ ] } ,", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
   3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
   3.479402186494101*^9}, {3.484463200397948*^9, 3.484463369735323*^9}, {
   3.484463457877739*^9, 3.484463470013881*^9}, {3.527653227549862*^9, 
   3.527653317326805*^9}, {3.527653387262616*^9, 3.527653406509026*^9}, 
   3.527653975776517*^9, 3.542534361840562*^9}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "strutPair", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"strutPair", "[", "X_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"y", ",", "c", ",", "s", ",", "p"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"s", " ", "=", " ", 
      RowBox[{"struts", "[", "X", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"Apply", "[", 
         RowBox[{"And", ",", 
          RowBox[{"Map", "[", 
           RowBox[{"IntegerQ", ",", 
            RowBox[{"deg", "[", 
             RowBox[{"Flatten", "[", "s", "]"}], "]"}]}], "]"}]}], "]"}]}], 
       ",", 
       RowBox[{
        RowBox[{
        "Print", "[", "\"\<Not all struts have well defined degree.\>\"", 
         "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"strutCoefficient", "[", 
          RowBox[{"X", ",", "#"}], "]"}], "&"}], ",", "s"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{"c", ",", "Strut1Coeff"}], "]"}], ",", " ", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"p", "=", 
         RowBox[{"First", "[", 
          RowBox[{"First", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"c", ",", "Strut1Coeff", ",", 
             RowBox[{"{", "1", "}"}], ",", 
             RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}], "]"}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"y", " ", "=", " ", 
         RowBox[{
          RowBox[{"c", ".", "s"}], "/.", 
          RowBox[{"Strut1Coeff", "\[Rule]", "0"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"[", "p", "]"}], "]"}], "=", 
         RowBox[{"X", "-", "y"}]}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"s", ",", "c"}], "}"}]}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.527652836612193*^9, 3.527652889724595*^9}, {
   3.527653997806252*^9, 3.5276539979496393`*^9}, 3.527654644224052*^9, {
   3.527654696707856*^9, 3.527654738146027*^9}, {3.527654784980323*^9, 
   3.5276548254128933`*^9}, {3.542533991014019*^9, 3.5425340262459793`*^9}, {
   3.542534713756122*^9, 3.542534723688542*^9}, {3.543035090271028*^9, 
   3.5430350960648403`*^9}}],

Cell["This is not really needed, but provided anyway,", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
   3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
   3.479402186494101*^9}, {3.484463200397948*^9, 3.484463369735323*^9}, {
   3.484463457877739*^9, 3.484463470013881*^9}, {3.527653227549862*^9, 
   3.527653317326805*^9}, {3.527653387262616*^9, 3.527653406509026*^9}, 
   3.527653975776517*^9, 3.542534361840562*^9, {3.542534412336576*^9, 
   3.5425344324803762`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "costruts", "]"}], "\n", 
 RowBox[{
  RowBox[{"costruts", "[", "X_", "]"}], ":=", 
  RowBox[{
   RowBox[{"strutPair", "[", "X", "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.542534380511837*^9, 3.542534380512978*^9}}],

Cell["\<\
opt___   is an options argument for Simplify[ ]  ( 3 underscores means it \
need not be present).  Eg:   Assumptions \[Rule] x > 0\
\>", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
   3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
   3.479402186494101*^9}, {3.484463200397948*^9, 3.484463369735323*^9}, {
   3.484463457877739*^9, 3.484463470013881*^9}, 3.527653390878954*^9}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"SimplifyTensor", ",", "Listable"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479400437825051*^9, 3.479400440828382*^9}, {
  3.479402522517516*^9, 3.479402524491043*^9}, {3.479402561745834*^9, 
  3.479402567520484*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "SimplifyTensor", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SimplifyTensor", "[", 
   RowBox[{"X_", ",", "opt___"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "c"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "c"}], "}"}], "=", 
      RowBox[{"strutPair", "[", "X", "]"}]}], ";", 
     RowBox[{
      RowBox[{"Simplify", "[", 
       RowBox[{"c", ",", "opt"}], "]"}], ".", "s"}]}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479375338504583*^9, 3.479375394579329*^9}, {
   3.479380758122427*^9, 3.479380853912467*^9}, {3.479383679947506*^9, 
   3.479383724891492*^9}, {3.479383761973506*^9, 3.47938378624425*^9}, 
   3.479384356649912*^9, {3.479398808705949*^9, 3.479398811705351*^9}, {
   3.479400959005462*^9, 3.479400968339613*^9}, {3.479401829190609*^9, 
   3.479401864951892*^9}, {3.479401973487906*^9, 3.479401998094797*^9}, {
   3.479402035607021*^9, 3.479402060224951*^9}, {3.479403170557384*^9, 
   3.479403199775492*^9}, 3.481891630621102*^9, {3.481891668673167*^9, 
   3.481891698673404*^9}, {3.481893683776741*^9, 3.481893687862852*^9}, {
   3.481907344569006*^9, 3.481907345496647*^9}, {3.484462472505398*^9, 
   3.484462498472655*^9}, {3.48446316016088*^9, 3.484463168856632*^9}, {
   3.527653424985107*^9, 3.527653443016942*^9}, {3.527653480568802*^9, 
   3.527653482951543*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SimplifyTensor", "[", 
  RowBox[{
   RowBox[{"3", " ", 
    RowBox[{"a1", "\[CircleTimes]", "b1", " ", "\[CircleTimes]", "c1"}]}], 
   "+", " ", 
   RowBox[{"4", " ", 
    RowBox[{"c2", "\[CircleTimes]", "b1"}]}], " ", "+", " ", 
   RowBox[{"5", " ", "b3"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.479402073649603*^9, 3.479402075387524*^9}}],

Cell[BoxData["\<\"Not all struts have well defined degree.\"\>"], "Print",
 CellChangeTimes->{3.518081130670341*^9, 3.613716836517356*^9, 
  3.613718509402522*^9, 3.613718692413075*^9}],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{3.479402075988335*^9, 3.479402207664775*^9, 
  3.47940257449398*^9, 3.479403209725785*^9, 3.479454093462088*^9, 
  3.47983277557886*^9, 3.479919159750479*^9, 3.480312932048431*^9, 
  3.480317275081229*^9, 3.480328333287601*^9, 3.480328587127463*^9, 
  3.480333474944009*^9, 3.480333970575443*^9, 3.480334701282038*^9, 
  3.480661310848131*^9, 3.480661695418696*^9, 3.48066240893661*^9, 
  3.518081130675789*^9, 3.613716836520269*^9, 3.613718509406722*^9, 
  3.6137186924158173`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"FullSimplifyTensor", ",", "Listable"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479400437825051*^9, 3.479400440828382*^9}, {
  3.479402522517516*^9, 3.479402524491043*^9}, {3.479402561745834*^9, 
  3.479402567520484*^9}, {3.484474796366109*^9, 3.484474797246537*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "FullSimplifyTensor", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FullSimplifyTensor", "[", 
   RowBox[{"X_", ",", "opt___"}], "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "c"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "c"}], "}"}], "=", 
      RowBox[{"strutPair", "[", "X", "]"}]}], ";", 
     RowBox[{
      RowBox[{"FullSimplify", "[", 
       RowBox[{"c", ",", "opt"}], "]"}], ".", "s"}]}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479375338504583*^9, 3.479375394579329*^9}, {
   3.479380758122427*^9, 3.479380853912467*^9}, {3.479383679947506*^9, 
   3.479383724891492*^9}, {3.479383761973506*^9, 3.47938378624425*^9}, 
   3.479384356649912*^9, {3.479398808705949*^9, 3.479398811705351*^9}, {
   3.479400959005462*^9, 3.479400968339613*^9}, {3.479401829190609*^9, 
   3.479401864951892*^9}, {3.479401973487906*^9, 3.479401998094797*^9}, {
   3.479402035607021*^9, 3.479402060224951*^9}, {3.479403170557384*^9, 
   3.479403199775492*^9}, 3.481891630621102*^9, {3.481891668673167*^9, 
   3.481891698673404*^9}, {3.481893683776741*^9, 3.481893687862852*^9}, {
   3.481907344569006*^9, 3.481907345496647*^9}, {3.484462472505398*^9, 
   3.484462498472655*^9}, {3.48446316016088*^9, 3.484463168856632*^9}, {
   3.484474800801606*^9, 3.484474812857392*^9}, {3.527653532153878*^9, 
   3.527653555576936*^9}}],

Cell["\<\
This just separates into strut-terms, without applying Simplify[ ] to each.  \
Eg. it is used in the Format for Times...\
\>", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
  3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
  3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
  3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
  3.479402186494101*^9}, {3.480843211906224*^9, 3.480843268769659*^9}, {
  3.480843319481457*^9, 3.480843342561113*^9}, {3.481792959813163*^9, 
  3.481793028143649*^9}, {3.481793901803292*^9, 3.481793908470624*^9}, {
  3.481794569139006*^9, 3.48179457363079*^9}, {3.481794720444015*^9, 
  3.481794720619888*^9}, {3.484463506348082*^9, 3.4844635091561*^9}}],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"StrutedTensor", ",", "Listable"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "StrutedTensor", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"StrutedTensor", "[", "X_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "c"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "c"}], "}"}], "=", 
      RowBox[{"strutPair", "[", "X", "]"}]}], ";", 
     RowBox[{"c", ".", "s"}]}]}], "]"}], " "}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479375338504583*^9, 3.479375394579329*^9}, {
   3.479380758122427*^9, 3.479380853912467*^9}, {3.479383679947506*^9, 
   3.479383724891492*^9}, {3.479383761973506*^9, 3.47938378624425*^9}, 
   3.479384356649912*^9, {3.479398808705949*^9, 3.479398811705351*^9}, {
   3.479400959005462*^9, 3.479400968339613*^9}, {3.479401829190609*^9, 
   3.479401864951892*^9}, {3.479401973487906*^9, 3.479401998094797*^9}, {
   3.479402035607021*^9, 3.479402060224951*^9}, {3.479403170557384*^9, 
   3.479403199775492*^9}, {3.480843197029086*^9, 3.480843199003777*^9}, {
   3.480843278940129*^9, 3.48084330900299*^9}, {3.48179303917375*^9, 
   3.481793043187913*^9}, {3.481794588180539*^9, 3.481794617322191*^9}, {
   3.481794763484805*^9, 3.481794767446833*^9}, {3.481907354280324*^9, 
   3.481907355367223*^9}, {3.527653866219109*^9, 3.527653888807679*^9}, {
   3.527653919786257*^9, 3.527653921433432*^9}}],

Cell["Maybe these are usefull too...", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
  3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
  3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
  3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
  3.479402186494101*^9}, {3.480843211906224*^9, 3.480843268769659*^9}, {
  3.480843319481457*^9, 3.480843342561113*^9}, {3.481792771350201*^9, 
  3.4817927817629*^9}, {3.481794682244141*^9, 3.481794687458991*^9}}],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"ExpandTensor", ",", "Listable"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "ExpandTensor", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ExpandTensor", "[", "X_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "c"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "c"}], "}"}], "=", 
      RowBox[{"strutPair", "[", "X", "]"}]}], ";", 
     RowBox[{
      RowBox[{"Expand", "[", "c", "]"}], ".", "s"}]}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479375338504583*^9, 3.479375394579329*^9}, {
   3.479380758122427*^9, 3.479380853912467*^9}, {3.479383679947506*^9, 
   3.479383724891492*^9}, {3.479383761973506*^9, 3.47938378624425*^9}, 
   3.479384356649912*^9, {3.479398808705949*^9, 3.479398811705351*^9}, {
   3.479400959005462*^9, 3.479400968339613*^9}, {3.479401829190609*^9, 
   3.479401864951892*^9}, {3.479401973487906*^9, 3.479401998094797*^9}, {
   3.479402035607021*^9, 3.479402060224951*^9}, {3.479403170557384*^9, 
   3.479403199775492*^9}, {3.480843197029086*^9, 3.480843199003777*^9}, {
   3.480843278940129*^9, 3.48084330900299*^9}, {3.48179303917375*^9, 
   3.481793043187913*^9}, {3.481794588180539*^9, 3.481794617322191*^9}, {
   3.481794661902735*^9, 3.481794677094431*^9}, {3.481907357671289*^9, 
   3.481907358646894*^9}, {3.527653869272664*^9, 3.527653891064703*^9}, {
   3.527653945147151*^9, 3.5276539473218107`*^9}}],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"ExpandAllTensor", ",", "Listable"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "ExpandAllTensor", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ExpandAllTensor", "[", "X_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "c"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "c"}], "}"}], "=", 
      RowBox[{"strutPair", "[", "X", "]"}]}], ";", 
     RowBox[{
      RowBox[{"ExpandAll", "[", "c", "]"}], ".", "s"}]}]}], "]"}]}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.479375338504583*^9, 3.479375394579329*^9}, {
   3.479380758122427*^9, 3.479380853912467*^9}, {3.479383679947506*^9, 
   3.479383724891492*^9}, {3.479383761973506*^9, 3.47938378624425*^9}, 
   3.479384356649912*^9, {3.479398808705949*^9, 3.479398811705351*^9}, {
   3.479400959005462*^9, 3.479400968339613*^9}, {3.479401829190609*^9, 
   3.479401864951892*^9}, {3.479401973487906*^9, 3.479401998094797*^9}, {
   3.479402035607021*^9, 3.479402060224951*^9}, {3.479403170557384*^9, 
   3.479403199775492*^9}, {3.480843197029086*^9, 3.480843199003777*^9}, {
   3.480843278940129*^9, 3.48084330900299*^9}, {3.481792789209887*^9, 
   3.481792794856742*^9}, {3.481793864488669*^9, 3.481793871751076*^9}, {
   3.48179473300721*^9, 3.481794736496728*^9}, {3.481907361094597*^9, 
   3.481907361942325*^9}, {3.527653872187141*^9, 3.5276538921448717`*^9}, {
   3.527653960059423*^9, 3.527653960553768*^9}}],

Cell[BoxData[{
 RowBox[{"SetAttributes", "[", 
  RowBox[{"FactorTensor", ",", "Listable"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "FactorTensor", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FactorTensor", "[", "X_", "]"}], ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "c"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "c"}], "}"}], "=", 
      RowBox[{"strutPair", "[", "X", "]"}]}], ";", 
     RowBox[{
      RowBox[{"Factor", "[", "c", "]"}], ".", "s"}]}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479375338504583*^9, 3.479375394579329*^9}, {
   3.479380758122427*^9, 3.479380853912467*^9}, {3.479383679947506*^9, 
   3.479383724891492*^9}, {3.479383761973506*^9, 3.47938378624425*^9}, 
   3.479384356649912*^9, {3.479398808705949*^9, 3.479398811705351*^9}, {
   3.479400959005462*^9, 3.479400968339613*^9}, {3.479401829190609*^9, 
   3.479401864951892*^9}, {3.479401973487906*^9, 3.479401998094797*^9}, {
   3.479402035607021*^9, 3.479402060224951*^9}, {3.479403170557384*^9, 
   3.479403199775492*^9}, {3.480843197029086*^9, 3.480843199003777*^9}, {
   3.480843278940129*^9, 3.48084330900299*^9}, {3.481792789209887*^9, 
   3.481792794856742*^9}, {3.481793864488669*^9, 3.481793871751076*^9}, {
   3.48179473300721*^9, 3.481794736496728*^9}, {3.481907361094597*^9, 
   3.481907361942325*^9}, {3.527653872187141*^9, 3.5276538921448717`*^9}, {
   3.527653960059423*^9, 3.527653960553768*^9}, {3.5426187033251543`*^9, 
   3.542618757836194*^9}}],

Cell["\<\
For  SeriesData  we shall apply  SimplifyTensor[ ]  individually to each \
coefficient of the series... \
\>", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
  3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
  3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
  3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
  3.479402186494101*^9}, {3.480843211906224*^9, 3.480843268769659*^9}, {
  3.480843319481457*^9, 3.480843342561113*^9}, {3.481267332224457*^9, 
  3.481267377273174*^9}, {3.481267428396835*^9, 3.481267429700931*^9}, {
  3.481267723459249*^9, 3.481267752156323*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"ss", "=", 
    RowBox[{"Series", "[", 
     RowBox[{
      RowBox[{"Sin", "[", "\[Theta]", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"\[Theta]", ",", "0", ",", "5"}], "}"}]}], "]"}]}], ")"}], "//",
   "FullForm"}]], "Input",
 CellChangeTimes->{{3.481266470412144*^9, 3.481266547734917*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"SeriesData", "[", 
    RowBox[{"\\[Theta]", ",", "0", ",", 
     RowBox[{"List", "[", 
      RowBox[{"1", ",", "0", ",", 
       RowBox[{"Rational", "[", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "6"}], "]"}], ",", "0", ",", 
       RowBox[{"Rational", "[", 
        RowBox[{"1", ",", "120"}], "]"}]}], "]"}], ",", "1", ",", "6", ",", 
     "1"}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellChangeTimes->{{3.481266505760391*^9, 3.481266517277552*^9}, 
   3.481266548517547*^9, 3.481625221443102*^9, 3.518081130749817*^9, 
   3.613716836648633*^9, 3.613718509509315*^9, 3.61371869256664*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ss", "[", 
  RowBox[{"[", "3", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.481266520150604*^9, 3.481266566077656*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1", ",", "0", ",", 
   RowBox[{"-", 
    FractionBox["1", "6"]}], ",", "0", ",", 
   FractionBox["1", "120"]}], "}"}]], "Output",
 CellChangeTimes->{{3.481266523215429*^9, 3.481266566646672*^9}, 
   3.481625223396155*^9, 3.5180811307853403`*^9, 3.6137168368982487`*^9, 
   3.6137185095584507`*^9, 3.613718692618865*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MapAt", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{"f", ",", "#"}], "]"}], "&"}], ",", "ss", ",", "3"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.481266766663274*^9, 3.481266786220362*^9}, {
  3.481266951711563*^9, 3.481266962260392*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", "1", "]"}], " ", "\[Theta]"}], "+", 
   RowBox[{
    RowBox[{"f", "[", "0", "]"}], " ", 
    SuperscriptBox["\[Theta]", "2"]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     RowBox[{"-", 
      FractionBox["1", "6"]}], "]"}], " ", 
    SuperscriptBox["\[Theta]", "3"]}], "+", 
   RowBox[{
    RowBox[{"f", "[", "0", "]"}], " ", 
    SuperscriptBox["\[Theta]", "4"]}], "+", 
   RowBox[{
    RowBox[{"f", "[", 
     FractionBox["1", "120"], "]"}], " ", 
    SuperscriptBox["\[Theta]", "5"]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Theta]", "]"}], "6"],
    SeriesData[$CellContext`\[Theta], 0, {}, 1, 6, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Theta], 0, {
    $CellContext`f[1], 
    $CellContext`f[0], 
    $CellContext`f[
     Rational[-1, 6]], 
    $CellContext`f[0], 
    $CellContext`f[
     Rational[1, 120]]}, 1, 6, 1],
  Editable->False]], "Output",
 CellChangeTimes->{3.481266791590278*^9, 3.481266968387955*^9, 
  3.481625225316724*^9, 3.518081130821097*^9, 3.613716836992098*^9, 
  3.613718509604772*^9, 3.613718692686207*^9}]
}, Open  ]],

Cell["\<\
The argument here is more specific than  X_,  therefore these definitions \
will be used first...
NB. If these definitions are not found, then when applied to SeriesData, \
these functions (for some reason) all return zero!\
\>", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
  3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
  3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
  3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
  3.479402186494101*^9}, {3.480843211906224*^9, 3.480843268769659*^9}, {
  3.480843319481457*^9, 3.480843342561113*^9}, {3.481267332224457*^9, 
  3.481267377273174*^9}, {3.481267428396835*^9, 3.481267429700931*^9}, {
  3.481267568071268*^9, 3.481267574043645*^9}, {3.48126764468343*^9, 
  3.481267695555103*^9}, {3.481267764514766*^9, 3.481267776570364*^9}, {
  3.481793306843608*^9, 3.481793389811661*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SimplifyTensor", "[", 
   RowBox[{"X_SeriesData", ",", "opt___"}], "]"}], ":=", " ", 
  RowBox[{"MapAt", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"SimplifyTensor", "[", 
         RowBox[{"#", ",", "opt"}], "]"}], "&"}], ",", "#"}], "]"}], "&"}], 
    ",", "X", ",", "3"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.48126636354748*^9, {3.481266575021816*^9, 3.481266582206692*^9}, {
   3.481267034728118*^9, 3.481267051902033*^9}, {3.48446637693621*^9, 
   3.484466392799844*^9}, {3.484466550014918*^9, 3.484466569798788*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FullSimplifyTensor", "[", 
   RowBox[{"X_SeriesData", ",", "opt___"}], "]"}], ":=", " ", 
  RowBox[{"MapAt", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"FullSimplifyTensor", "[", 
         RowBox[{"#", ",", "opt"}], "]"}], "&"}], ",", "#"}], "]"}], "&"}], 
    ",", "X", ",", "3"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.484474751513767*^9, 3.484474756920354*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"StrutedTensor", "[", "X_SeriesData", "]"}], ":=", " ", 
  RowBox[{"MapAt", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"StrutedTensor", ",", "#"}], "]"}], "&"}], ",", "X", ",", "3"}],
    "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.481794812590946*^9, 3.481794830842692*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExpandTensor", "[", "X_SeriesData", "]"}], ":=", " ", 
  RowBox[{"MapAt", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"ExpandTensor", ",", "#"}], "]"}], "&"}], ",", "X", ",", "3"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.481267488727069*^9, 3.481267497835005*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExpandAllTensor", "[", "X_SeriesData", "]"}], ":=", " ", 
  RowBox[{"MapAt", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"ExpandAllTensor", ",", "#"}], "]"}], "&"}], ",", "X", ",", 
    "3"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.481792717160984*^9, 3.481792724085788*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorTensor", "[", "X_SeriesData", "]"}], ":=", " ", 
  RowBox[{"MapAt", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"FactorTensor", ",", "#"}], "]"}], "&"}], ",", "X", ",", "3"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.542621678839472*^9, 3.542621688053952*^9}}],

Cell["Make these listable.  Added 10/04/2012,", "Text",
 CellChangeTimes->{{3.479399901940275*^9, 3.479400010523204*^9}, {
   3.479400263074204*^9, 3.479400295321965*^9}, {3.479400375402746*^9, 
   3.479400381847396*^9}, {3.479400765015353*^9, 3.479400790529146*^9}, {
   3.479401901544111*^9, 3.479401952159112*^9}, {3.479402132536521*^9, 
   3.479402186494101*^9}, {3.484463200397948*^9, 3.484463369735323*^9}, {
   3.484463457877739*^9, 3.484463470013881*^9}, {3.527653227549862*^9, 
   3.527653317326805*^9}, {3.527653387262616*^9, 3.527653406509026*^9}, 
   3.527653975776517*^9, 3.542534361840562*^9, {3.543034772201591*^9, 
   3.5430347825051813`*^9}, {3.543035879886841*^9, 3.543035889454652*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"struts", "[", "c_List", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"struts", ",", "c"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5430347239002247`*^9, 3.543034755454212*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"costruts", "[", "c_List", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"costruts", ",", "c"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.543035807987584*^9, 3.5430358132513123`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"strutPair", "[", "c_List", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"strutPair", ",", "c"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.543034851531839*^9, 3.543034866287169*^9}, {
  3.543034906783614*^9, 3.543034950127203*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"struts", "[", "X_SeriesData", "]"}], " ", ":=", " ", 
  RowBox[{"struts", "[", 
   RowBox[{"X", "[", 
    RowBox[{"[", "3", "]"}], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.543036015718583*^9, 3.5430360660532227`*^9}, {
  3.543036534808817*^9, 3.543036548506517*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Taking Series[ ]  ---    Series[ ]   of   \[LeftAngleBracket] , \
\[RightAngleBracket]  and  \[CircleTimes]        ---  only defined for \
special cases\
\>", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
   3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
   3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
   3.48042476399629*^9, 3.480424778951466*^9}, {3.480424840490856*^9, 
   3.480424892398905*^9}, {3.480425254979428*^9, 3.480425273632887*^9}, {
   3.542597889881175*^9, 3.542597952866296*^9}, {3.543023258980397*^9, 
   3.543023265027974*^9}, {3.543023316531806*^9, 3.543023335075959*^9}, {
   3.615067706038681*^9, 3.615067746182988*^9}, {3.615252578349161*^9, 
   3.6152525879330683`*^9}, {3.615252981357308*^9, 3.615253007262403*^9}, 
   3.6152540844020576`*^9, {3.620952791254348*^9, 3.620952897834401*^9}}],

Cell["\<\
This statement is not initialized  (29/09/2014)  because these rules are not \
useful, as explained below,\
\>", "Text",
 CellChangeTimes->{{3.6150674987893877`*^9, 3.615067698278131*^9}, {
   3.620952511524831*^9, 3.620952567797153*^9}, {3.620952663046001*^9, 
   3.620952684501856*^9}, {3.620952901638756*^9, 3.620952924086977*^9}, 
   3.6228556988322573`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Series", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Series", "[", 
   RowBox[{"a_AngleBracket", ",", "y_"}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Series", "[", 
      RowBox[{"#", ",", "y"}], "]"}], "&"}], ",", "a"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Series", "[", 
   RowBox[{"a_CircleTimes", ",", "y_"}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Series", "[", 
      RowBox[{"#", ",", "y"}], "]"}], "&"}], ",", "a"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "Series", "]"}], ";"}]}], "Input",
 CellChangeTimes->{
  3.543028025111062*^9, {3.620952539263571*^9, 3.6209525516284313`*^9}}],

Cell["\<\
... these rules are not quite sufficient because Series does not distribute \
over Plus and it also messes up on Times.\
\>", "Text",
 CellChangeTimes->{{3.620947627059643*^9, 3.62094762974972*^9}, {
  3.6209476668372507`*^9, 3.6209477112840557`*^9}, {3.620948106712631*^9, 
  3.620948125253317*^9}, {3.620952696341848*^9, 3.6209526972540627`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearField", "[", "s", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"a0", ",", "a1", ",", "a2", ",", "b0", ",", "b1", ",", "b2"}], 
   "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"A", ",", "B"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{"0", ",", "s"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"a0", ",", "a1", ",", "a2", ",", "b0", ",", "b1", ",", "b2"}], 
    "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{"2", ",", 
   RowBox[{"{", 
    RowBox[{"A", ",", "B"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6209443370328493`*^9, 3.620944385888969*^9}, {
  3.6209444185597982`*^9, 3.620944425826333*^9}, {3.620944620850058*^9, 
  3.620944632340407*^9}, {3.620947759753748*^9, 3.620947795943595*^9}}],

Cell["\<\
Although these two examples work because of the above rules, anything more \
general does not,\
\>", "Text",
 CellChangeTimes->{{3.620948004468536*^9, 3.620948007876833*^9}, {
  3.620948131156946*^9, 3.620948135529448*^9}, {3.620951199263509*^9, 
  3.620951246079794*^9}, {3.620952148002982*^9, 3.6209521518751907`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"a0", "[", "s", "]"}], ",", 
     RowBox[{"A", "[", "s", "]"}], ",", 
     RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}], ",", 
   RowBox[{"{", 
    RowBox[{"s", ",", "0", ",", "2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6209446523385153`*^9, 3.620944677666492*^9}, {
  3.62094798240908*^9, 3.620947992810835*^9}, {3.620948139116115*^9, 
  3.620948141052265*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"a0", "[", "0", "]"}], ",", 
     RowBox[{"A", "[", "0", "]"}], ",", 
     RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "0", "]"}], ",", 
        RowBox[{"A", "[", "0", "]"}], ",", 
        RowBox[{
         SuperscriptBox["b0", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}]}], 
       "\[RightAngleBracket]"}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "0", "]"}], ",", 
        RowBox[{
         SuperscriptBox["A", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], ",", 
        RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{
         SuperscriptBox["a0", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], ",", 
        RowBox[{"A", "[", "0", "]"}], ",", 
        RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}]}], ")"}], 
    " ", "s"}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{"a0", "[", "0", "]"}], ",", 
         RowBox[{"A", "[", "0", "]"}], ",", 
         RowBox[{
          SuperscriptBox["b0", "\[Prime]\[Prime]",
           MultilineFunction->None], "[", "0", "]"}]}], 
        "\[RightAngleBracket]"}]}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "0", "]"}], ",", 
        RowBox[{
         SuperscriptBox["A", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], ",", 
        RowBox[{
         SuperscriptBox["b0", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}]}], 
       "\[RightAngleBracket]"}], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{"a0", "[", "0", "]"}], ",", 
         RowBox[{
          SuperscriptBox["A", "\[Prime]\[Prime]",
           MultilineFunction->None], "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}]}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{
         SuperscriptBox["a0", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], ",", 
        RowBox[{"A", "[", "0", "]"}], ",", 
        RowBox[{
         SuperscriptBox["b0", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}]}], 
       "\[RightAngleBracket]"}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{
         SuperscriptBox["a0", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], ",", 
        RowBox[{
         SuperscriptBox["A", "\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], ",", 
        RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{
          SuperscriptBox["a0", "\[Prime]\[Prime]",
           MultilineFunction->None], "[", "0", "]"}], ",", 
         RowBox[{"A", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}]}]}], ")"}],
     " ", 
    SuperscriptBox["s", "2"]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "s", "]"}], "3"],
    SeriesData[$CellContext`s, 0, {}, 0, 3, 1],
    Editable->False]}],
  SeriesData[$CellContext`s, 0, {
    AngleBracket[
     $CellContext`a0[0], 
     $CellContext`A[0], 
     $CellContext`b0[0]], AngleBracket[
      $CellContext`a0[0], 
      $CellContext`A[0], 
      Derivative[1][$CellContext`b0][0]] + AngleBracket[
      $CellContext`a0[0], 
      Derivative[1][$CellContext`A][0], 
      $CellContext`b0[0]] + AngleBracket[
      Derivative[1][$CellContext`a0][0], 
      $CellContext`A[0], 
      $CellContext`b0[0]], Rational[1, 2] AngleBracket[
       $CellContext`a0[0], 
       $CellContext`A[0], 
       Derivative[2][$CellContext`b0][0]] + AngleBracket[
      $CellContext`a0[0], 
      Derivative[1][$CellContext`A][0], 
      Derivative[1][$CellContext`b0][0]] + Rational[1, 2] AngleBracket[
       $CellContext`a0[0], 
       Derivative[2][$CellContext`A][0], 
       $CellContext`b0[0]] + AngleBracket[
      Derivative[1][$CellContext`a0][0], 
      $CellContext`A[0], 
      Derivative[1][$CellContext`b0][0]] + AngleBracket[
      Derivative[1][$CellContext`a0][0], 
      Derivative[1][$CellContext`A][0], 
      $CellContext`b0[0]] + Rational[1, 2] AngleBracket[
       Derivative[2][$CellContext`a0][0], 
       $CellContext`A[0], 
       $CellContext`b0[0]]}, 0, 3, 1],
  Editable->False]], "Output",
 CellChangeTimes->{
  3.620946823881996*^9, 3.6209469063401413`*^9, {3.620947987026848*^9, 
   3.620947993359651*^9}, 3.6209481422290792`*^9, 3.620948195274859*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
    RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
    RowBox[{"b0", "[", "s", "]"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"s", ",", "0", ",", "2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6209446523385153`*^9, 3.620944677666492*^9}, {
  3.62094798240908*^9, 3.620947992810835*^9}, {3.620948139116115*^9, 
  3.620948165963334*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{
    RowBox[{"a0", "[", "0", "]"}], "\[CircleTimes]", 
    RowBox[{"A", "[", "0", "]"}], "\[CircleTimes]", 
    RowBox[{"b0", "[", "0", "]"}]}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"a0", "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{"A", "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{
        SuperscriptBox["b0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}]}], "+", 
      RowBox[{
       RowBox[{"a0", "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{
        SuperscriptBox["A", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{"b0", "[", "0", "]"}]}], "+", 
      RowBox[{
       RowBox[{
        SuperscriptBox["a0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{"A", "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{"b0", "[", "0", "]"}]}]}], ")"}], " ", "s"}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{
        RowBox[{"a0", "[", "0", "]"}], "\[CircleTimes]", 
        RowBox[{"A", "[", "0", "]"}], "\[CircleTimes]", 
        RowBox[{
         SuperscriptBox["b0", "\[Prime]\[Prime]",
          MultilineFunction->None], "[", "0", "]"}]}]}], "+", 
      RowBox[{
       RowBox[{"a0", "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{
        SuperscriptBox["A", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{
        SuperscriptBox["b0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{
        RowBox[{"a0", "[", "0", "]"}], "\[CircleTimes]", 
        RowBox[{
         SuperscriptBox["A", "\[Prime]\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
        RowBox[{"b0", "[", "0", "]"}]}]}], "+", 
      RowBox[{
       RowBox[{
        SuperscriptBox["a0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{"A", "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{
        SuperscriptBox["b0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}]}], "+", 
      RowBox[{
       RowBox[{
        SuperscriptBox["a0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{
        SuperscriptBox["A", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
       RowBox[{"b0", "[", "0", "]"}]}], "+", 
      RowBox[{
       FractionBox["1", "2"], " ", 
       RowBox[{
        RowBox[{
         SuperscriptBox["a0", "\[Prime]\[Prime]",
          MultilineFunction->None], "[", "0", "]"}], "\[CircleTimes]", 
        RowBox[{"A", "[", "0", "]"}], "\[CircleTimes]", 
        RowBox[{"b0", "[", "0", "]"}]}]}]}], ")"}], " ", 
    SuperscriptBox["s", "2"]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "s", "]"}], "3"],
    SeriesData[$CellContext`s, 0, {}, 0, 3, 1],
    Editable->False]}],
  SeriesData[$CellContext`s, 0, {
    CircleTimes[
     $CellContext`a0[0], 
     $CellContext`A[0], 
     $CellContext`b0[0]], CircleTimes[
      $CellContext`a0[0], 
      $CellContext`A[0], 
      Derivative[1][$CellContext`b0][0]] + CircleTimes[
      $CellContext`a0[0], 
      Derivative[1][$CellContext`A][0], 
      $CellContext`b0[0]] + CircleTimes[
      Derivative[1][$CellContext`a0][0], 
      $CellContext`A[0], 
      $CellContext`b0[0]], Rational[1, 2] CircleTimes[
       $CellContext`a0[0], 
       $CellContext`A[0], 
       Derivative[2][$CellContext`b0][0]] + CircleTimes[
      $CellContext`a0[0], 
      Derivative[1][$CellContext`A][0], 
      Derivative[1][$CellContext`b0][0]] + Rational[1, 2] CircleTimes[
       $CellContext`a0[0], 
       Derivative[2][$CellContext`A][0], 
       $CellContext`b0[0]] + CircleTimes[
      Derivative[1][$CellContext`a0][0], 
      $CellContext`A[0], 
      Derivative[1][$CellContext`b0][0]] + CircleTimes[
      Derivative[1][$CellContext`a0][0], 
      Derivative[1][$CellContext`A][0], 
      $CellContext`b0[0]] + Rational[1, 2] CircleTimes[
       Derivative[2][$CellContext`a0][0], 
       $CellContext`A[0], 
       $CellContext`b0[0]]}, 0, 3, 1],
  Editable->False]], "Output",
 CellChangeTimes->{3.620948167000803*^9, 3.620948197519471*^9}]
}, Open  ]],

Cell["Sums and products get messed up,", "Text",
 CellChangeTimes->{{3.62094801560458*^9, 3.620948036276919*^9}, {
  3.6209488007511663`*^9, 3.6209488099266787`*^9}, {3.620951256031474*^9, 
  3.620951256431467*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"1", "+", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a0", "[", "s", "]"}], ",", 
      RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"s", ",", "0", ",", "1"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"2", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"A", "[", "s", "]"}], ",", 
      RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], ",", 
   RowBox[{"{", 
    RowBox[{"s", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6209480423146687`*^9, 3.620948085724011*^9}, {
  3.6209482101780977`*^9, 3.620948211819769*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a0", "[", "0", "]"}], ",", 
       RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}]}], ")"}], 
   "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        SuperscriptBox["b0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["AngleBracket", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"0", ",", "1"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"a0", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}], "+", 
      RowBox[{
       RowBox[{
        SuperscriptBox["a0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["AngleBracket", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"1", ",", "0"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"a0", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}]}], ")"}], " ", "s"}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "s", "]"}], "2"],
    SeriesData[$CellContext`s, 0, {}, 0, 2, 1],
    Editable->False]}],
  SeriesData[$CellContext`s, 0, {1 + AngleBracket[
      $CellContext`a0[0], 
      $CellContext`b0[0]], 
    Derivative[1][$CellContext`b0][0] Derivative[0, 1][AngleBracket][
       $CellContext`a0[0], 
       $CellContext`b0[0]] + 
    Derivative[1][$CellContext`a0][0] Derivative[1, 0][AngleBracket][
       $CellContext`a0[0], 
       $CellContext`b0[0]]}, 0, 2, 1],
  Editable->False]], "Output",
 CellChangeTimes->{{3.620948066360024*^9, 3.620948087079372*^9}, {
  3.6209482030486317`*^9, 3.620948213810843*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"2", " ", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"A", "[", "0", "]"}], ",", 
      RowBox[{"b0", "[", "0", "]"}]}], "\[RightAngleBracket]"}]}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"2", " ", 
       RowBox[{
        SuperscriptBox["b0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["AngleBracket", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"0", ",", "1"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"A", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}], "+", 
      RowBox[{"2", " ", 
       RowBox[{
        SuperscriptBox["A", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["AngleBracket", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"1", ",", "0"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"A", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}]}], ")"}], " ", "s"}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "s", "]"}], "2"],
    SeriesData[$CellContext`s, 0, {}, 0, 2, 1],
    Editable->False]}],
  SeriesData[$CellContext`s, 0, {2 AngleBracket[
      $CellContext`A[0], 
      $CellContext`b0[0]], (2 Derivative[1][$CellContext`b0][0]) 
     Derivative[0, 1][AngleBracket][
       $CellContext`A[0], 
       $CellContext`b0[0]] + (2 Derivative[1][$CellContext`A][0]) 
     Derivative[1, 0][AngleBracket][
       $CellContext`A[0], 
       $CellContext`b0[0]]}, 0, 2, 1],
  Editable->False]], "Output",
 CellChangeTimes->{{3.620948066360024*^9, 3.620948087079372*^9}, {
  3.6209482030486317`*^9, 3.62094821381854*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"A", "[", "s", "]"}], "+", 
    RowBox[{
     RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
     RowBox[{"b0", "[", "s", "]"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"s", ",", "0", ",", "1"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"2", " ", 
    RowBox[{
     RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
     RowBox[{"b0", "[", "s", "]"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"s", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.6209480423146687`*^9, 3.620948085724011*^9}, {
  3.6209482101780977`*^9, 3.620948244333888*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"A", "[", "0", "]"}], "+", 
     RowBox[{
      RowBox[{"a0", "[", "0", "]"}], "\[CircleTimes]", 
      RowBox[{"b0", "[", "0", "]"}]}]}], ")"}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       SuperscriptBox["A", "\[Prime]",
        MultilineFunction->None], "[", "0", "]"}], "+", 
      RowBox[{
       RowBox[{
        SuperscriptBox["b0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["CircleTimes", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"0", ",", "1"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"a0", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}], "+", 
      RowBox[{
       RowBox[{
        SuperscriptBox["a0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["CircleTimes", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"1", ",", "0"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"a0", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}]}], ")"}], " ", "s"}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "s", "]"}], "2"],
    SeriesData[$CellContext`s, 0, {}, 0, 2, 1],
    Editable->False]}],
  SeriesData[$CellContext`s, 0, {$CellContext`A[0] + CircleTimes[
      $CellContext`a0[0], 
      $CellContext`b0[0]], Derivative[1][$CellContext`A][0] + 
    Derivative[1][$CellContext`b0][0] Derivative[0, 1][CircleTimes][
       $CellContext`a0[0], 
       $CellContext`b0[0]] + 
    Derivative[1][$CellContext`a0][0] Derivative[1, 0][CircleTimes][
       $CellContext`a0[0], 
       $CellContext`b0[0]]}, 0, 2, 1],
  Editable->False]], "Output",
 CellChangeTimes->{3.620948245568281*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"2", " ", 
    RowBox[{
     RowBox[{"A", "[", "0", "]"}], "\[CircleTimes]", 
     RowBox[{"b0", "[", "0", "]"}]}]}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"2", " ", 
       RowBox[{
        SuperscriptBox["b0", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["CircleTimes", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"0", ",", "1"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"A", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}], "+", 
      RowBox[{"2", " ", 
       RowBox[{
        SuperscriptBox["A", "\[Prime]",
         MultilineFunction->None], "[", "0", "]"}], " ", 
       RowBox[{
        SuperscriptBox["CircleTimes", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"1", ",", "0"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{
         RowBox[{"A", "[", "0", "]"}], ",", 
         RowBox[{"b0", "[", "0", "]"}]}], "]"}]}]}], ")"}], " ", "s"}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "s", "]"}], "2"],
    SeriesData[$CellContext`s, 0, {}, 0, 2, 1],
    Editable->False]}],
  SeriesData[$CellContext`s, 0, {2 CircleTimes[
      $CellContext`A[0], 
      $CellContext`b0[0]], (2 Derivative[1][$CellContext`b0][0]) 
     Derivative[0, 1][CircleTimes][
       $CellContext`A[0], 
       $CellContext`b0[0]] + (2 Derivative[1][$CellContext`A][0]) 
     Derivative[1, 0][CircleTimes][
       $CellContext`A[0], 
       $CellContext`b0[0]]}, 0, 2, 1],
  Editable->False]], "Output",
 CellChangeTimes->{3.6209482455766582`*^9}]
}, Open  ]],

Cell["\<\
.... so basically we would need to re-write the function Series.  I have \
never had to take such Series so I haven\[CloseCurlyQuote]t written the code. \
 Typically,  the series I have used 
have been w.r.t. a series variable that does not appear as a coordinate for \
any tensor field.  This is true even for the  ret/adv  calculations,  for  \
which arbitrary 
SeriesData was specified with series variable \[Delta]s  and coefficients (to \
be solved for) tensors of the coordinate s.

The following types of series are OK,  but they dont use the above rules. \
Here  \[Epsilon]  appears only as the series variable,\
\>", "Text",
 CellChangeTimes->{{3.62094801560458*^9, 3.620948036276919*^9}, {
  3.620948267509343*^9, 3.620948468438365*^9}, {3.620948592390547*^9, 
  3.620948633083568*^9}, {3.620948673782689*^9, 3.620948760243392*^9}, {
  3.6209489004074993`*^9, 3.620948948967717*^9}, {3.6209507612458563`*^9, 
  3.620950926210746*^9}, {3.620951108430876*^9, 3.6209511130564957`*^9}, {
  3.620951270719582*^9, 3.620951321216957*^9}, {3.620952172531787*^9, 
  3.620952239750206*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"a", "[", "s_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"a0", "[", "s", "]"}], " ", "+", " ", 
   RowBox[{
    RowBox[{"a1", "[", "s", "]"}], "\[Epsilon]"}], "  ", "+", " ", 
   RowBox[{
    RowBox[{"a2", "[", "s", "]"}], 
    SuperscriptBox["\[Epsilon]", "2"]}], " ", "+", " ", 
   SuperscriptBox[
    RowBox[{"O", "[", "\[Epsilon]", "]"}], "3"]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"b", "[", "s_", "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"b0", "[", "s", "]"}], " ", "+", " ", 
   RowBox[{
    RowBox[{"b1", "[", "s", "]"}], "\[Epsilon]"}], "  ", "+", " ", 
   RowBox[{
    RowBox[{"b2", "[", "s", "]"}], 
    SuperscriptBox["\[Epsilon]", "2"]}], " ", "+", " ", 
   SuperscriptBox[
    RowBox[{"O", "[", "\[Epsilon]", "]"}], "3"]}]}]}], "Input",
 CellChangeTimes->{{3.6209509433243723`*^9, 3.620950999112068*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"1", "+", 
    RowBox[{"2", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a", "[", "s", "]"}], ",", 
       RowBox[{"B", "[", "s", "]"}], ",", 
       RowBox[{"b", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Epsilon]", ",", "0", ",", "2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6209510189481077`*^9, 3.620951065317634*^9}, {
  3.620951162884452*^9, 3.62095116517459*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"(", 
    RowBox[{"1", "+", 
     RowBox[{"2", " ", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "s", "]"}], ",", 
        RowBox[{"B", "[", "s", "]"}], ",", 
        RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}]}], ")"}], 
   "+", 
   RowBox[{"2", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "s", "]"}], ",", 
        RowBox[{"B", "[", "s", "]"}], ",", 
        RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a1", "[", "s", "]"}], ",", 
        RowBox[{"B", "[", "s", "]"}], ",", 
        RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], ")"}], 
    " ", "\[Epsilon]"}], "+", 
   RowBox[{"2", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "s", "]"}], ",", 
        RowBox[{"B", "[", "s", "]"}], ",", 
        RowBox[{"b2", "[", "s", "]"}]}], "\[RightAngleBracket]"}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a1", "[", "s", "]"}], ",", 
        RowBox[{"B", "[", "s", "]"}], ",", 
        RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], "+", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a2", "[", "s", "]"}], ",", 
        RowBox[{"B", "[", "s", "]"}], ",", 
        RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], ")"}], 
    " ", 
    SuperscriptBox["\[Epsilon]", "2"]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "3"],
    SeriesData[$CellContext`\[Epsilon], 0, {}, 0, 3, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Epsilon], 0, {1 + 2 AngleBracket[
       $CellContext`a0[$CellContext`s], 
       $CellContext`B[$CellContext`s], 
       $CellContext`b0[$CellContext`s]], 2 (AngleBracket[
       $CellContext`a0[$CellContext`s], 
       $CellContext`B[$CellContext`s], 
       $CellContext`b1[$CellContext`s]] + AngleBracket[
       $CellContext`a1[$CellContext`s], 
       $CellContext`B[$CellContext`s], 
       $CellContext`b0[$CellContext`s]]), 2 (AngleBracket[
       $CellContext`a0[$CellContext`s], 
       $CellContext`B[$CellContext`s], 
       $CellContext`b2[$CellContext`s]] + AngleBracket[
       $CellContext`a1[$CellContext`s], 
       $CellContext`B[$CellContext`s], 
       $CellContext`b1[$CellContext`s]] + AngleBracket[
       $CellContext`a2[$CellContext`s], 
       $CellContext`B[$CellContext`s], 
       $CellContext`b0[$CellContext`s]])}, 0, 3, 1],
  Editable->False]], "Output",
 CellChangeTimes->{{3.620951031379242*^9, 3.620951043716861*^9}, 
   3.6209511689804993`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ser", " ", "=", 
  RowBox[{"Series", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
      RowBox[{"b", "[", "s", "]"}]}], "+", 
     RowBox[{"2", 
      RowBox[{
       RowBox[{"a", "[", "s", "]"}], "\[CircleTimes]", 
       RowBox[{"b", "[", "s", "]"}], "\[CircleTimes]", 
       RowBox[{"a", "[", "s", "]"}]}]}]}], ",", 
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", ",", "0", ",", "2"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.6209510848205976`*^9, 3.620951098469038*^9}, {
  3.620951150979801*^9, 3.6209511558153877`*^9}, {3.6209514225042057`*^9, 
  3.62095142709687*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
      RowBox[{"b0", "[", "s", "]"}]}], "+", 
     RowBox[{"2", " ", 
      RowBox[{
       RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
       RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
       RowBox[{"a0", "[", "s", "]"}]}]}]}], ")"}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
       RowBox[{"b1", "[", "s", "]"}]}], "+", 
      RowBox[{"2", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a1", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}]}], ")"}]}]}], ")"}], " ", 
    "\[Epsilon]"}], "+", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
       RowBox[{"b2", "[", "s", "]"}]}], "+", 
      RowBox[{"2", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a2", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a1", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b2", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a1", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a2", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}]}], ")"}]}]}], ")"}], " ", 
    SuperscriptBox["\[Epsilon]", "2"]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "3"],
    SeriesData[$CellContext`\[Epsilon], 0, {}, 0, 3, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Epsilon], 0, {CircleTimes[
      $CellContext`A[$CellContext`s], 
      $CellContext`b0[$CellContext`s]] + 2 CircleTimes[
       $CellContext`a0[$CellContext`s], 
       $CellContext`b0[$CellContext`s], 
       $CellContext`a0[$CellContext`s]], CircleTimes[
      $CellContext`A[$CellContext`s], 
      $CellContext`b1[$CellContext`s]] + 2 (CircleTimes[
        $CellContext`a0[$CellContext`s], 
        $CellContext`b0[$CellContext`s], 
        $CellContext`a1[$CellContext`s]] + CircleTimes[
        $CellContext`a0[$CellContext`s], 
        $CellContext`b1[$CellContext`s], 
        $CellContext`a0[$CellContext`s]] + CircleTimes[
        $CellContext`a1[$CellContext`s], 
        $CellContext`b0[$CellContext`s], 
        $CellContext`a0[$CellContext`s]]), CircleTimes[
      $CellContext`A[$CellContext`s], 
      $CellContext`b2[$CellContext`s]] + 2 (CircleTimes[
        $CellContext`a0[$CellContext`s], 
        $CellContext`b0[$CellContext`s], 
        $CellContext`a2[$CellContext`s]] + CircleTimes[
        $CellContext`a0[$CellContext`s], 
        $CellContext`b1[$CellContext`s], 
        $CellContext`a1[$CellContext`s]] + CircleTimes[
        $CellContext`a0[$CellContext`s], 
        $CellContext`b2[$CellContext`s], 
        $CellContext`a0[$CellContext`s]] + CircleTimes[
        $CellContext`a1[$CellContext`s], 
        $CellContext`b0[$CellContext`s], 
        $CellContext`a1[$CellContext`s]] + CircleTimes[
        $CellContext`a1[$CellContext`s], 
        $CellContext`b1[$CellContext`s], 
        $CellContext`a0[$CellContext`s]] + CircleTimes[
        $CellContext`a2[$CellContext`s], 
        $CellContext`b0[$CellContext`s], 
        $CellContext`a0[$CellContext`s]])}, 0, 3, 1],
  Editable->False]], "Output",
 CellChangeTimes->{
  3.620951100975067*^9, 3.6209511563231707`*^9, {3.6209514106677837`*^9, 
   3.620951428493462*^9}}]
}, Open  ]],

Cell["\<\
If the functions  AngleBracket[ ]   and  CircleTimes[ ]   have arguments that \
are independent of  \[Epsilon],  then taking  Series[ ]  is OK,\
\>", "Text",
 CellChangeTimes->{{3.620951443503604*^9, 3.620951456256426*^9}, {
  3.620952618102866*^9, 3.620952618965169*^9}, {3.620953010071227*^9, 
  3.620953081143779*^9}, {3.620953226824533*^9, 3.620953335625581*^9}, {
  3.620953454170012*^9, 3.62095349578607*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a0", "[", "s", "]"}], ",", 
       RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}], 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a2", "[", "s", "]"}], ",", 
       RowBox[{"b2", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
     RowBox[{"Cos", "[", "\[Epsilon]", "]"}]}], "+", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a1", "[", "s", "]"}], ",", 
       RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
     RowBox[{"Sin", "[", "\[Epsilon]", "]"}]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Epsilon]", ",", "0", ",", "3"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.620953100509308*^9, 3.620953191570814*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a0", "[", "s", "]"}], ",", 
      RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a2", "[", "s", "]"}], ",", 
      RowBox[{"b2", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], "+", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a1", "[", "s", "]"}], ",", 
      RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
    "\[Epsilon]"}], "-", 
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "s", "]"}], ",", 
        RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a2", "[", "s", "]"}], ",", 
        RowBox[{"b2", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], ")"}], 
    " ", 
    SuperscriptBox["\[Epsilon]", "2"]}], "-", 
   RowBox[{
    FractionBox["1", "6"], " ", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a1", "[", "s", "]"}], ",", 
      RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
    SuperscriptBox["\[Epsilon]", "3"]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "4"],
    SeriesData[$CellContext`\[Epsilon], 0, {}, 0, 4, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Epsilon], 0, {AngleBracket[
      $CellContext`a0[$CellContext`s], 
      $CellContext`b0[$CellContext`s]] AngleBracket[
      $CellContext`a2[$CellContext`s], 
      $CellContext`b2[$CellContext`s]], 
    AngleBracket[
     $CellContext`a1[$CellContext`s], 
     $CellContext`b1[$CellContext`s]], (Rational[-1, 2] AngleBracket[
       $CellContext`a0[$CellContext`s], 
       $CellContext`b0[$CellContext`s]]) AngleBracket[
      $CellContext`a2[$CellContext`s], 
      $CellContext`b2[$CellContext`s]], Rational[-1, 6] AngleBracket[
      $CellContext`a1[$CellContext`s], 
      $CellContext`b1[$CellContext`s]]}, 0, 4, 1],
  Editable->False]], "Output",
 CellChangeTimes->{{3.6209531171143093`*^9, 3.620953162008827*^9}, 
   3.620953192135211*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a0", "[", "s", "]"}], ",", 
       RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}], 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a2", "[", "s", "]"}], ",", 
       RowBox[{"b2", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
     RowBox[{"Cos", "[", "\[Epsilon]", "]"}]}], "+", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"a1", "[", "s", "]"}], ",", 
       RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
     RowBox[{"Sin", "[", "\[Epsilon]", "]"}]}], "+", 
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "10"]}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Epsilon]", ",", "0", ",", "3"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.620953100509308*^9, 3.620953191570814*^9}, {
  3.6209533503070087`*^9, 3.6209533612052593`*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a0", "[", "s", "]"}], ",", 
      RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a2", "[", "s", "]"}], ",", 
      RowBox[{"b2", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], "+", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a1", "[", "s", "]"}], ",", 
      RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
    "\[Epsilon]"}], "-", 
   RowBox[{
    FractionBox["1", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a0", "[", "s", "]"}], ",", 
        RowBox[{"b0", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"a2", "[", "s", "]"}], ",", 
        RowBox[{"b2", "[", "s", "]"}]}], "\[RightAngleBracket]"}]}], ")"}], 
    " ", 
    SuperscriptBox["\[Epsilon]", "2"]}], "-", 
   RowBox[{
    FractionBox["1", "6"], " ", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a1", "[", "s", "]"}], ",", 
      RowBox[{"b1", "[", "s", "]"}]}], "\[RightAngleBracket]"}], " ", 
    SuperscriptBox["\[Epsilon]", "3"]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "4"],
    SeriesData[$CellContext`\[Epsilon], 0, {}, 0, 4, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Epsilon], 0, {AngleBracket[
      $CellContext`a0[$CellContext`s], 
      $CellContext`b0[$CellContext`s]] AngleBracket[
      $CellContext`a2[$CellContext`s], 
      $CellContext`b2[$CellContext`s]], 
    AngleBracket[
     $CellContext`a1[$CellContext`s], 
     $CellContext`b1[$CellContext`s]], (Rational[-1, 2] AngleBracket[
       $CellContext`a0[$CellContext`s], 
       $CellContext`b0[$CellContext`s]]) AngleBracket[
      $CellContext`a2[$CellContext`s], 
      $CellContext`b2[$CellContext`s]], Rational[-1, 6] AngleBracket[
      $CellContext`a1[$CellContext`s], 
      $CellContext`b1[$CellContext`s]]}, 0, 4, 1],
  Editable->False]], "Output",
 CellChangeTimes->{{3.620953355677052*^9, 3.6209533626757603`*^9}}]
}, Open  ]],

Cell["Differentiation w.r.t.  \[Epsilon]  is also OK,", "Text",
 CellChangeTimes->{{3.620951443503604*^9, 3.620951456256426*^9}, {
  3.620952618102866*^9, 3.620952618965169*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"D", "[", 
  RowBox[{"ser", ",", "\[Epsilon]"}], "]"}]], "Input",
 CellChangeTimes->{{3.62095140757113*^9, 3.620951432019764*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
      RowBox[{"b1", "[", "s", "]"}]}], "+", 
     RowBox[{"2", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
         RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
         RowBox[{"a1", "[", "s", "]"}]}], "+", 
        RowBox[{
         RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
         RowBox[{"b1", "[", "s", "]"}], "\[CircleTimes]", 
         RowBox[{"a0", "[", "s", "]"}]}], "+", 
        RowBox[{
         RowBox[{"a1", "[", "s", "]"}], "\[CircleTimes]", 
         RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
         RowBox[{"a0", "[", "s", "]"}]}]}], ")"}]}]}], ")"}], "+", 
   RowBox[{"2", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"A", "[", "s", "]"}], "\[CircleTimes]", 
       RowBox[{"b2", "[", "s", "]"}]}], "+", 
      RowBox[{"2", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a2", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a1", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b2", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a1", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b1", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}], "+", 
         RowBox[{
          RowBox[{"a2", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"b0", "[", "s", "]"}], "\[CircleTimes]", 
          RowBox[{"a0", "[", "s", "]"}]}]}], ")"}]}]}], ")"}], " ", 
    "\[Epsilon]"}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "2"],
    SeriesData[$CellContext`\[Epsilon], 0, {}, 0, 2, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Epsilon], 0, {CircleTimes[
      $CellContext`A[$CellContext`s], 
      $CellContext`b1[$CellContext`s]] + 2 (CircleTimes[
        $CellContext`a0[$CellContext`s], 
        $CellContext`b0[$CellContext`s], 
        $CellContext`a1[$CellContext`s]] + CircleTimes[
        $CellContext`a0[$CellContext`s], 
        $CellContext`b1[$CellContext`s], 
        $CellContext`a0[$CellContext`s]] + CircleTimes[
        $CellContext`a1[$CellContext`s], 
        $CellContext`b0[$CellContext`s], 
        $CellContext`a0[$CellContext`s]]), 2 (CircleTimes[
       $CellContext`A[$CellContext`s], 
       $CellContext`b2[$CellContext`s]] + 2 (CircleTimes[
         $CellContext`a0[$CellContext`s], 
         $CellContext`b0[$CellContext`s], 
         $CellContext`a2[$CellContext`s]] + CircleTimes[
         $CellContext`a0[$CellContext`s], 
         $CellContext`b1[$CellContext`s], 
         $CellContext`a1[$CellContext`s]] + CircleTimes[
         $CellContext`a0[$CellContext`s], 
         $CellContext`b2[$CellContext`s], 
         $CellContext`a0[$CellContext`s]] + CircleTimes[
         $CellContext`a1[$CellContext`s], 
         $CellContext`b0[$CellContext`s], 
         $CellContext`a1[$CellContext`s]] + CircleTimes[
         $CellContext`a1[$CellContext`s], 
         $CellContext`b1[$CellContext`s], 
         $CellContext`a0[$CellContext`s]] + CircleTimes[
         $CellContext`a2[$CellContext`s], 
         $CellContext`b0[$CellContext`s], 
         $CellContext`a0[$CellContext`s]]))}, 0, 2, 1],
  Editable->False]], "Output",
 CellChangeTimes->{3.620951412758215*^9, 3.620951458842711*^9}]
}, Open  ]],

Cell["\<\
However, differentiation w.r.t.  s  is a mess, even for the following simple \
examples.
This was almost fixed in Section:   \[OpenCurlyDoubleQuote]Definition of  D[  \
]  for  \[CircleTimes]   and   \[LeftAngleBracket] , \[RightAngleBracket]\
\[CloseCurlyDoubleQuote] .
Eventually I wrote a proper-distance derivative  \[GothicCapitalD][ ]  that \
has no problem with series.\
\>", "Text",
 CellChangeTimes->{{3.620951443503604*^9, 3.620951483520492*^9}, {
  3.62095154632063*^9, 3.620951593936603*^9}, {3.620952271249329*^9, 
  3.6209522765155687`*^9}, {3.6209523157554083`*^9, 3.620952382085018*^9}, {
  3.620952629909498*^9, 3.620952632821905*^9}, {3.622855782590814*^9, 
  3.622855842143805*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"D", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"a0", "[", "s", "]"}], ",", "b0"}], "\[RightAngleBracket]"}], 
    "+", 
    RowBox[{"O", "[", "\[Epsilon]", "]"}]}], ",", "s"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"D", "[", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"a0", "[", "s", "]"}], "\[CircleTimes]", "b0"}], "+", 
    RowBox[{"O", "[", "\[Epsilon]", "]"}]}], ",", "s"}], "]"}]}], "Input",
 CellChangeTimes->{{3.620951381887045*^9, 3.620951389827134*^9}, {
  3.6209514864729424`*^9, 3.6209515406301947`*^9}, {3.620951575603794*^9, 
  3.620951583672442*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{
    RowBox[{
     SuperscriptBox["a0", "\[Prime]",
      MultilineFunction->None], "[", "s", "]"}], " ", 
    RowBox[{
     SuperscriptBox["AngleBracket", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"b0", ",", 
      RowBox[{"a0", "[", "s", "]"}]}], "]"}]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "1"],
    SeriesData[$CellContext`\[Epsilon], 0, {}, 0, 1, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Epsilon], 0, {
   Derivative[1][$CellContext`a0][$CellContext`s] 
    Derivative[0, 1][AngleBracket][$CellContext`b0, 
      $CellContext`a0[$CellContext`s]]}, 0, 1, 1],
  Editable->False]], "Output",
 CellChangeTimes->{
  3.6209513904053926`*^9, {3.620951492154214*^9, 3.620951498243668*^9}, {
   3.62095153029212*^9, 3.620951541283099*^9}, 3.620951585193973*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   RowBox[{
    RowBox[{
     SuperscriptBox["a0", "\[Prime]",
      MultilineFunction->None], "[", "s", "]"}], " ", 
    RowBox[{
     SuperscriptBox["CircleTimes", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"1", ",", "0"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{
      RowBox[{"a0", "[", "s", "]"}], ",", "b0"}], "]"}]}], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "\[Epsilon]", "]"}], "1"],
    SeriesData[$CellContext`\[Epsilon], 0, {}, 0, 1, 1],
    Editable->False]}],
  SeriesData[$CellContext`\[Epsilon], 0, {
   Derivative[1][$CellContext`a0][$CellContext`s] 
    Derivative[1, 0][CircleTimes][
      $CellContext`a0[$CellContext`s], $CellContext`b0]}, 0, 1, 1],
  Editable->False]], "Output",
 CellChangeTimes->{
  3.6209513904053926`*^9, {3.620951492154214*^9, 3.620951498243668*^9}, {
   3.62095153029212*^9, 3.620951541283099*^9}, 3.6209515852010803`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearField", "[", "s", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"a0", ",", "a1", ",", "a2", ",", "b0", ",", "b1", ",", "b2"}], 
   "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"A", ",", "B"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Clear", "[", "ser", "]"}]}], "Input",
 CellChangeTimes->{{3.6209524195302153`*^9, 3.620952423800469*^9}}],

Cell["\<\
This is a fast way to construct the series of something that is already \
polynomial in the series variable.
If the polynomial is a large expression,  Series[ ]  can be very slow,\
\>", "Text",
 CellChangeTimes->{{3.5430241380368767`*^9, 3.543024211893972*^9}, {
  3.543024248678434*^9, 3.543024294726151*^9}, {3.543024708600171*^9, 
  3.5430247119914207`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "PolyToSeries", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolyToSeries", "[", 
   RowBox[{"y_", ",", "\[CurlyEpsilon]_Symbol", ",", "max_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "n", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"PolynomialQ", "[", 
         RowBox[{"y", ",", "\[CurlyEpsilon]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<Non-polynomial argument.\>\"", "]"}], ";", 
        
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"max", " ", "\[GreaterEqual]", 
        RowBox[{"Exponent", "[", 
         RowBox[{"y", ",", "\[CurlyEpsilon]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"SeriesData", "[", 
        RowBox[{"\[CurlyEpsilon]", ",", "0", ",", 
         RowBox[{"CoefficientList", "[", 
          RowBox[{"y", ",", "\[CurlyEpsilon]"}], "]"}], ",", "0", ",", 
         RowBox[{"max", "+", "1"}], ",", "1"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"SeriesData", "[", 
        RowBox[{"\[CurlyEpsilon]", ",", "0", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Coefficient", "[", 
            RowBox[{"y", ",", "\[CurlyEpsilon]", ",", "n"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "0", ",", "max"}], "}"}]}], "]"}], ",", "0", 
         ",", 
         RowBox[{"max", "+", "1"}], ",", "1"}], "]"}]}], "]"}]}]}], 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.54302445389097*^9, {3.543024494659422*^9, 3.543024508499866*^9}, {
   3.543024788901752*^9, 3.5430248176421328`*^9}, 3.543024926599736*^9, {
   3.543025032875463*^9, 3.543025046277939*^9}, {3.543025083591304*^9, 
   3.543025119480915*^9}, {3.543025155513969*^9, 3.543025156344343*^9}, {
   3.543026151371687*^9, 3.543026228349197*^9}, {3.54302629298457*^9, 
   3.543026300618743*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolyToSeries", "[", 
   RowBox[{"y_", ",", "\[CurlyEpsilon]_Symbol"}], "]"}], ":=", 
  RowBox[{"PolyToSeries", "[", 
   RowBox[{"y", ",", "\[CurlyEpsilon]", ",", 
    RowBox[{"Exponent", "[", 
     RowBox[{"y", ",", "\[CurlyEpsilon]"}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.543025835230386*^9, {3.543025907772746*^9, 3.543025920400961*^9}, 
   3.5430259792183237`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Series products  ---    \[LeftAngleBracket] , \[RightAngleBracket]  and \
 \[CircleTimes]  of   SeriesData[ ]", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
  3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
  3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
  3.48042476399629*^9, 3.480424778951466*^9}, {3.480424840490856*^9, 
  3.480424892398905*^9}, {3.480425254979428*^9, 3.480425273632887*^9}, {
  3.542597889881175*^9, 3.542597952866296*^9}, {3.54302328142829*^9, 
  3.543023300435913*^9}, {3.543023346451642*^9, 3.543023349012022*^9}}],

Cell["\<\

The container   SeriesData   has  some automatic simplifications,

    -  if SeriesData is given a list of coefficients that has leading zeros \
then these are truncated and the 4th argument (first power) is adjusted \
accordingly.
    -  if SeriesData is given a list with trailing zeros, then these are \
truncated (no other arguments are changed).  Short lists are interpreted as \
being padded by zeros at the end.
    -  if  SeriesData  is given a list that is longer than necessary (as \
specified by 4th and 5th args) then the list is truncated by removing  \
elements from the end.
    -  if  Series[ ]  is applied to (compatible)  SeriesData  then no \
computations are done (fast).  The only possible change is that 5th argument \
may decrease (order may be lowered).\
\>", "Text",
 CellChangeTimes->{{3.620601241488578*^9, 3.620601440753858*^9}, {
   3.620601508721998*^9, 3.620601569234074*^9}, {3.620601604881969*^9, 
   3.620601734659137*^9}, {3.6206017679258823`*^9, 3.6206019738963833`*^9}, {
   3.620602078836175*^9, 3.620602294612969*^9}, {3.620602351813032*^9, 
   3.620602496053816*^9}, 3.620604749710458*^9, {3.6206732885980253`*^9, 
   3.620673602965149*^9}, 3.655411409092565*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SeriesOrder", "[", "s_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}], ",", 
    RowBox[{"s", "[", 
     RowBox[{"[", "5", "]"}], "]"}], ",", "Infinity"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SeriesNmax", "=", "SeriesOrder"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206065787786207`*^9, 3.620606696739326*^9}, {
  3.620607076604245*^9, 3.620607076672234*^9}, {3.620639972789323*^9, 
  3.620639974323299*^9}}],

Cell["\<\
This will return the degree of the first term in the series for  s  in  x  \
about x0  (default x0=0), \
\>", "Text",
 CellChangeTimes->{{3.6206399033425007`*^9, 3.62063990676637*^9}, {
  3.6206399826384983`*^9, 3.620639987294775*^9}, {3.620640025502677*^9, 
  3.620640051022912*^9}, {3.620640534719988*^9, 3.6206406439363537`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesNmin", "[", "s_SeriesData", "]"}], ":=", 
  RowBox[{"s", "[", 
   RowBox[{"[", "4", "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620639998166769*^9, 3.6206400137472*^9}, {
  3.620640833109913*^9, 3.620640833605555*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesNmin", "[", 
   RowBox[{"s_", ",", "x_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}], ",", 
    RowBox[{"s", "[", 
     RowBox[{"[", "4", "]"}], "]"}], ",", 
    RowBox[{
     RowBox[{"Part", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"O", "[", "x", "]"}], "s"}], ",", "4"}], "]"}], "-", "1"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206065787786207`*^9, 3.620606696739326*^9}, {
  3.620607076604245*^9, 3.620607076672234*^9}, {3.6206395585323563`*^9, 
  3.62063955966751*^9}, {3.6206396570438023`*^9, 3.62063968888384*^9}, {
  3.620639762643778*^9, 3.62063976426025*^9}, {3.6206398054924917`*^9, 
  3.620639878454509*^9}, {3.620640319352429*^9, 3.620640319576008*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesNmin", "[", 
   RowBox[{"s_", ",", "x_", ",", "x0_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}], ",", 
    RowBox[{"s", "[", 
     RowBox[{"[", "4", "]"}], "]"}], ",", 
    RowBox[{"Part", "[", 
     RowBox[{
      RowBox[{"s", " ", 
       RowBox[{"SeriesData", "[", 
        RowBox[{"x", ",", "x0", ",", 
         RowBox[{"{", "}"}], ",", "0", ",", "0", ",", "1"}], "]"}]}], ",", 
      "4"}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206400715910387`*^9, 3.620640138489313*^9}, {
  3.620640269065136*^9, 3.620640281304688*^9}, {3.620673072633534*^9, 
  3.620673119070313*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesNdiff", "[", "s_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}], ",", 
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"[", "5", "]"}], "]"}], "-", 
     RowBox[{"s", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], ",", "Infinity"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620641174363535*^9, 3.620641194427869*^9}, {
  3.620641227207238*^9, 3.620641244413369*^9}}],

Cell[CellGroupData[{

Cell["Examples of  SeriesNmin  and  SeriesNmax", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620671549457225*^9, 3.6206715743373537`*^9}, 
   3.65541072793285*^9}],

Cell[TextData[{
 "SeriesNmin[ ]   is useful because it is not otherwise obvious how to work \
out what the degree of the first term in a series is going to be.\nEg. \
Without guessing an order and possibly calculating lots of terms in a series, \
how does one find that the following starts at  ",
 Cell[BoxData[
  FormBox[
   RowBox[{"1", "/", 
    SuperscriptBox["x", "7"]}], TraditionalForm]]],
 " ?  "
}], "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206716096694193`*^9, 3.620671653057558*^9}, {
   3.620671704290002*^9, 3.620671881538354*^9}, {3.620672043010418*^9, 
   3.6206721248025427`*^9}, {3.6206721568983507`*^9, 3.620672243243293*^9}, {
   3.6206723296213827`*^9, 3.6206723568029213`*^9}, 3.655410727932889*^9}],

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{
       RowBox[{"Exp", "[", "x", "]"}], "-", "1"}], ")"}], "10"], 
    RowBox[{
     SuperscriptBox[
      RowBox[{"Log", "[", 
       RowBox[{"x", "+", "1"}], "]"}], "3"], "/", 
     SuperscriptBox[
      RowBox[{"Sin", "[", "x", "]"}], "20"]}]}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "0", ",", "0"}], "}"}]}], "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672128583531*^9, 3.620672168283023*^9}, 
   3.655410727932927*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   FractionBox["1", 
    SuperscriptBox["x", "7"]], "+", 
   FractionBox["7", 
    RowBox[{"2", " ", 
     SuperscriptBox["x", "6"]}]], "+", 
   FractionBox["21", 
    RowBox[{"2", " ", 
     SuperscriptBox["x", "5"]}]], "+", 
   FractionBox["265", 
    RowBox[{"12", " ", 
     SuperscriptBox["x", "4"]}]], "+", 
   FractionBox["30007", 
    RowBox[{"720", " ", 
     SuperscriptBox["x", "3"]}]], "+", 
   FractionBox["95461", 
    RowBox[{"1440", " ", 
     SuperscriptBox["x", "2"]}]], "+", 
   FractionBox["655061", 
    RowBox[{"6720", " ", "x"}]], "+", 
   FractionBox["443905", "3456"], "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", "x", "]"}], "1"],
    SeriesData[$CellContext`x, 0, {}, -7, 1, 1],
    Editable->False]}],
  SeriesData[$CellContext`x, 0, {1, 
    Rational[7, 2], 
    Rational[21, 2], 
    Rational[265, 12], 
    Rational[30007, 720], 
    Rational[95461, 1440], 
    Rational[655061, 6720], 
    Rational[443905, 3456]}, -7, 1, 1],
  Editable->False]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672148963849*^9, 3.620672169008009*^9}, 
   3.655410727932968*^9}],

Cell["The trick is to do this,", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206724015735817`*^9, 3.620672410962881*^9}, 
   3.655410727932992*^9}],

Cell[BoxData[{
 RowBox[{
  SuperscriptBox[
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Exp", "[", "x", "]"}], "-", "1"}], ")"}], "10"], 
  RowBox[{
   SuperscriptBox[
    RowBox[{"Log", "[", 
     RowBox[{"x", "+", "1"}], "]"}], "3"], "/", 
   SuperscriptBox[
    RowBox[{"Sin", "[", "x", "]"}], "20"]}], 
  RowBox[{"O", "[", "x", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"%", "//", "FullForm"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672418744632*^9, 3.620672464106513*^9}, 
   3.655410727933015*^9}],

Cell[BoxData[
 InterpretationBox[
  FractionBox["1", 
   SuperscriptBox[
    RowBox[{"O", "[", "x", "]"}], "6"]],
  SeriesData[$CellContext`x, 0, {}, -6, -6, 1],
  Editable->False]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672423703062*^9, 3.6206724647674103`*^9}, 
   3.655410727933043*^9}],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"SeriesData", "[", 
    RowBox[{"x", ",", "0", ",", 
     RowBox[{"List", "[", "]"}], ",", 
     RowBox[{"-", "6"}], ",", 
     RowBox[{"-", "6"}], ",", "1"}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672423703062*^9, 3.6206724647751913`*^9}, 
   3.655410727933072*^9}],

Cell["\<\
If the expansion point is not 0, then the above is a little more complicated \
because this does not work,\
\>", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206724015735817`*^9, 3.620672410962881*^9}, {
   3.620672520962524*^9, 3.6206725528994293`*^9}, {3.620672655075238*^9, 
   3.620672700403552*^9}, 3.655410727933098*^9}],

Cell[BoxData[
 RowBox[{"O", "[", 
  RowBox[{"x", "-", "x0"}], "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672615095235*^9, 3.6206726183109426`*^9}, {
   3.62067271587943*^9, 3.620672719527367*^9}, 3.65541072793312*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"SeriesData", "::", "sdatv"}], "MessageName"], ":", 
  " ", "\<\"First argument \[NoBreak]\\!\\(\\(\\(-1\\)\\) + x\\)\[NoBreak] is \
not a valid variable. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/SeriesData/sdatv\\\", ButtonNote -> \
\\\"SeriesData::sdatv\\\"]\\)\"\>"}]], "Message", "MSG",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206727128633127`*^9, 3.6206727204228153`*^9}, 
   3.655410727933159*^9}],

Cell[BoxData[
 InterpretationBox[
  SuperscriptBox[
   RowBox[{"O", "[", 
    RowBox[{
     RowBox[{"-", "1"}], "+", "x"}], "]"}], "1"],
  SeriesData[-1 + $CellContext`x, 0, {}, 1, 1, 1],
  Editable->False]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672712869577*^9, 3.620672720429734*^9}, 
   3.655410727933189*^9}],

Cell["To make an  O[ x - x0 ]   requires this result,", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206724015735817`*^9, 3.620672410962881*^9}, {
   3.620672520962524*^9, 3.6206725528994293`*^9}, {3.620672738355461*^9, 
   3.620672762228609*^9}, {3.6206727974277573`*^9, 3.620672800531732*^9}, 
   3.655410727933214*^9}],

Cell[BoxData[{
 RowBox[{"Series", "[", 
  RowBox[{
   RowBox[{"x", "-", "x0"}], ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "x0", ",", "0"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"%", "//", "FullForm"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620640150101565*^9, 3.620640150308002*^9}, 
   3.620640260904942*^9, 3.620672563241043*^9, {3.620672771048661*^9, 
   3.620672780044004*^9}, 3.655410727933237*^9}],

Cell[BoxData[
 InterpretationBox[
  SuperscriptBox[
   RowBox[{"O", "[", 
    RowBox[{"x", "-", "x0"}], "]"}], "1"],
  SeriesData[$CellContext`x, $CellContext`x0, {}, 1, 1, 1],
  Editable->False]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206401455929823`*^9, 3.620640150963243*^9}, 
   3.620640207398859*^9, {3.620640240095298*^9, 3.620640261591905*^9}, 
   3.6206725638384447`*^9, {3.620672774915305*^9, 3.620672782162627*^9}, 
   3.620672838830039*^9, 3.655410727933262*^9}],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"SeriesData", "[", 
    RowBox[{"x", ",", "x0", ",", 
     RowBox[{"List", "[", "]"}], ",", "1", ",", "1", ",", "1"}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206401455929823`*^9, 3.620640150963243*^9}, 
   3.620640207398859*^9, {3.620640240095298*^9, 3.620640261591905*^9}, 
   3.6206725638384447`*^9, {3.620672774915305*^9, 3.620672782162627*^9}, 
   3.620672838838293*^9, 3.655410727933289*^9}],

Cell["therefore we can use either of,", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206724015735817`*^9, 3.620672410962881*^9}, {
   3.620672520962524*^9, 3.6206725528994293`*^9}, {3.620672738355461*^9, 
   3.620672813539742*^9}, {3.620672942611763*^9, 3.6206729462309103`*^9}, 
   3.6554107279333143`*^9}],

Cell[BoxData[{
 RowBox[{
  StyleBox[
   RowBox[{"SeriesData", "[", 
    RowBox[{"x", ",", "x0", ",", 
     RowBox[{"{", "}"}], ",", "1", ",", "1", ",", "1"}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True], "\[IndentingNewLine]", "\n"}], "\n", 
 StyleBox[
  RowBox[{"SeriesData", "[", 
   RowBox[{"x", ",", "x0", ",", 
    RowBox[{"{", "}"}], ",", "0", ",", "0", ",", "1"}], "]"}],
  ShowSpecialCharacters->False,
  ShowStringCharacters->True,
  NumberMarks->True]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672844058058*^9, 3.620672850363798*^9}, {
   3.620672928434038*^9, 3.620672937356441*^9}, 3.655410727933339*^9}],

Cell[BoxData[
 InterpretationBox[
  SuperscriptBox[
   RowBox[{"O", "[", 
    RowBox[{"x", "-", "x0"}], "]"}], "1"],
  SeriesData[$CellContext`x, $CellContext`x0, {}, 1, 1, 1],
  Editable->False]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.620672860158794*^9, 3.620672938274588*^9, 
  3.655410727933365*^9}],

Cell[BoxData[
 InterpretationBox[
  SuperscriptBox[
   RowBox[{"O", "[", 
    RowBox[{"x", "-", "x0"}], "]"}], "0"],
  SeriesData[$CellContext`x, $CellContext`x0, {}, 0, 0, 1],
  Editable->False]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.620672860158794*^9, 3.620672938281196*^9, 
  3.6554107279333963`*^9}],

Cell[BoxData[
 RowBox[{
  SuperscriptBox[
   RowBox[{"Sin", "[", 
    RowBox[{"x", "-", "x0"}], "]"}], "2"], 
  RowBox[{"SeriesData", "[", 
   RowBox[{"x", ",", "x0", ",", 
    RowBox[{"{", "}"}], ",", "0", ",", "0", ",", "1"}], "]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620672960177986*^9, 3.6206729695968437`*^9}, {
   3.620673002747925*^9, 3.6206730036105547`*^9}, 3.655410727933422*^9}],

Cell[BoxData[
 InterpretationBox[
  SuperscriptBox[
   RowBox[{"O", "[", 
    RowBox[{"x", "-", "x0"}], "]"}], "2"],
  SeriesData[$CellContext`x, $CellContext`x0, {}, 2, 2, 1],
  Editable->False]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.620672971447743*^9, 3.6206730052644863`*^9, 
  3.655410727933447*^9}],

Cell[BoxData[
 RowBox[{"SeriesNmin", "[", 
  RowBox[{
   SuperscriptBox[
    RowBox[{"Sin", "[", 
     RowBox[{"x", "-", "x0"}], "]"}], "2"], ",", "x", ",", "x0"}], 
  "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6206731440328903`*^9, 3.62067315756124*^9}, 
   3.655410727933474*^9}],

Cell[BoxData["2"], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.6206731581419764`*^9, 3.6554107279335003`*^9}],

Cell[BoxData[
 RowBox[{"SeriesNmin", "[", 
  RowBox[{
   RowBox[{"1", "/", 
    SuperscriptBox[
     RowBox[{"Sin", "[", "x", "]"}], "10"]}], ",", "x"}], "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620640328994529*^9, 3.620640339060486*^9}, {
   3.620640503557131*^9, 3.6206405131091137`*^9}, 3.655410727933527*^9}],

Cell[BoxData[
 RowBox[{"-", "10"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620640508069887*^9, 3.6206405138115273`*^9}, 
   3.6206732076194563`*^9, 3.65541072793356*^9}],

Cell[BoxData[{
 RowBox[{"SeriesNmin", "[", 
  RowBox[{"1", "+", "x", "+", 
   SuperscriptBox[
    RowBox[{"O", "[", "x", "]"}], "2"]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"SeriesNmax", "[", 
  RowBox[{"1", "+", "x", "+", 
   SuperscriptBox[
    RowBox[{"O", "[", "x", "]"}], "2"]}], "]"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620640783539228*^9, 3.6206408172695704`*^9}, 
   3.655410727933585*^9}],

Cell[BoxData["0"], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620640802415374*^9, 3.6206408381950827`*^9}, 
   3.620673211242572*^9, 3.655410727933609*^9}],

Cell[BoxData["2"], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620640802415374*^9, 3.6206408381950827`*^9}, 
   3.620673211250647*^9, 3.655410727933634*^9}]
}, Closed]],

Cell[BoxData[
 RowBox[{
  RowBox[{"CheckSeriesVariable", "[", 
   RowBox[{"x_", ",", "s_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{
        RowBox[{"s", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "===", "x"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "Print", "[", 
        "\"\<tpTensor: Series variables SeriesData[ ][[1]] must be the \
same:\>\"", "]"}], ";", 
       RowBox[{"Print", "[", 
        RowBox[{"s", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], ";", 
       RowBox[{"Print", "[", "x", "]"}], ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206072572523403`*^9, 3.620607383745493*^9}, {
   3.620607418429656*^9, 3.620607500322219*^9}, {3.620607565202612*^9, 
   3.620607565298748*^9}, {3.620607963716515*^9, 3.620608022196269*^9}, {
   3.620608057300623*^9, 3.62060814570223*^9}, {3.620608180246279*^9, 
   3.6206081873019657`*^9}, {3.620608275190384*^9, 3.620608344390023*^9}, 
   3.620608459942856*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"CheckSeriesPoint", "[", 
   RowBox[{"x0_", ",", "s_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{
        RowBox[{"s", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "===", "x0"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "Print", "[", 
        "\"\<tpTensor: Series expansion points SeriesData[ ][[2]] must be the \
same:\>\"", "]"}], ";", 
       RowBox[{"Print", "[", 
        RowBox[{"s", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}], ";", 
       RowBox[{"Print", "[", "x0", "]"}], ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206072572523403`*^9, 3.620607383745493*^9}, {
  3.620607418429656*^9, 3.620607500322219*^9}, {3.620607565202612*^9, 
  3.620607565298748*^9}, {3.620607963716515*^9, 3.620607969908772*^9}, {
  3.620608366053809*^9, 3.620608367765836*^9}, {3.620608455205674*^9, 
  3.620608472090197*^9}, {3.620608558598871*^9, 3.620608558694804*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"CheckSeriesDen", "[", 
   RowBox[{"den_", ",", "s_"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"!", 
       RowBox[{
        RowBox[{"s", "[", 
         RowBox[{"[", "6", "]"}], "]"}], "===", "den"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "Print", "[", 
        "\"\<tpTensor: Series denominator SeriesData[ ][[6]] must be the \
same:\>\"", "]"}], ";", 
       RowBox[{"Print", "[", 
        RowBox[{"s", "[", 
         RowBox[{"[", "6", "]"}], "]"}], "]"}], ";", 
       RowBox[{"Print", "[", "den", "]"}], ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206072572523403`*^9, 3.620607383745493*^9}, {
  3.620607418429656*^9, 3.620607500322219*^9}, {3.620607565202612*^9, 
  3.620607565298748*^9}, {3.620607963716515*^9, 3.620608022196269*^9}, {
  3.620608057300623*^9, 3.62060814570223*^9}, {3.620608180246279*^9, 
  3.6206081873019657`*^9}, {3.620608439751001*^9, 3.620608439818727*^9}, {
  3.620608492214356*^9, 3.620608541782979*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"CheckSeriesHeads", "[", "s_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"!", 
     RowBox[{
      RowBox[{"Head", "[", "s", "]"}], "===", "SeriesData"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Print", "[", 
      "\"\<SeriesProduct[ ]: The first argument must be a list of \
SeriesData[].\>\"", "]"}], ";", 
     RowBox[{"Abort", "[", "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206072572523403`*^9, 3.620607383745493*^9}, {
  3.620607418429656*^9, 3.620607500322219*^9}, {3.620607565202612*^9, 
  3.620607565298748*^9}, {3.620607963716515*^9, 3.620608022196269*^9}, {
  3.620608057300623*^9, 3.62060814570223*^9}, {3.620608180246279*^9, 
  3.6206081873019657`*^9}, {3.620608439751001*^9, 3.620608439818727*^9}, {
  3.620608492214356*^9, 3.620608541782979*^9}, {3.620614790267749*^9, 
  3.620614958792759*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"CircleTimes", "[", 
   RowBox[{"y1___", ",", "y_SeriesData", ",", "y2___"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "x", ",", "x0", ",", "a", ",", "nmin", ",", "nmax", ",", "den", ",", 
      "Y1", ",", "Y2", ",", "ndiff", ",", "Oinfty"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "x0", ",", "nmin", ",", "nmax", ",", "den"}], "}"}], 
      " ", "=", " ", 
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "y"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "5", ",", "6"}], "}"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ndiff", "=", 
      RowBox[{"nmax", "-", "nmin"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CheckSeriesVariable", "[", 
         RowBox[{"x", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CheckSeriesPoint", "[", 
         RowBox[{"x0", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CheckSeriesDen", "[", 
         RowBox[{"den", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ndiff", " ", "=", " ", 
      RowBox[{"Min", "[", 
       RowBox[{"ndiff", ",", 
        RowBox[{"Map", "[", 
         RowBox[{"SeriesNdiff", ",", 
          RowBox[{"{", 
           RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Oinfty", "=", 
      RowBox[{"SeriesData", "[", 
       RowBox[{"x", ",", "x0", ",", 
        RowBox[{"{", "}"}], ",", "1000000000", ",", "1000000000", ",", 
        "den"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Y1", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"#", ",", "x"}], "]"}], ",", 
           RowBox[{"#", "+", "Oinfty"}], ",", 
           RowBox[{"Series", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "x0", ",", 
               RowBox[{
                RowBox[{"SeriesNmin", "[", 
                 RowBox[{"#", ",", "x", ",", "x0"}], "]"}], "+", "ndiff", "-",
                 "1"}]}], "}"}]}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "y1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Y2", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"#", ",", "x"}], "]"}], ",", 
           RowBox[{"#", "+", "Oinfty"}], ",", 
           RowBox[{"Series", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "x0", ",", 
               RowBox[{
                RowBox[{"SeriesNmin", "[", 
                 RowBox[{"#", ",", "x", ",", "x0"}], "]"}], "+", "ndiff", "-",
                 "1"}]}], "}"}]}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "y2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"SeriesProduct", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{"Y1", ",", 
         RowBox[{"{", "y", "}"}], ",", "Y2"}], "]"}], ",", "CircleTimes"}], 
      "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.62060418702486*^9, {3.620604290033472*^9, 3.620604323553752*^9}, {
   3.620604949544601*^9, 3.6206049648352222`*^9}, 3.620605001491321*^9, {
   3.6206051242096453`*^9, 3.620605137989251*^9}, {3.6206051884218693`*^9, 
   3.620605290998798*^9}, {3.620605470410029*^9, 3.6206055541394777`*^9}, {
   3.6206056316594477`*^9, 3.620605646140029*^9}, {3.6206060098053293`*^9, 
   3.620606061840461*^9}, {3.620606130174995*^9, 3.6206061654072*^9}, 
   3.620606531363677*^9, {3.620606756340592*^9, 3.620606797414596*^9}, {
   3.620606841861888*^9, 3.620606910342968*^9}, {3.620608218169628*^9, 
   3.620608234111721*^9}, {3.620608580998172*^9, 3.620608608066052*^9}, {
   3.62060871320133*^9, 3.620608720977579*^9}, {3.620608853604422*^9, 
   3.620608863874607*^9}, {3.620608929811309*^9, 3.620609001026784*^9}, 
   3.620609793877475*^9, {3.620611227290434*^9, 3.620611266687092*^9}, {
   3.620611318749031*^9, 3.620611335057078*^9}, 3.6206113654522533`*^9, {
   3.6206328173186283`*^9, 3.620632834886106*^9}, {3.620634360198926*^9, 
   3.6206343642475243`*^9}, {3.620634404119645*^9, 3.620634444858255*^9}, {
   3.620634488953484*^9, 3.620634520974331*^9}, {3.62063464247719*^9, 
   3.620634649725305*^9}, {3.620634744750986*^9, 3.620634783854838*^9}, {
   3.620634850237249*^9, 3.620634857053491*^9}, {3.620634895564625*^9, 
   3.620634897630228*^9}, {3.620634964078595*^9, 3.620634986454042*^9}, {
   3.62063507520191*^9, 3.620635078032633*^9}, {3.620635725312393*^9, 
   3.620635784170568*^9}, 3.62063587402805*^9, {3.620640968389412*^9, 
   3.6206409858508244`*^9}, {3.6206410436286507`*^9, 3.620641072810062*^9}, {
   3.620641286378394*^9, 3.620641351754053*^9}, {3.620641401674748*^9, 
   3.6206415603380833`*^9}, 3.620641833468594*^9, {3.620641867600016*^9, 
   3.620641996129047*^9}, {3.620642047921074*^9, 3.620642212300742*^9}, {
   3.620642274855505*^9, 3.6206422839412327`*^9}, {3.620642457942499*^9, 
   3.620642506997933*^9}, {3.620642544390493*^9, 3.620642637927188*^9}, {
   3.6206426882466173`*^9, 3.620642719141982*^9}, {3.6206428799898252`*^9, 
   3.6206428827544003`*^9}, {3.6206432755117397`*^9, 3.620643292920122*^9}, {
   3.620643371286317*^9, 3.620643392151471*^9}, {3.620669324412462*^9, 
   3.620669335398712*^9}, 3.6206712546895933`*^9, {3.620721546559342*^9, 
   3.620721580224678*^9}}],

Cell[TextData[{
 "Need to check that there are 2 or more args, else we capture  ",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", "   ", "\[RightAngleBracket]"}], "ab"], 
   TraditionalForm]]],
 " by mistake,"
}], "Text",
 CellChangeTimes->{{3.620678561530829*^9, 3.62067868379247*^9}, {
  3.6206792618276663`*^9, 3.620679300801936*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AngleBracket", "[", 
    RowBox[{"y1___", ",", "y_SeriesData", ",", "y2___"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"{", 
      RowBox[{"y1", ",", "y2"}], "}"}], "]"}], ">", "0"}]}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "x", ",", "x0", ",", "a", ",", "nmin", ",", "nmax", ",", "den", ",", 
      "Y1", ",", "Y2", ",", "ndiff", ",", "Oinfty"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "x0", ",", "nmin", ",", "nmax", ",", "den"}], "}"}], 
      " ", "=", " ", 
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{"List", ",", "y"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "5", ",", "6"}], "}"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ndiff", "=", 
      RowBox[{"nmax", "-", "nmin"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CheckSeriesVariable", "[", 
         RowBox[{"x", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CheckSeriesPoint", "[", 
         RowBox[{"x0", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"CheckSeriesDen", "[", 
         RowBox[{"den", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ndiff", " ", "=", " ", 
      RowBox[{"Min", "[", 
       RowBox[{"ndiff", ",", 
        RowBox[{"Map", "[", 
         RowBox[{"SeriesNdiff", ",", 
          RowBox[{"{", 
           RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Oinfty", "=", 
      RowBox[{"SeriesData", "[", 
       RowBox[{"x", ",", "x0", ",", 
        RowBox[{"{", "}"}], ",", "1000000000", ",", "1000000000", ",", 
        "den"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Y1", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"#", ",", "x"}], "]"}], ",", 
           RowBox[{"#", "+", "Oinfty"}], ",", 
           RowBox[{"Series", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "x0", ",", 
               RowBox[{
                RowBox[{"SeriesNmin", "[", 
                 RowBox[{"#", ",", "x", ",", "x0"}], "]"}], "+", "ndiff", "-",
                 "1"}]}], "}"}]}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "y1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Y2", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"#", ",", "x"}], "]"}], ",", 
           RowBox[{"#", "+", "Oinfty"}], ",", 
           RowBox[{"Series", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "x0", ",", 
               RowBox[{
                RowBox[{"SeriesNmin", "[", 
                 RowBox[{"#", ",", "x", ",", "x0"}], "]"}], "+", "ndiff", "-",
                 "1"}]}], "}"}]}], "]"}]}], "]"}], "&"}], ",", 
        RowBox[{"{", "y2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"SeriesProduct", "[", 
      RowBox[{
       RowBox[{"Join", "[", 
        RowBox[{"Y1", ",", 
         RowBox[{"{", "y", "}"}], ",", "Y2"}], "]"}], ",", "AngleBracket"}], 
      "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.62060418702486*^9, {3.620604290033472*^9, 3.620604323553752*^9}, {
   3.620604949544601*^9, 3.6206049648352222`*^9}, 3.620605001491321*^9, {
   3.6206051242096453`*^9, 3.620605137989251*^9}, {3.6206051884218693`*^9, 
   3.620605290998798*^9}, {3.620605470410029*^9, 3.6206055541394777`*^9}, {
   3.6206056316594477`*^9, 3.620605646140029*^9}, {3.6206060098053293`*^9, 
   3.620606061840461*^9}, {3.620606130174995*^9, 3.6206061654072*^9}, 
   3.620606531363677*^9, {3.620606756340592*^9, 3.620606797414596*^9}, {
   3.620606841861888*^9, 3.620606910342968*^9}, {3.620608218169628*^9, 
   3.620608234111721*^9}, {3.620608580998172*^9, 3.620608608066052*^9}, {
   3.62060871320133*^9, 3.620608720977579*^9}, {3.620608853604422*^9, 
   3.620608863874607*^9}, {3.620608929811309*^9, 3.620609001026784*^9}, 
   3.620609793877475*^9, {3.620611227290434*^9, 3.620611266687092*^9}, {
   3.620611318749031*^9, 3.620611335057078*^9}, 3.6206113654522533`*^9, {
   3.6206328173186283`*^9, 3.620632834886106*^9}, {3.620634360198926*^9, 
   3.6206343642475243`*^9}, {3.620634404119645*^9, 3.620634444858255*^9}, {
   3.620634488953484*^9, 3.620634520974331*^9}, {3.62063464247719*^9, 
   3.620634649725305*^9}, {3.620634744750986*^9, 3.620634783854838*^9}, {
   3.620634850237249*^9, 3.620634857053491*^9}, {3.620634895564625*^9, 
   3.620634897630228*^9}, {3.620634964078595*^9, 3.620634986454042*^9}, {
   3.62063507520191*^9, 3.620635078032633*^9}, {3.620635725312393*^9, 
   3.620635784170568*^9}, 3.62063587402805*^9, {3.620640968389412*^9, 
   3.6206409858508244`*^9}, {3.6206410436286507`*^9, 3.620641072810062*^9}, {
   3.620641286378394*^9, 3.620641351754053*^9}, {3.620641401674748*^9, 
   3.6206415603380833`*^9}, 3.620641833468594*^9, {3.620641867600016*^9, 
   3.620641996129047*^9}, {3.620642047921074*^9, 3.620642212300742*^9}, {
   3.620642274855505*^9, 3.6206422839412327`*^9}, {3.620642457942499*^9, 
   3.620642506997933*^9}, {3.620642544390493*^9, 3.620642637927188*^9}, {
   3.6206426882466173`*^9, 3.620642719141982*^9}, {3.6206428799898252`*^9, 
   3.6206428827544003`*^9}, {3.6206432755117397`*^9, 3.620643292920122*^9}, {
   3.620643371286317*^9, 3.620643392151471*^9}, {3.620669324412462*^9, 
   3.620669335398712*^9}, 3.6206712546895933`*^9, {3.620671326274201*^9, 
   3.6206713536947107`*^9}, {3.6206789651059732`*^9, 3.620678992033043*^9}}],

Cell["\<\
This takes a list of  SeriesData  elements and forms  their product  w.r.t.  \
prod[ , .. , ] ,\
\>", "Text",
 CellChangeTimes->{{3.620610584241728*^9, 3.620610641794363*^9}, {
  3.620610867186845*^9, 3.6206109073632793`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesProduct", "[", 
   RowBox[{"y_List", ",", "prod_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "a", ",", "x", ",", "x0", ",", "nmin", ",", "nmax", ",", "den", ",", "p",
       ",", "i", ",", "j", ",", "n1min", ",", "n1max", ",", "n2min", ",", 
      "n2max", ",", "a1", ",", "a2", ",", "n", ",", "n1", ",", "n2", ",", 
      "y1", ",", "y2", ",", "j1max", ",", "j2max", ",", "j1", ",", "j2"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Map", "[", 
      RowBox[{"CheckSeriesHeads", ",", "y"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "y", "]"}], "===", "1"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"y", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"y1", "=", 
      RowBox[{"Apply", "[", 
       RowBox[{"List", ",", 
        RowBox[{"y", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"y2", "=", 
      RowBox[{"Apply", "[", 
       RowBox[{"List", ",", 
        RowBox[{"y", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "x0", ",", "n1min", ",", "n1max", ",", "den"}], 
       "}"}], " ", "=", " ", 
      RowBox[{"y1", "[", 
       RowBox[{"[", 
        RowBox[{"{", 
         RowBox[{"1", ",", "2", ",", "4", ",", "5", ",", "6"}], "}"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"CheckSeriesVariable", "[", 
      RowBox[{"x", ",", 
       RowBox[{"y", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"CheckSeriesPoint", "[", 
      RowBox[{"x0", ",", 
       RowBox[{"y", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"CheckSeriesDen", "[", 
      RowBox[{"den", ",", 
       RowBox[{"y", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n2min", ",", "n2max"}], "}"}], " ", "=", " ", 
      RowBox[{"y2", "[", 
       RowBox[{"[", 
        RowBox[{"{", 
         RowBox[{"4", ",", "5"}], "}"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"nmin", " ", "=", " ", 
      RowBox[{"n1min", "+", "n2min"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nmax", " ", "=", " ", 
      RowBox[{"Min", "[", 
       RowBox[{
        RowBox[{"n1max", "+", "n2min"}], ",", 
        RowBox[{"n2max", "+", "n1min"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a1", "=", 
      RowBox[{"y1", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a2", "=", 
      RowBox[{"y2", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"j1max", "=", 
      RowBox[{"Length", "[", "a1", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"j2max", "=", 
      RowBox[{"Length", "[", "a2", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", " ", 
      RowBox[{"Table", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"j1max", " ", "j2max"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"n", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"j1", "-", "1", "+", "n1min"}], ")"}], "+", 
          RowBox[{"(", 
           RowBox[{"j2", "-", "1", "+", "n2min"}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"n", "\[LessEqual]", 
           RowBox[{"nmax", "-", "1"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"a", "[", 
            RowBox[{"[", 
             RowBox[{"n", "-", "nmin", "+", "1"}], "]"}], "]"}], "+=", 
           RowBox[{"prod", "[", 
            RowBox[{
             RowBox[{"Part", "[", 
              RowBox[{"a1", ",", "j1"}], "]"}], ",", 
             RowBox[{"Part", "[", 
              RowBox[{"a2", ",", "j2"}], "]"}]}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"j1", ",", "j1max"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"j2", ",", "j2max"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "y", "]"}], "===", "2"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"SeriesData", "[", 
         RowBox[{
         "x", ",", "x0", ",", "a", ",", "nmin", ",", "nmax", ",", "den"}], 
         "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"SeriesProduct", "[", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"Rest", "[", 
          RowBox[{"Rest", "[", "y", "]"}], "]"}], ",", 
         RowBox[{"SeriesData", "[", 
          RowBox[{
          "x", ",", "x0", ",", "a", ",", "nmin", ",", "nmax", ",", "den"}], 
          "]"}]}], "]"}], ",", "prod"}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620609799826454*^9, 3.620609981154174*^9}, {
   3.62061137519645*^9, 3.6206114694583683`*^9}, {3.620611501026474*^9, 
   3.620611523475366*^9}, {3.620611605812455*^9, 3.6206116076511707`*^9}, {
   3.6206116424334173`*^9, 3.620611804698715*^9}, {3.620611976395523*^9, 
   3.620612024318777*^9}, {3.6206120646049*^9, 3.620612088605299*^9}, {
   3.620612121533495*^9, 3.620612150781444*^9}, {3.62061249230196*^9, 
   3.620612492958606*^9}, {3.6206126687679996`*^9, 3.620612785680591*^9}, {
   3.620612815854794*^9, 3.620612925920085*^9}, {3.6206131381446466`*^9, 
   3.620613188354073*^9}, {3.620613219555757*^9, 3.620613430695313*^9}, {
   3.620613528264248*^9, 3.620613569626845*^9}, {3.62061361710037*^9, 
   3.620613656364135*^9}, {3.620613776349371*^9, 3.620613798267084*^9}, {
   3.620613833596092*^9, 3.620613906141906*^9}, {3.6206144253454237`*^9, 
   3.620614490302504*^9}, {3.620614530904221*^9, 3.620614569137405*^9}, {
   3.620614625299955*^9, 3.6206146389949703`*^9}, {3.620615032653448*^9, 
   3.620615057364451*^9}, {3.6206151773982058`*^9, 3.6206152099907713`*^9}, {
   3.620615241847583*^9, 3.620615247431632*^9}, {3.62061531074125*^9, 
   3.620615339433964*^9}, {3.6206157772767143`*^9, 3.6206157874344788`*^9}, {
   3.620615950596306*^9, 3.620615961292564*^9}, {3.6206160419653788`*^9, 
   3.62061609719766*^9}, {3.6206161419825363`*^9, 3.620616217871916*^9}, {
   3.620617218901063*^9, 3.620617223904004*^9}, {3.6206172675733223`*^9, 
   3.620617273854631*^9}, {3.620617538221987*^9, 3.6206175522738123`*^9}, {
   3.620617852895665*^9, 3.620617868924148*^9}, {3.620617960092877*^9, 
   3.620617985505522*^9}, {3.620618018032551*^9, 3.620618037892474*^9}, {
   3.620618104361307*^9, 3.620618223587002*^9}, {3.620630679067544*^9, 
   3.620630731756164*^9}, {3.620634077354156*^9, 3.6206340900269136`*^9}, 
   3.620635071757413*^9, {3.6206697738177023`*^9, 3.620669822745305*^9}, 
   3.6206698579407377`*^9, {3.620669905405583*^9, 3.620669914264398*^9}, {
   3.6206699840995293`*^9, 3.620669999481048*^9}, {3.6206701322923403`*^9, 
   3.620670178503872*^9}, {3.620670225574748*^9, 3.62067030780021*^9}, {
   3.62067034556682*^9, 3.620670370349259*^9}, {3.620670423391242*^9, 
   3.620670460427826*^9}, {3.6206705717980137`*^9, 3.62067059089296*^9}, {
   3.620670654585763*^9, 3.620670682683901*^9}, {3.620670747724918*^9, 
   3.6206708370245743`*^9}, {3.620670878926689*^9, 3.620670892836032*^9}, {
   3.620670936703389*^9, 3.6206709709413023`*^9}, {3.6206710124519463`*^9, 
   3.6206710501627274`*^9}, {3.620671086192074*^9, 3.620671142802598*^9}, {
   3.620671187024438*^9, 3.620671189647727*^9}, {3.6206712331807013`*^9, 
   3.6206712619312057`*^9}, {3.620714856136363*^9, 3.6207149203629704`*^9}, {
   3.620714974763075*^9, 3.620714978699506*^9}, {3.6207216279362793`*^9, 
   3.620721671143585*^9}, {3.6207229121754427`*^9, 3.620722930798276*^9}, {
   3.6207229731854267`*^9, 3.6207229865750504`*^9}, 3.620723087383519*^9, {
   3.620723161598195*^9, 3.6207231736325197`*^9}, {3.6207232275962353`*^9, 
   3.620723284866961*^9}, {3.620723365208997*^9, 3.62072337264445*^9}, {
   3.62072356576217*^9, 3.620723575018663*^9}, {3.6207237274569387`*^9, 
   3.6207237474882298`*^9}, 3.620723824822536*^9, 3.620723901643175*^9, {
   3.620723933293086*^9, 3.620723955292489*^9}, {3.6207240368708553`*^9, 
   3.6207240459453897`*^9}, {3.620724106377001*^9, 3.620724110964624*^9}, {
   3.620724350050157*^9, 3.620724357329578*^9}, {3.620728938008267*^9, 
   3.620728946669116*^9}, {3.6207290027746277`*^9, 3.62072901266082*^9}, {
   3.620729123876745*^9, 3.620729131818272*^9}, 3.620729170475779*^9, {
   3.62072922174214*^9, 3.620729292660462*^9}, {3.6207293830149937`*^9, 
   3.620729396148345*^9}, {3.6207294751387873`*^9, 3.62072954192452*^9}, 
   3.620729597352233*^9, 3.62072967187541*^9, 3.620729755541275*^9, {
   3.620731661587414*^9, 3.620731676969639*^9}}],

Cell[CellGroupData[{

Cell["Testing", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6209438129066772`*^9, 3.620943818090733*^9}, 
   3.655410622078269*^9, 3.655411110375834*^9}],

Cell["Code for debugging   SeriesProduct[ ] ,", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620729722467533*^9, 3.620729739171715*^9}, 
   3.655411110375869*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<y = \>\"", ",", "y"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<{y1,y2} = \>\"", ",", 
      RowBox[{"{", 
       RowBox[{"y1", ",", "y2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"Print", "[", 
     RowBox[{"\"\<{a1,a2} = \>\"", ",", 
      RowBox[{"{", 
       RowBox[{"a1", ",", "a2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
    
    RowBox[{"Print", "[", 
     RowBox[{"\"\<a = \>\"", ",", "a"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<j1max,j2max = \>\"", ",", 
      RowBox[{"{", 
       RowBox[{"j1max", ",", "j2max"}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<n1min,n2min = \>\"", ",", 
      RowBox[{"{", 
       RowBox[{"n1min", ",", "n2min"}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<n1max,n2max = \>\"", ",", 
      RowBox[{"{", 
       RowBox[{"n1max", ",", "n2max"}], "}"}]}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"\"\<nmin,nmax = \>\"", ",", 
      RowBox[{"{", 
       RowBox[{"nmin", ",", "nmax"}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620729688451016*^9, 3.620729702038043*^9}, 
   3.655411110375905*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "/", 
          SuperscriptBox["x", "2"]}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "2"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "/", 
        SuperscriptBox["x", "2"]}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "2"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "3"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "3"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "6"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "6"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}]}], "]"}]}]}], "}"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620618457296796*^9, 3.620618472683177*^9}, {
   3.620618505862013*^9, 3.620618528229129*^9}, {3.6206303833500643`*^9, 
   3.620630556571783*^9}, 3.655411110375928*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"True", ",", "True", ",", "True", ",", "True", ",", "True"}], 
  "}"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{
  3.620618478343733*^9, {3.620618513237584*^9, 3.620618534829191*^9}, 
   3.620630386035816*^9, {3.620630537099367*^9, 3.620630557701448*^9}, 
   3.6206430018837757`*^9, 3.6206714541043158`*^9, 3.620721432840026*^9, 
   3.65541111037597*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Sin", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", "\[IndentingNewLine]", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Sin", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Sin", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "/", 
          SuperscriptBox["x", "2"]}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "2"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", "\[IndentingNewLine]", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Sin", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "/", 
        SuperscriptBox["x", "2"]}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "2"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Sin", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", "\[IndentingNewLine]", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Sin", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Sin", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "3"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", "\[IndentingNewLine]", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Sin", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "/", "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "3"]}]}], "]"}]}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SeriesProduct", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Sin", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "6"]}], ",", 
        RowBox[{
         RowBox[{"-", "1"}], "-", "x", "+", 
         RowBox[{"Exp", "[", "x", "]"}], "+", 
         SuperscriptBox[
          RowBox[{"O", "[", "x", "]"}], "4"]}]}], "}"}], ",", "Times"}], 
     "]"}], " ", "===", " ", "\[IndentingNewLine]", 
    RowBox[{"Times", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Sin", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Exp", "[", "x", "]"}], "x"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "6"]}], ",", 
      RowBox[{
       RowBox[{"-", "1"}], "-", "x", "+", 
       RowBox[{"Exp", "[", "x", "]"}], "+", 
       SuperscriptBox[
        RowBox[{"O", "[", "x", "]"}], "4"]}]}], "]"}]}]}], "}"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.620618457296796*^9, 3.620618472683177*^9}, {
   3.620618505862013*^9, 3.620618528229129*^9}, {3.6206303833500643`*^9, 
   3.620630556571783*^9}, {3.620630603364588*^9, 3.620630657060061*^9}, 
   3.655411110375998*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"True", ",", "True", ",", "True", ",", "True", ",", "True"}], 
  "}"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.6206306609739523`*^9, 3.6206307536604147`*^9, 
  3.620643003394207*^9, 3.620671455608078*^9, 3.6207214361076107`*^9, 
  3.655411110376026*^9}]
}, Closed]],

Cell["\<\
This does not involve a product, but put it in this section anyway,\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.466847916785154*^9, 3.466847963126458*^9}, {
   3.466849851082079*^9, 3.466849868774017*^9}, {3.46684990227127*^9, 
   3.466849906894076*^9}, {3.467123863587689*^9, 3.467123898474958*^9}, {
   3.467125129193225*^9, 3.467125175983281*^9}, {3.47732316970613*^9, 
   3.477323172039878*^9}, {3.477326802385528*^9, 3.477326809629417*^9}, {
   3.47741837727008*^9, 3.4774184498067*^9}, {3.477418520366533*^9, 
   3.477418624421344*^9}, {3.48042492404146*^9, 3.480424932216714*^9}, {
   3.481625317066548*^9, 3.481625403015483*^9}, {3.481625671008399*^9, 
   3.481625697339016*^9}, {3.542597837377606*^9, 3.5425978721778107`*^9}, 
   3.543802096988064*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", "X_SeriesData", "\[RightAngleBracket]"}], 
    "ab__List"], ":=", " ", 
   RowBox[{"MapAt", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox[
          RowBox[{"\[LeftAngleBracket]", "#", "\[RightAngleBracket]"}], "ab"],
          "&"}], ",", "#"}], "]"}], "&"}], ",", "X", ",", "3"}], "]"}]}], 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.481624976568002*^9, 3.481625032012328*^9}, 
   3.481625083266623*^9, {3.481625119387152*^9, 3.481625132263241*^9}, {
   3.6149909114988947`*^9, 3.614990913604978*^9}, {3.6162773562683573`*^9, 
   3.616277368651552*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "188", "]"}]], "Output"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["The covariant derivative   \[Del]", "Subsection"],

Cell[CellGroupData[{

Cell["\[Del]  of Lists", "Subsubsection",
 CellChangeTimes->{{3.615688837216317*^9, 3.615688845968452*^9}, {
  3.651603466226446*^9, 3.651603470418151*^9}}],

Cell["Automatically  Thread[ ]    \[Del]  over  lists...", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467116374646419*^9, 3.46711642431634*^9}, {
   3.467119423750829*^9, 3.467119460749968*^9}, {3.467186837477058*^9, 
   3.467186891369089*^9}, {3.478623115099113*^9, 3.478623123578384*^9}, {
   3.478623240787001*^9, 3.478623321698911*^9}, {3.478623482060296*^9, 
   3.478623483425764*^9}, {3.478623755846329*^9, 3.478623762343056*^9}, 
   3.478628914224919*^9, {3.479360482937086*^9, 3.479360514821696*^9}, {
   3.479360759682127*^9, 3.479360774671672*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"Del", ",", "Listable"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479360521344418*^9, 3.479360524054623*^9}, {
   3.479360597240134*^9, 3.479360647518053*^9}, {3.479360780045141*^9, 
   3.479360787153321*^9}, 3.479933402237184*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Attributes", "[", "Del", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", "Listable", "}"}]], "Output",
 CellChangeTimes->{3.479360649972565*^9, 3.479360788899398*^9, 
  3.479454093628584*^9, 3.479919159863087*^9, 3.480312932166955*^9, 
  3.480317275182209*^9, 3.480328333364951*^9, 3.480328587394292*^9, 
  3.48033347495168*^9, 3.480333970585869*^9, 3.480334701293563*^9, 
  3.480661310952156*^9, 3.48066169547556*^9, 3.480662408946711*^9, 
  3.518081130932931*^9, 3.613716837273353*^9, 3.6137185098365383`*^9, 
  3.613718693059477*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"{", 
   RowBox[{"a", ",", "b"}], "}"}]}]], "Input",
 CellChangeTimes->{{3.479360803766204*^9, 3.479360809020298*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"\[Del]", "a"}], ",", 
   RowBox[{"\[Del]", "b"}]}], "}"}]], "Output",
 CellChangeTimes->{3.479360810640742*^9, 3.479454093645634*^9, 
  3.479919159878306*^9, 3.480312932284227*^9, 3.480317275190789*^9, 
  3.480328333370937*^9, 3.480328587523163*^9, 3.480333474956008*^9, 
  3.480333970591805*^9, 3.480334701299832*^9, 3.480661310956577*^9, 
  3.48066169552744*^9, 3.480662408952387*^9, 3.518081130938944*^9, 
  3.6137168373524647`*^9, 3.613718509895849*^9, 3.613718693110572*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Basic properties", "Subsubsection",
 CellChangeTimes->{{3.615692419014771*^9, 3.615692426977017*^9}, 
   3.615694526501811*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"deg", "[", 
   RowBox[{"\[Del]", " ", "v_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"deg", "[", "v", "]"}], "+", "1"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479116728438799*^9, 3.479116774661983*^9}, {
  3.479721986924529*^9, 3.479721986928494*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Del", "[", 
    RowBox[{"a_", "?", "NumericQ"}], "]"}], "=", "0"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.478630628351855*^9, {3.614640135757577*^9, 3.614640146828702*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Del", "[", "v_Plus", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"Del", ",", "v"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.478630657384687*^9}],

Cell["\<\
Times is Flat so each  f _ in the following can match multiple factors.
At most one of  the  f_  will have degree > 0.
The slot created by  \[Del] is last,\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467108658495781*^9, 3.467108704917168*^9}, {
   3.467113504208002*^9, 3.467113528841833*^9}, {3.467120271270797*^9, 
   3.467120319418405*^9}, {3.467284845922973*^9, 3.467284927392711*^9}, {
   3.467285683779427*^9, 3.467285767103554*^9}, {3.478630848755242*^9, 
   3.478630925812347*^9}, {3.478630997893272*^9, 3.478631017409254*^9}, {
   3.47863117479917*^9, 3.478631340254095*^9}, 3.478874272650542*^9, 
   3.479724792531641*^9, {3.615689455252488*^9, 3.615689468597186*^9}, {
   3.6156895309812603`*^9, 3.61568953517344*^9}, {3.615689629078068*^9, 
   3.615689745766449*^9}, {3.615692258262989*^9, 3.615692293798726*^9}, {
   3.615693546734583*^9, 3.615693604414901*^9}, {3.615694443029242*^9, 
   3.61569447181287*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Del", "[", 
   RowBox[{"f1_", " ", "f2_"}], "]"}], ":=", " ", 
  RowBox[{"Expand", "[", 
   RowBox[{
    RowBox[{"f1", "\[CircleTimes]", 
     RowBox[{"\[Del]", "f2"}]}], " ", "+", " ", 
    RowBox[{"f2", "\[CircleTimes]", 
     RowBox[{"\[Del]", "f1"}]}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{
   "x", ",", "f1", ",", "f2", ",", "f3", ",", "f4", ",", "f5", ",", "f6"}], 
   "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{"(", 
   RowBox[{"f1", " ", "f2", " ", "f3"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{"0", ",", 
   RowBox[{"{", 
    RowBox[{"f1", ",", "f2", ",", "f3", ",", "f4", ",", "f5", ",", "f6"}], 
    "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{"(", 
   RowBox[{"f1", " ", "f2", " ", "f3"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{"(", 
   RowBox[{"x", " ", "f1", " ", "f2", " ", "f3"}], ")"}]}]}], "Input",
 CellChangeTimes->{{3.615692441136372*^9, 3.615692466797406*^9}, {
  3.61569251467941*^9, 3.6156925685610943`*^9}, {3.615692864987311*^9, 
  3.6156928789102*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{"f2", " ", "f3"}], ")"}], "\[CircleTimes]", 
   RowBox[{"\[Del]", "f1"}]}], "+", 
  RowBox[{"f1", "\[CircleTimes]", "f2", "\[CircleTimes]", 
   RowBox[{"\[Del]", "f3"}]}], "+", 
  RowBox[{"f1", "\[CircleTimes]", "f3", "\[CircleTimes]", 
   RowBox[{"\[Del]", "f2"}]}]}]], "Output",
 CellChangeTimes->{3.615692467726268*^9, 3.61569257084453*^9, 
  3.6156929439418077`*^9, 3.615693660538072*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"f2", " ", "f3", " ", 
   RowBox[{"\[Del]", "f1"}]}], "+", 
  RowBox[{"f1", " ", "f3", " ", 
   RowBox[{"\[Del]", "f2"}]}], "+", 
  RowBox[{"f1", " ", "f2", " ", 
   RowBox[{"\[Del]", "f3"}]}]}]], "Output",
 CellChangeTimes->{3.615692467726268*^9, 3.61569257084453*^9, 
  3.6156929439418077`*^9, 3.6156936605465183`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"f2", " ", "f3", " ", 
   RowBox[{"x", "\[CircleTimes]", 
    RowBox[{"\[Del]", "f1"}]}]}], "+", 
  RowBox[{"f1", " ", "f3", " ", 
   RowBox[{"x", "\[CircleTimes]", 
    RowBox[{"\[Del]", "f2"}]}]}], "+", 
  RowBox[{"f1", " ", "f2", " ", 
   RowBox[{"x", "\[CircleTimes]", 
    RowBox[{"\[Del]", "f3"}]}]}], "+", 
  RowBox[{"f1", " ", "f2", " ", "f3", " ", 
   RowBox[{"\[Del]", "x"}]}]}]], "Output",
 CellChangeTimes->{3.615692467726268*^9, 3.61569257084453*^9, 
  3.6156929439418077`*^9, 3.6156936605529013`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"a", "+", "b"}], ")"}], 
    RowBox[{"(", 
     RowBox[{"c", "+", "d"}], ")"}]}], ")"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"a", "\[CircleTimes]", 
   RowBox[{"\[Del]", "c"}]}], "+", 
  RowBox[{"a", "\[CircleTimes]", 
   RowBox[{"\[Del]", "d"}]}], "+", 
  RowBox[{"b", "\[CircleTimes]", 
   RowBox[{"\[Del]", "c"}]}], "+", 
  RowBox[{"b", "\[CircleTimes]", 
   RowBox[{"\[Del]", "d"}]}], "+", 
  RowBox[{"c", "\[CircleTimes]", 
   RowBox[{"\[Del]", "a"}]}], "+", 
  RowBox[{"c", "\[CircleTimes]", 
   RowBox[{"\[Del]", "b"}]}], "+", 
  RowBox[{"d", "\[CircleTimes]", 
   RowBox[{"\[Del]", "a"}]}], "+", 
  RowBox[{"d", "\[CircleTimes]", 
   RowBox[{"\[Del]", "b"}]}]}]], "Output",
 CellChangeTimes->{3.6156939849815083`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Timing:  Non recursive defn for  \[Del](a_Times)      ---    nothing here \
initialized \
\>", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.615693209244409*^9, 3.615693250540771*^9}, {
   3.615693384989294*^9, 3.615693390973969*^9}, {3.615693470399192*^9, 
   3.615693511230557*^9}, 3.65541192004569*^9}],

Cell["\<\
This turns out to be a bit slower than recursion using the simple defn for 2 \
factors.\
\>", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.615693260541402*^9, 3.6156933624616013`*^9}, {
   3.615693517358489*^9, 3.615693522334915*^9}, 3.6156938585608377`*^9, 
   3.655411920045772*^9}],

Cell["\<\
Times is Flat so  a_Times  matches multiple factors.
The   a_Times   will only have at most one of  the  a_  with degree > 0.
The slot created by  \[Del] is last,\
\>", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467108658495781*^9, 3.467108704917168*^9}, {
   3.467113504208002*^9, 3.467113528841833*^9}, {3.467120271270797*^9, 
   3.467120319418405*^9}, {3.467284845922973*^9, 3.467284927392711*^9}, {
   3.467285683779427*^9, 3.467285767103554*^9}, {3.478630848755242*^9, 
   3.478630925812347*^9}, {3.478630997893272*^9, 3.478631017409254*^9}, {
   3.47863117479917*^9, 3.478631340254095*^9}, 3.478874272650542*^9, 
   3.479724792531641*^9, {3.615689455252488*^9, 3.615689468597186*^9}, {
   3.6156895309812603`*^9, 3.61568953517344*^9}, {3.615689629078068*^9, 
   3.615689745766449*^9}, {3.615692258262989*^9, 3.615692293798726*^9}, 
   3.655411920045824*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Del", "[", 
   RowBox[{"f1_", " ", "f2_"}], "]"}], "=."}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Del", "[", "a_Times", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "i", "}"}], ",", 
    RowBox[{"Sum", "[", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Delete", "[", 
        RowBox[{"a", ",", "i"}], "]"}], "\[CircleTimes]", 
       RowBox[{"\[Del]", 
        RowBox[{"a", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", "a", "]"}]}], "}"}]}], "]"}]}], 
   "]"}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6156919080710382`*^9, 3.615691938445035*^9}, {
   3.615692145902664*^9, 3.615692151470167*^9}, {3.615693904067556*^9, 
   3.615693906825437*^9}, {3.621384669120222*^9, 3.621384689214986*^9}, 
   3.655411920045868*^9}],

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"Do", "[", 
    RowBox[{
     RowBox[{"\[Del]", 
      RowBox[{"(", 
       RowBox[{
       "x", " ", "f1", " ", "f2", " ", "f3", " ", "f4", " ", "f5", " ", 
        "f6"}], ")"}]}], ",", 
     RowBox[{"{", "1000", "}"}]}], "]"}], ";", 
   RowBox[{"\[Del]", 
    RowBox[{"(", 
     RowBox[{
     "x", " ", "f1", " ", "f2", " ", "f3", " ", "f4", " ", "f5", " ", "f6"}], 
     ")"}]}]}], "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.615692646006122*^9, 3.615692673855896*^9}, {
   3.615692888781605*^9, 3.61569290144622*^9}, 3.655411920045906*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.82811400000000001675459770922316238284`6.282603187843308", ",", 
   RowBox[{
    RowBox[{"f2", " ", "f3", " ", "f4", " ", "f5", " ", "f6", " ", 
     RowBox[{"x", "\[CircleTimes]", 
      RowBox[{"\[Del]", "f1"}]}]}], "+", 
    RowBox[{"f1", " ", "f3", " ", "f4", " ", "f5", " ", "f6", " ", 
     RowBox[{"x", "\[CircleTimes]", 
      RowBox[{"\[Del]", "f2"}]}]}], "+", 
    RowBox[{"f1", " ", "f2", " ", "f4", " ", "f5", " ", "f6", " ", 
     RowBox[{"x", "\[CircleTimes]", 
      RowBox[{"\[Del]", "f3"}]}]}], "+", 
    RowBox[{"f1", " ", "f2", " ", "f3", " ", "f5", " ", "f6", " ", 
     RowBox[{"x", "\[CircleTimes]", 
      RowBox[{"\[Del]", "f4"}]}]}], "+", 
    RowBox[{"f1", " ", "f2", " ", "f3", " ", "f4", " ", "f6", " ", 
     RowBox[{"x", "\[CircleTimes]", 
      RowBox[{"\[Del]", "f5"}]}]}], "+", 
    RowBox[{"f1", " ", "f2", " ", "f3", " ", "f4", " ", "f5", " ", 
     RowBox[{"x", "\[CircleTimes]", 
      RowBox[{"\[Del]", "f6"}]}]}], "+", 
    RowBox[{
    "f1", " ", "f2", " ", "f3", " ", "f4", " ", "f5", " ", "f6", " ", 
     RowBox[{"\[Del]", "x"}]}]}]}], "}"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{
  3.615692675010977*^9, {3.615692984357359*^9, 3.615693003908257*^9}, 
   3.615693064911026*^9, {3.61569314143869*^9, 3.615693155451494*^9}, 
   3.6554119200459633`*^9}],

Cell[".... 1.8 sec  compared with 1.6 sec for the recursive defn.", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.615693427262127*^9, 3.615693461310734*^9}, 
   3.6554119200460033`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Del", "[", "a_Times", "]"}], "=."}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6156926876631804`*^9, 3.615692688029519*^9}, 
   3.655411920046039*^9}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["\[Del]  of  \[CircleTimes] products", "Subsubsection",
 CellChangeTimes->{{3.6156945852211246`*^9, 3.6156946079412813`*^9}, {
  3.6516034369785147`*^9, 3.651603441651898*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", "v_CircleTimes"}], ":=", 
   RowBox[{
    RowBox[{"mvToLast", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"deg", "[", 
        RowBox[{"First", "[", "v", "]"}], "]"}], "+", "1"}], ",", 
      RowBox[{
       RowBox[{"\[Del]", 
        RowBox[{"First", "[", "v", "]"}]}], "\[CircleTimes]", 
       RowBox[{"Rest", "[", "v", "]"}]}]}], "]"}], "+", 
    RowBox[{
     RowBox[{"First", "[", "v", "]"}], "\[CircleTimes]", 
     RowBox[{"\[Del]", 
      RowBox[{"Rest", "[", "v", "]"}]}]}]}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.612553801688923*^9, 3.61255380207196*^9}, {
   3.6515989689240627`*^9, 3.6515989716176243`*^9}, 3.653862896815343*^9}],

Cell[BoxData[
 RowBox[{"rule", "[", "189", "]"}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"a", ",", "b", ",", "c"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{"(", 
   RowBox[{
   "a", "\[CircleTimes]", "b", "\[CircleTimes]", "c", "\[CircleTimes]", "d"}],
    ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{"(", 
   RowBox[{"a", "\[CircleTimes]", "b"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{"(", "a", ")"}]}]}], "Input",
 CellChangeTimes->{{3.478632218150501*^9, 3.478632242757139*^9}, {
  3.478635990908031*^9, 3.478635998403925*^9}, {3.653863044671034*^9, 
  3.653863060318268*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"a", "\[CircleTimes]", 
   RowBox[{"mvToLast", "[", 
    RowBox[{
     RowBox[{"1", "+", 
      RowBox[{"deg", "[", "b", "]"}]}], ",", 
     RowBox[{
      RowBox[{"\[Del]", "b"}], "\[CircleTimes]", "c", "\[CircleTimes]", 
      "d"}]}], "]"}]}], "+", 
  RowBox[{"a", "\[CircleTimes]", "b", "\[CircleTimes]", 
   RowBox[{"mvToLast", "[", 
    RowBox[{
     RowBox[{"1", "+", 
      RowBox[{"deg", "[", "c", "]"}]}], ",", 
     RowBox[{
      RowBox[{"\[Del]", "c"}], "\[CircleTimes]", "d"}]}], "]"}]}], "+", 
  RowBox[{"a", "\[CircleTimes]", "b", "\[CircleTimes]", "c", "\[CircleTimes]", 
   RowBox[{"\[Del]", "d"}]}], "+", 
  RowBox[{"mvToLast", "[", 
   RowBox[{
    RowBox[{"1", "+", 
     RowBox[{"deg", "[", "a", "]"}]}], ",", 
    RowBox[{
     RowBox[{"\[Del]", "a"}], "\[CircleTimes]", "b", "\[CircleTimes]", "c", 
     "\[CircleTimes]", "d"}]}], "]"}]}]], "Output",
 CellChangeTimes->{3.655412382772069*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"a", "\[CircleTimes]", 
   RowBox[{"\[Del]", "b"}]}], "+", 
  RowBox[{"mvToLast", "[", 
   RowBox[{
    RowBox[{"1", "+", 
     RowBox[{"deg", "[", "a", "]"}]}], ",", 
    RowBox[{
     RowBox[{"\[Del]", "a"}], "\[CircleTimes]", "b"}]}], "]"}]}]], "Output",
 CellChangeTimes->{3.655412382772738*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", "a"}]], "Output",
 CellChangeTimes->{3.655412382773387*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\[Del]  of trig and other elementary functions", "Subsubsection",
 CellChangeTimes->{{3.615688751200144*^9, 3.615688789199925*^9}, {
  3.651603446050469*^9, 3.65160344787429*^9}}],

Cell["\<\
General rules for  \[Del]  on scalar functions could be defined like this...\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467108658495781*^9, 3.467108704917168*^9}, {
   3.467113504208002*^9, 3.467113528841833*^9}, {3.467120271270797*^9, 
   3.467120319418405*^9}, {3.467284845922973*^9, 3.467284927392711*^9}, {
   3.467285683779427*^9, 3.467285767103554*^9}, {3.478630848755242*^9, 
   3.478630925812347*^9}, {3.478630997893272*^9, 3.478631017409254*^9}, {
   3.47863117479917*^9, 3.478631340254095*^9}, {3.478631720603895*^9, 
   3.478631735018586*^9}, {3.478631836501138*^9, 3.478631846915305*^9}, {
   3.478631887658069*^9, 3.478631964748448*^9}, {3.478632063255664*^9, 
   3.478632063783149*^9}, {3.47863906118876*^9, 3.478639098896737*^9}, {
   3.478639298562618*^9, 3.478639343229907*^9}, {3.479370376488666*^9, 
   3.479370438094315*^9}, 3.479833725056699*^9, 3.612502937373904*^9, {
   3.614640975815097*^9, 3.614640978006773*^9}}],

Cell["\<\
Del[f_[g_]] := D[f[g], g] Del[g] /; deg[f[g]] == 0;
Del[f_[g1_, g2_]] := D[f[g1, g2], g1] Del[g1] + D[f[g1, g2], g2] Del[g2] /; \
deg[f[g1, g2]] == 0
\
\>", "Text",
 CellChangeTimes->{{3.478632266904679*^9, 3.478632271518072*^9}, {
  3.478636676015966*^9, 3.478636736980858*^9}, {3.478636770734037*^9, 
  3.478636770973591*^9}, {3.478636821794948*^9, 3.478636839712061*^9}, {
  3.478637515513534*^9, 3.478637515795489*^9}, {3.478639273330268*^9, 
  3.478639288626069*^9}, {3.479721986978802*^9, 3.479721986982014*^9}, {
  3.6146409897316227`*^9, 3.6146409977721367`*^9}}],

Cell["\<\
However, this is very restrictive. It would mean having to always display all \
dependencies of scalar fields through their arguments. 
So instead, we shall explicitly say what to do only for the elementary \
functions, and leave it to the user to define how to apply \[Del] to anything \
else...\
\>", "Text",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQAWIQnZpvErfx4kvHC/ekE0F0fCdrZc2Vl45nz2ysBdFM
q506QHTMmYouEF1w11/tD5AujJTVAdFflrO1/APSPh+k2kF03KoXFxmvvnSc
nPz2Ooj+37FXNwhIi098Yw6iBT9WTAPRAQGPF4Doj1oSFt9evXTc/2+nI4he
P3WPF4ieI6HrC6LPTrqZAKJ7FDtKQbRMsPBSEO0048EyEB3MOWEziNbzursF
RD/n+7oTRHt+nn4YRKfpvTgPovv4f4LpIK5lVr+AtNCmGHsQ/Z0hKAJEp0U/
jwXRSzfM9Yl/89IxwWNaAIiu4g2MBNFmqxfmgGj2jcqTHN++dFQ03A2mAZ3v
vMU=
  "]],

Cell["\<\
We test the degree in case we want to overload these later for Clifford \
algebra...\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467108658495781*^9, 3.467108704917168*^9}, {
   3.467113504208002*^9, 3.467113528841833*^9}, {3.467120271270797*^9, 
   3.467120319418405*^9}, {3.467284845922973*^9, 3.467284927392711*^9}, {
   3.467285683779427*^9, 3.467285767103554*^9}, {3.478630848755242*^9, 
   3.478630925812347*^9}, {3.478630997893272*^9, 3.478631017409254*^9}, {
   3.47863117479917*^9, 3.478631340254095*^9}, {3.478631720603895*^9, 
   3.478631735018586*^9}, {3.478631836501138*^9, 3.478631846915305*^9}, {
   3.478631887658069*^9, 3.478631964748448*^9}, {3.478632063255664*^9, 
   3.478632063783149*^9}, {3.47863906118876*^9, 3.478639098896737*^9}, {
   3.479370606632008*^9, 3.479370611111254*^9}, 3.479724795272265*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Del", "[", 
   RowBox[{"Sin", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", "  ", 
  RowBox[{
   RowBox[{"Cos", "[", "f", "]"}], " ", 
   RowBox[{"Del", "[", "f", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Del", "[", 
    RowBox[{"Cos", "[", 
     RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"Sin", "[", "f", "]"}]}], " ", 
    RowBox[{"Del", "[", "f", "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Del", "[", 
   RowBox[{"Csc", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{"Cot", "[", "f", "]"}]}], " ", 
   RowBox[{"Csc", "[", "f", "]"}], " ", 
   RowBox[{"Del", "[", "f", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Del", "[", 
    RowBox[{"Sec", "[", 
     RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", "   ", 
   RowBox[{
    RowBox[{"Sec", "[", "f", "]"}], " ", 
    RowBox[{"Tan", "[", "f", "]"}], 
    RowBox[{"Del", "[", "f", "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Del", "[", 
   RowBox[{"Tan", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", "   ", 
  RowBox[{
   SuperscriptBox[
    RowBox[{"Sec", "[", "f", "]"}], "2"], " ", 
   RowBox[{"Del", "[", "f", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Del", "[", 
   RowBox[{"Cot", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"-", 
    SuperscriptBox[
     RowBox[{"Csc", "[", "f", "]"}], "2"]}], " ", 
   RowBox[{"Del", "[", "f", "]"}]}]}]}], "Input",
 InitializationCell->True],

Cell["\<\
Exp[ x ]   is   Power[ E, x ]   so needs to be done like this,\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Del", "[", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"a_", "?", "deg0Q"}], ")"}], 
    RowBox[{"b_", "?", "deg0Q"}]], "]"}], ":=", 
  RowBox[{
   RowBox[{"b", " ", 
    SuperscriptBox["a", 
     RowBox[{"b", "-", "1"}]], 
    RowBox[{"Del", "[", "a", "]"}]}], "+", 
   RowBox[{
    SuperscriptBox["a", "b"], " ", 
    RowBox[{"Log", "[", "a", "]"}], " ", 
    RowBox[{"Del", "[", "b", "]"}]}]}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "\[Del]  of  \[LeftAngleBracket]  ,  ,  ,  \[RightAngleBracket]  and  ",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", "   ", "\[RightAngleBracket]"}], "ab"], 
   TraditionalForm]]]
}], "Subsubsection",
 CellChangeTimes->{{3.614292169417976*^9, 3.614292175353084*^9}, {
  3.61433723601287*^9, 3.6143372471474123`*^9}, {3.615694652486519*^9, 
  3.615694680751655*^9}, {3.651603456723028*^9, 3.6516034580663853`*^9}}],

Cell[TextData[{
 "\nNB:  If contractions involve implied type-change (insertion of \
appropriate  g  or  ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["g", 
    RowBox[{"-", "1"}]], TraditionalForm]]],
 ")  then  \[Del]  is assumed to be metric compatible so that  \[Del]  of the \
implied  g  or  ginv  does not contribute.\nEg,   Implied type change:   \
\[LeftAngleBracket] v , v \[RightAngleBracket]  \[Rule]  \[LeftAngleBracket] \
v , g , v \[RightAngleBracket]    and    \[LeftAngleBracket] \[Omega] , \
\[Omega] \[RightAngleBracket]  \[Rule]  \[LeftAngleBracket] \[Omega] , ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["g", 
    RowBox[{"-", "1"}]], TraditionalForm]]],
 ", \[Omega] \[RightAngleBracket] .      "
}], "Text",
 CellChangeTimes->{{3.614637939092744*^9, 3.614637951556476*^9}, {
  3.614638157221127*^9, 3.614638160933017*^9}, {3.6146385271254797`*^9, 
  3.614638548805069*^9}, {3.6146386787746887`*^9, 3.614638697157271*^9}, {
  3.614639048070842*^9, 3.6146390486146717`*^9}, {3.615688492289508*^9, 
  3.6156884972635098`*^9}, {3.6213869618879004`*^9, 3.621387172465205*^9}, {
  3.6213872479855623`*^9, 3.621387397922176*^9}, {3.653871263338563*^9, 
  3.653871311657591*^9}, {3.653871392792787*^9, 3.6538714286801977`*^9}}],

Cell["\<\
Since  \[Del]  adds its slot at the end, the  ab  slot counts don't change...\
\
\>", "Text",
 CellChangeTimes->{{3.478521348524732*^9, 3.478521367997245*^9}, {
   3.478521995402616*^9, 3.478522005330361*^9}, {3.478522082794157*^9, 
   3.478522380056022*^9}, 3.478522415777293*^9, {3.478522542569283*^9, 
   3.478522547072749*^9}, {3.478522672464452*^9, 3.47852282811114*^9}, {
   3.478522866720887*^9, 3.478522910998042*^9}, {3.478523013006232*^9, 
   3.478523063845325*^9}, {3.478523294797873*^9, 3.478523315180198*^9}, {
   3.478523421036623*^9, 3.478523455373287*^9}, {3.478523509195832*^9, 
   3.478523578355614*^9}, {3.478523821778841*^9, 3.478524070826569*^9}, {
   3.478524122176394*^9, 3.478524185184386*^9}, {3.478524340830039*^9, 
   3.478524400607762*^9}, {3.478524843318779*^9, 3.478525228555697*^9}, {
   3.478525654133307*^9, 3.47852582850393*^9}, {3.47852588911241*^9, 
   3.47852622600454*^9}, {3.478526677795962*^9, 3.478526776484335*^9}, {
   3.478526889750424*^9, 3.478526949794981*^9}, {3.47852727452154*^9, 
   3.4785272751774*^9}, {3.478527306713869*^9, 3.47852733310468*^9}, {
   3.478527406985081*^9, 3.478527413939544*^9}, {3.478528120382391*^9, 
   3.47852812958848*^9}, {3.478528192756685*^9, 3.478528220109628*^9}, {
   3.478529193768579*^9, 3.478529219839461*^9}, {3.478529292912798*^9, 
   3.478529294543033*^9}, {3.478529493455744*^9, 3.47852950568608*^9}, {
   3.478532420268942*^9, 3.478532480480057*^9}, 3.478703460819037*^9, {
   3.478703667748659*^9, 3.4787036791852*^9}, {3.478703842688146*^9, 
   3.478703858827889*^9}, {3.478704637672439*^9, 3.478704863019877*^9}, {
   3.478704899735583*^9, 3.478704924252704*^9}, {3.478705143616218*^9, 
   3.478705179720568*^9}, {3.47877489559973*^9, 3.478774907484824*^9}, {
   3.478781148750663*^9, 3.478781217983201*^9}, 3.478782148012889*^9, {
   3.478795139728624*^9, 3.478795188259496*^9}, {3.478795725140351*^9, 
   3.478795739951857*^9}, {3.478795795578081*^9, 3.47879582100902*^9}, {
   3.478873799224626*^9, 3.478873861099447*^9}, {3.480396576086796*^9, 
   3.480396578928399*^9}, {3.480528357630093*^9, 3.480528375064944*^9}, {
   3.480528702947971*^9, 3.480528716674738*^9}, {3.480528922055934*^9, 
   3.480529076999509*^9}, {3.480529550484971*^9, 3.480529840077882*^9}, 
   3.5180819333363543`*^9, 3.6146418883931704`*^9, {3.6213869265596533`*^9, 
   3.621386929567589*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", "X_", "\[RightAngleBracket]"}], 
     "ab__List"]}], ":=", " ", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"\[Del]", "X"}], "\[RightAngleBracket]"}], "ab"]}], 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.480529089907065*^9, 3.480529142348946*^9}, {
  3.614641644305543*^9, 3.614641650225902*^9}, {3.615687665745162*^9, 
  3.6156876891359167`*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "190", "]"}]], "Output"]
}, Open  ]],

Cell["\<\
This is  around the wrong way,  with  mv  before contraction, \
\>", "Text",
 CellChangeTimes->{{3.614637939092744*^9, 3.614637951556476*^9}, {
  3.614638157221127*^9, 3.614638160933017*^9}, {3.6146385271254797`*^9, 
  3.614638548805069*^9}, {3.614638587365487*^9, 3.6146386398293*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Del]", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"X_", ",", "Y_"}], "\[RightAngleBracket]"}]}], "\[RuleDelayed]", 
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"X", ",", 
     RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"mvToLast", "[", 
      RowBox[{
       RowBox[{"1", "+", 
        RowBox[{"deg", "[", "X", "]"}]}], ",", 
       RowBox[{
        RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}]}], "]"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{
     RowBox[{"deg", "[", "X", "]"}], ",", 
     RowBox[{"1", "+", 
      RowBox[{"deg", "[", "X", "]"}]}]}]]}]}]], "Text",
 CellChangeTimes->{{3.614638384183467*^9, 3.614638431126588*^9}, {
   3.614639237988326*^9, 3.614639245403816*^9}, 3.653863087792234*^9}],

Cell["\<\
...contract  before  mv   is the correct simplification direction.\
\>", "Text",
 CellChangeTimes->{{3.614637939092744*^9, 3.614637951556476*^9}, {
  3.614638157221127*^9, 3.614638160933017*^9}, {3.6146385271254797`*^9, 
  3.614638548805069*^9}, {3.6146386787746887`*^9, 3.614638697157271*^9}, {
  3.614639056694644*^9, 3.614639082021719*^9}, {3.653868642203075*^9, 
  3.65386864802704*^9}}],

Cell["\<\
If  X  is deg 1 then do the mv  so that  \[Del]X  is on the right,\
\>", "Text",
 CellChangeTimes->{{3.6146382438772306`*^9, 3.614638311588883*^9}}],

Cell["For the 2-argument bracket:", "Text",
 CellChangeTimes->{{3.6146382438772306`*^9, 3.614638311588883*^9}, {
  3.6146387493337793`*^9, 3.614638774869255*^9}, {3.653868790617196*^9, 
  3.6538688174328003`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"X_", "?", "deg1Q"}], ",", "Y_"}], "\[RightAngleBracket]"}]}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X", ",", 
      RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", " ", 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"Y", "\[CircleTimes]", 
       RowBox[{"\[Del]", "X"}]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{"deg", "[", "Y", "]"}], "+", "1"}]}], "}"}]]}]}], 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6146381987108517`*^9, 3.614638236533759*^9}, {
   3.614638333908599*^9, 3.614638350323578*^9}, {3.614639721012982*^9, 
   3.614639729189568*^9}, 3.6146426664727697`*^9, {3.615687794181245*^9, 
   3.6156877966756983`*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "191", "]"}]], "Output"]
}, Open  ]],

Cell["If   deg[X]  > 1  or if   deg[X]   is symbolic,", "Text",
 CellChangeTimes->{{3.653868671530657*^9, 3.653868725466053*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X_", ",", "Y_"}], "\[RightAngleBracket]"}]}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X", ",", 
      RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", " ", 
    RowBox[{"mvToLast", "[", 
     RowBox[{
      RowBox[{"deg", "[", "X", "]"}], ",", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"deg", "[", "X", "]"}], ",", 
         RowBox[{
          RowBox[{"deg", "[", "X", "]"}], "+", "2"}]}], "}"}]]}], "]"}]}]}], 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.614637892116313*^9, 3.6146379185338793`*^9}, {
   3.614637983142713*^9, 3.614637986852429*^9}, {3.6146380189668293`*^9, 
   3.614638026102384*^9}, {3.6146381675111017`*^9, 3.614638173445087*^9}, {
   3.615687750646974*^9, 3.61568775351152*^9}, 3.653863103532762*^9, 
   3.653868730926795*^9}],

Cell[BoxData[
 RowBox[{"rule", "[", "192", "]"}]], "Output"]
}, Open  ]],

Cell["For multi-arg  bracket:", "Text",
 CellChangeTimes->{{3.6146382438772306`*^9, 3.614638311588883*^9}, {
  3.6146387493337793`*^9, 3.614638774869255*^9}, {3.653868819976775*^9, 
  3.653868820312687*^9}}],

Cell["\<\
This is  around the wrong way,  with  mv  before contraction,\
\>", "Text",
 CellChangeTimes->{{3.61463878346124*^9, 3.614638796290715*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Del]", 
   RowBox[{"(", 
    RowBox[{"a_AngleBracket", "/;", 
     RowBox[{
      RowBox[{"Length", "[", "a", "]"}], ">", "2"}]}], " ", ")"}]}], ":=", 
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"First", "[", "a", "]"}], ",", 
     RowBox[{"\[Del]", 
      RowBox[{"Rest", "[", "a", "]"}]}]}], "\[RightAngleBracket]"}], "+", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"mvToLast", "[", 
      RowBox[{
       RowBox[{"1", "+", 
        RowBox[{"deg", "[", 
         RowBox[{"First", "[", "a", "]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"\[Del]", 
         RowBox[{"First", "[", "a", "]"}]}], "\[CircleTimes]", 
        RowBox[{"Rest", "[", "a", "]"}]}]}], "]"}], "\[RightAngleBracket]"}], 
    
    RowBox[{
     RowBox[{"deg", "[", 
      RowBox[{"First", "[", "a", "]"}], "]"}], ",", 
     RowBox[{"1", "+", 
      RowBox[{"deg", "[", 
       RowBox[{"First", "[", "a", "]"}], "]"}]}]}]]}]}]], "Text",
 CellChangeTimes->{{3.614247119186328*^9, 3.614247256810709*^9}, {
   3.6142473651826553`*^9, 3.614247387514189*^9}, {3.614247421997903*^9, 
   3.614247434364791*^9}, {3.614247488768293*^9, 3.6142475210399437`*^9}, {
   3.614247895749012*^9, 3.6142479080505753`*^9}, {3.614250703371564*^9, 
   3.6142507081833477`*^9}, {3.614251445816325*^9, 3.6142514490315323`*^9}, {
   3.61463880419095*^9, 3.6146388061835833`*^9}, 3.614639259427244*^9, 
   3.6538631195760593`*^9}],

Cell["\<\
....contract  before  mv   is the correct simplification direction.\
\>", "Text",
 CellChangeTimes->{{3.614637939092744*^9, 3.614637951556476*^9}, {
  3.614638157221127*^9, 3.614638160933017*^9}, {3.6146385271254797`*^9, 
  3.614638548805069*^9}, {3.6146386787746887`*^9, 3.614638697157271*^9}, {
  3.614639056694644*^9, 3.614639082021719*^9}, {3.6538687557056828`*^9, 
  3.653868761209593*^9}}],

Cell["\<\
If  X  is deg 1 then do the mv  so that  \[Del]X  is on the right,\
\>", "Text",
 CellChangeTimes->{{3.6146382438772306`*^9, 3.614638311588883*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", 
    RowBox[{"(", 
     RowBox[{"a_AngleBracket", "/;", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "a", "]"}], ">", "2"}], " ", "&&", 
       RowBox[{
        RowBox[{"deg", "[", 
         RowBox[{"First", "[", "a", "]"}], "]"}], "===", "1"}]}]}], ")"}]}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"First", "[", "a", "]"}], ",", 
      RowBox[{"\[Del]", 
       RowBox[{"Rest", "[", "a", "]"}]}]}], "\[RightAngleBracket]"}], "+", 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"Rest", "[", "a", "]"}], "\[CircleTimes]", 
       RowBox[{"\[Del]", 
        RowBox[{"First", "[", "a", "]"}]}]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{"deg", "[", 
         RowBox[{"Rest", "[", "a", "]"}], "]"}], "+", "1"}]}], "}"}]]}]}], 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6146391907137213`*^9, 3.614639222503169*^9}, {
  3.61463946422255*^9, 3.614639490078289*^9}, {3.614639520810219*^9, 
  3.614639523804083*^9}, {3.614639554639426*^9, 3.6146395550337753`*^9}, {
  3.6146395978353777`*^9, 3.614639702828644*^9}, {3.614639741949061*^9, 
  3.614639765195016*^9}, {3.61463980183715*^9, 3.614639803710136*^9}, {
  3.6146426115643253`*^9, 3.614642611616016*^9}, {3.615687890953446*^9, 
  3.6156878938481817`*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "193", "]"}]], "Output"]
}, Open  ]],

Cell["If   deg[X]  > 1  or if   deg[X]   is symbolic,", "Text",
 CellChangeTimes->{{3.653868671530657*^9, 3.653868725466053*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", 
    RowBox[{"(", 
     RowBox[{"a_AngleBracket", "/;", 
      RowBox[{
       RowBox[{"Length", "[", "a", "]"}], ">", "2"}]}], ")"}]}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"First", "[", "a", "]"}], ",", 
      RowBox[{"\[Del]", 
       RowBox[{"Rest", "[", "a", "]"}]}]}], "\[RightAngleBracket]"}], "+", 
    RowBox[{"mvToLast", "[", 
     RowBox[{
      RowBox[{"deg", "[", 
       RowBox[{"First", "[", "a", "]"}], "]"}], ",", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{"\[Del]", 
          RowBox[{"First", "[", "a", "]"}]}], "\[CircleTimes]", 
         RowBox[{"Rest", "[", "a", "]"}]}], "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"deg", "[", 
          RowBox[{"First", "[", "a", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"First", "[", "a", "]"}], "]"}], "+", "2"}]}], "}"}]]}], 
     "]"}]}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6146391907137213`*^9, 3.614639222503169*^9}, {
   3.61463946422255*^9, 3.614639490078289*^9}, {3.614639520810219*^9, 
   3.614639523804083*^9}, {3.614639554639426*^9, 3.6146395550337753`*^9}, {
   3.6146395978353777`*^9, 3.6146396086742287`*^9}, {3.615687851739161*^9, 
   3.6156878554488*^9}, 3.65386313106096*^9, {3.653868896013625*^9, 
   3.653868897246847*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "194", "]"}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.655420152617146*^9, 3.655420170393196*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearField", "[", 
   RowBox[{"{", 
    RowBox[{"w", ",", "x", ",", "y", ",", "z"}], "}"}], "]"}], ";", 
  RowBox[{"NewField", "[", 
   RowBox[{
    RowBox[{"{", "1", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"w", ",", "x", ",", "y", ",", "z"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearField", "[", 
   RowBox[{"{", 
    RowBox[{"X", ",", "Y", ",", "Z"}], "}"}], "]"}], ";", 
  RowBox[{"NewField", "[", 
   RowBox[{
    RowBox[{"{", "2", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"X", ",", "Y", ",", "Z"}], "}"}]}], "]"}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6146399333056726`*^9, 3.614639939498863*^9}, {
   3.614642196652787*^9, 3.614642224996797*^9}, {3.614642461924663*^9, 
   3.6146424652405767`*^9}, {3.614659013781822*^9, 3.614659035146833*^9}, {
   3.614659085719261*^9, 3.614659117480957*^9}, {3.614659197669465*^9, 
   3.614659217960929*^9}, {3.6554124678951797`*^9, 3.6554124744385633`*^9}, 
   3.6554201703933163`*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170393375*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", 
    RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2"}], "]"}], "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"2", ",", "4"}], "}"}]], "]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.615687973742215*^9, 3.6538631623512907`*^9, 
  3.6538689336921864`*^9, 3.6554130474147377`*^9, 3.6554201703934402`*^9}],

Cell[BoxData[
 RowBox[{"StartDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614639965502326*^9, 3.6146399723030853`*^9}, 
   3.655420170393496*^9}],

Cell[BoxData[
 RowBox[{"StopDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659290326108*^9, 3.614659294295577*^9}, 
   3.6554201703935413`*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659127362576*^9, 3.614659133106614*^9}, 
   3.655420170393591*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]186\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"\[Del]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X_", ",", "Y_"}], "\[RightAngleBracket]"}]}], ":=", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", 
       RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
     RowBox[{"mvToLast", "[", 
      RowBox[{
       RowBox[{"deg", "[", "X", "]"}], ",", 
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
          RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"deg", "[", "X", "]"}], ",", 
          RowBox[{
           RowBox[{"deg", "[", "X", "]"}], "+", "2"}]}], "}"}]]}], "]"}]}]}]}],
  SequenceForm["rule[\[VeryThinSpace]186\[VeryThinSpace]]:", "  ", 
   Defer[Del[
      AngleBracket[
       Pattern[$CellContext`X, 
        Blank[]], 
       Pattern[$CellContext`Y, 
        Blank[]]]] := AngleBracket[$CellContext`X, 
       Del[$CellContext`Y]] + $CellContext`mvToLast[
       $CellContext`deg[$CellContext`X], 
       Subscript[
        AngleBracket[
         CircleTimes[
          Del[$CellContext`X], $CellContext`Y]], {
         $CellContext`deg[$CellContext`X], $CellContext`deg[$CellContext`X] + 
         2}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060096068*^9, 
  3.655420170393639*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", 
       RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
     RowBox[{"mvToLast", "[", 
      RowBox[{
       RowBox[{"deg", "[", "X", "]"}], ",", 
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
          RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"deg", "[", "X", "]"}], ",", 
          RowBox[{
           RowBox[{"deg", "[", "X", "]"}], "+", "2"}]}], "}"}]]}], "]"}]}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[AngleBracket[$CellContext`X, 
      Del[$CellContext`Y]] + $CellContext`mvToLast[
      $CellContext`deg[$CellContext`X], 
      Subscript[
       AngleBracket[
        CircleTimes[
         Del[$CellContext`X], $CellContext`Y]], {
        $CellContext`deg[$CellContext`X], $CellContext`deg[$CellContext`X] + 
        2}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060208335*^9, 
  3.65542017039368*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]1\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"\[CircleTimes]", "v_"}], ":=", "v"}]}],
  SequenceForm["rule[\[VeryThinSpace]1\[VeryThinSpace]]:", "  ", 
   Defer[CircleTimes[
      Pattern[$CellContext`v, 
       Blank[]]] := $CellContext`v]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060209475*^9, 
  3.655420170393721*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{"\[Del]", "X"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    Del[$CellContext`X]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060360302*^9, 
  3.6554201703937597`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]59\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{
     RowBox[{"mvToLast", "[", 
      RowBox[{"n_Integer", ",", "X_"}], "]"}], "/;", 
     RowBox[{"TrueQ", "[", 
      RowBox[{"n", "<", 
       RowBox[{"deg", "[", "X", "]"}]}], "]"}]}], ":=", 
    RowBox[{
     RowBox[{"mv", "[", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", "X", "]"}], "]"}], ",", "n"}], "]"}], ",", 
        "n"}], "]"}], "]"}], "[", "X", "]"}]}]}],
  SequenceForm["rule[\[VeryThinSpace]59\[VeryThinSpace]]:", "  ", 
   Defer[Condition[
      $CellContext`mvToLast[
       Pattern[$CellContext`n, 
        Blank[Integer]], 
       Pattern[$CellContext`X, 
        Blank[]]], 
      TrueQ[$CellContext`n < $CellContext`deg[$CellContext`X]]] := \
$CellContext`mv[
      Append[
       DeleteCases[
        Range[
         $CellContext`deg[$CellContext`X]], $CellContext`n], \
$CellContext`n]][$CellContext`X]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060427655*^9, 
  3.655420170393799*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{
     RowBox[{"mv", "[", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", 
            SubscriptBox[
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{
               RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
              "\[RightAngleBracket]"}], 
             RowBox[{"{", 
              RowBox[{"2", ",", "4"}], "}"}]], "]"}], "]"}], ",", "2"}], 
         "]"}], ",", "2"}], "]"}], "]"}], "[", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
       "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"2", ",", "4"}], "}"}]], "]"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    $CellContext`mv[
     Append[
      DeleteCases[
       Range[
        $CellContext`deg[
         Subscript[
          AngleBracket[
           CircleTimes[
            Del[$CellContext`X], $CellContext`Y]], {2, 4}]]], 2], 2]][
     Subscript[
      AngleBracket[
       CircleTimes[
        Del[$CellContext`X], $CellContext`Y]], {2, 4}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060521605*^9, 
  3.65542017039384*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]36\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"mv", "[", "n_List", "]"}], ":=", 
    RowBox[{"mv", "[", 
     RowBox[{"Sequence", "@@", "n"}], "]"}]}]}],
  SequenceForm["rule[\[VeryThinSpace]36\[VeryThinSpace]]:", "  ", 
   Defer[$CellContext`mv[
      Pattern[$CellContext`n, 
       Blank[List]]] := $CellContext`mv[
      Apply[Sequence, $CellContext`n]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060522402*^9, 
  3.65542017039388*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{"mv", "[", 
     RowBox[{"Sequence", "@@", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "]"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    $CellContext`mv[
     Apply[Sequence, {1, 3, 2}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.6554130606726227`*^9, 
  3.655420170393921*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", 
    RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2"}], "]"}], "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"2", ",", "4"}], "}"}]], "]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.6538689429488773`*^9, 3.6554130606733828`*^9, 
  3.655420170393968*^9}],

Cell[BoxData[
 RowBox[{"StopDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659290326108*^9, 3.614659294295577*^9}, 
   3.655420170394003*^9}],

Cell[BoxData[{
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{"%", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"X", "\[Rule]", 
       RowBox[{"x", "\[CircleTimes]", "y"}]}], ",", 
      RowBox[{"Y", "\[Rule]", 
       RowBox[{"z", "\[CircleTimes]", "w"}]}]}], "}"}]}], ")"}], " ", "-", 
  " ", 
  RowBox[{"\[Del]", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"X", "\[Rule]", 
        RowBox[{"x", "\[CircleTimes]", "y"}]}], ",", 
       RowBox[{"Y", "\[Rule]", 
        RowBox[{"z", "\[CircleTimes]", "w"}]}]}], "}"}]}], 
    ")"}]}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659162915042*^9, 3.6146591933006144`*^9}, {
   3.6146592306610937`*^9, 3.614659269944994*^9}, 3.655420170394047*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", 
    RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2"}], "]"}], "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"2", ",", "4"}], "}"}]], "]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653856967441422*^9, 3.6538689558588543`*^9, 
  3.6538689979319572`*^9, 3.655420170394095*^9}],

Cell[BoxData["0"], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653856967441422*^9, 3.6538689558588543`*^9, 
  3.653868997939365*^9, 3.655420170394156*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170394189*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", 
    RowBox[{"\[Del]", "y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"y", ",", 
    RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.615688118415242*^9, 3.6538570564166603`*^9, 
  3.6538690030247507`*^9, 3.6554201703942347`*^9}],

Cell[BoxData[
 RowBox[{"StartDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614639965502326*^9, 3.6146399723030853`*^9}, 
   3.65542017039427*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170394299*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]183\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"\[Del]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"X_", "?", "deg1Q"}], ",", "Y_"}], "\[RightAngleBracket]"}]}], 
    ":=", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", 
       RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"Y", "\[CircleTimes]", 
        RowBox[{"\[Del]", "X"}]}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"deg", "[", "Y", "]"}], "+", "1"}]}], "}"}]]}]}]}],
  SequenceForm["rule[\[VeryThinSpace]183\[VeryThinSpace]]:", "  ", 
   Defer[Del[
      AngleBracket[
       PatternTest[
        Pattern[$CellContext`X, 
         Blank[]], $CellContext`deg1Q], 
       Pattern[$CellContext`Y, 
        Blank[]]]] := AngleBracket[$CellContext`X, 
       Del[$CellContext`Y]] + Subscript[
       AngleBracket[
        CircleTimes[$CellContext`Y, 
         Del[$CellContext`X]]], {1, $CellContext`deg[$CellContext`Y] + 1}]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653869017562316*^9, 3.65542017039434*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"x", ",", 
       RowBox[{"\[Del]", "y"}]}], "\[RightAngleBracket]"}], "+", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"y", "\[CircleTimes]", 
        RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"deg", "[", "y", "]"}], "+", "1"}]}], "}"}]]}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[AngleBracket[$CellContext`x, 
      Del[$CellContext`y]] + Subscript[
      AngleBracket[
       CircleTimes[$CellContext`y, 
        Del[$CellContext`x]]], {1, $CellContext`deg[$CellContext`y] + 1}]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653869017698135*^9, 3.655420170394382*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]74\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1_", "\[CircleTimes]", "X2_"}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
     RowBox[{
      RowBox[{"a", "===", 
       RowBox[{"deg", "[", "X1", "]"}]}], "&&", 
      RowBox[{"b", "===", 
       RowBox[{"a", "+", "1"}]}]}]}], ":=", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}]}],
  SequenceForm["rule[\[VeryThinSpace]74\[VeryThinSpace]]:", "  ", 
   Defer[Condition[
      Subscript[
       AngleBracket[
        CircleTimes[
         Pattern[$CellContext`X1, 
          Blank[]], 
         Pattern[$CellContext`X2, 
          Blank[]]]], {
        Pattern[$CellContext`a, 
         Blank[]], 
        Pattern[$CellContext`b, 
         Blank[]]}], 
      And[$CellContext`a === $CellContext`deg[$CellContext`X1], \
$CellContext`b === $CellContext`a + 1]] := 
    AngleBracket[$CellContext`X1, $CellContext`X2]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.65386901770238*^9, 3.655420170394423*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"y", ",", 
      RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    AngleBracket[$CellContext`y, 
     Del[$CellContext`x]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653869017849453*^9, 3.655420170394477*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", 
    RowBox[{"\[Del]", "y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"y", ",", 
    RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{
  3.614642443732833*^9, {3.6146542316142187`*^9, 3.6146542520714493`*^9}, 
   3.614658924623312*^9, 3.653857068577862*^9, {3.65386901405835*^9, 
   3.65386901785402*^9}, 3.6554201703945227`*^9}],

Cell[BoxData[
 RowBox[{"StopDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659290326108*^9, 3.614659294295577*^9}, 
   3.655420170394557*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "Y", ",", "z"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170394588*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"z", ",", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"x", ",", 
      RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}]}], 
   "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"Y", ",", "z"}], "\[RightAngleBracket]"}], ",", 
    RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "Y", ",", 
    RowBox[{"\[Del]", "z"}]}], "\[RightAngleBracket]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.65386903700355*^9, 3.6554201703946342`*^9}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["\[Del]  of  mv[ ][ ] ", "Subsubsection",
 CellChangeTimes->{{3.614292169417976*^9, 3.614292175353084*^9}, {
  3.61433723601287*^9, 3.6143372471474123`*^9}, {3.615694652486519*^9, 
  3.615694680751655*^9}, {3.6516034159548883`*^9, 3.6516034267548237`*^9}, {
  3.651603477121954*^9, 3.65160347878592*^9}}],

Cell["mv[ ]  and  \[Del]  commute,", "Text",
 CellChangeTimes->{{3.6538676831909437`*^9, 3.6538677021347733`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", 
    RowBox[{
     RowBox[{"mv", "[", "n__", "]"}], "[", "X_", "]"}]}], ":=", 
   RowBox[{
    RowBox[{"mv", "[", "n", "]"}], "[", 
    RowBox[{"\[Del]", "X"}], "]"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.651603502830317*^9, 3.651603512179009*^9}, 
   3.651604084011269*^9}],

Cell[BoxData[
 RowBox[{"rule", "[", "195", "]"}]], "Output"]
}, Open  ]],

Cell["\<\
mvToLast[ ]   is just a special case of  mv[ ],   but the last slot of  X   \
is the 2nd last slot of   \[Del]X   so we need to move the \[Del]-slot to \
last,\
\>", "Text",
 CellChangeTimes->{{3.6538635911729*^9, 3.653863624532516*^9}, {
   3.653863713987352*^9, 3.6538637461787863`*^9}, {3.653864179646039*^9, 
   3.653864197181723*^9}, {3.653866856687839*^9, 3.653866865871585*^9}, 
   3.65386693071896*^9, {3.653867033549869*^9, 3.6538670829094133`*^9}, {
   3.653867152044527*^9, 3.653867213260007*^9}, {3.653867477113244*^9, 
   3.653867543752431*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", 
    RowBox[{"mvToLast", "[", 
     RowBox[{"n_", ",", "X_"}], "]"}]}], ":=", 
   RowBox[{"mvToLast", "[", 
    RowBox[{
     RowBox[{"deg", "[", "X", "]"}], ",", 
     RowBox[{
      RowBox[{"mvToLast", "[", "n", "]"}], "[", 
      RowBox[{"\[Del]", "X"}], "]"}]}], "]"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.651603502830317*^9, 3.651603512179009*^9}, 
   3.651604084011269*^9, {3.653863631686255*^9, 3.653863638677854*^9}, {
   3.653864364445033*^9, 3.653864422796748*^9}, {3.653866939506257*^9, 
   3.65386694616775*^9}, {3.653867002856998*^9, 3.653867019265774*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "196", "]"}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651605156106372*^9, 3.651605157450458*^9}, 
   3.655420283191711*^9}],

Cell[BoxData[
 RowBox[{"mvToLast", "[", 
  RowBox[{
   RowBox[{"deg", "[", "X", "]"}], ",", "X"}], "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.653867414910058*^9, 3.653867426762618*^9}, 
   3.6554202831917953`*^9}],

Cell[BoxData["X"], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6554202706298723`*^9, 3.655420283191875*^9}}],

Cell["\<\
If fixed-length args for  mv[n]  are being used then the resulting  mv  will \
automatically become  mv[n, deg[X+1] ] ,\
\>", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604915821741*^9, 3.6516050499491377`*^9}, {
   3.6516050904433203`*^9, 3.6516050906674747`*^9}, 3.655420283191924*^9}],

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"X", ",", "Y"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{"2", ",", "X"}], "]"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604011194244*^9, 3.651604022524269*^9}, {
   3.651604097562748*^9, 3.651604116074546*^9}, {3.651605120796707*^9, 
   3.651605133501232*^9}, 3.655420283191963*^9}],

Cell[BoxData[{
 RowBox[{"\[Del]", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "1"}], "]"}], "[", "X", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "1"}], "]"}], "[", "Y", "]"}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604042665856*^9, 3.651604059579987*^9}, {
   3.6516051376143084`*^9, 3.651605142175061*^9}, 3.6554202831920023`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1", ",", "3"}], "]"}], "[", 
  RowBox[{"\[Del]", "X"}], "]"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604054508523*^9, 3.651604060890423*^9}, 
   3.651604175910171*^9, 3.65160514317831*^9, 3.653867604787859*^9, 
   3.6554202831920443`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1"}], "]"}], "[", 
  RowBox[{"\[Del]", "Y"}], "]"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604054508523*^9, 3.651604060890423*^9}, 
   3.651604175910171*^9, 3.65160514317831*^9, 3.653867604794312*^9, 
   3.655420283192082*^9}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["\[Del]  of Series", "Subsubsection"],

Cell[TextData[{
 "We want to be able to apply \[Del] to power series in r  where  \[Del]r  \
has an assigned value. \nThe order of the error term will be reduced by 1, \
but this does not mean that the gradient of the highest coefficient will not \
contribute, because its gradient \nmight contain an inverse power of  r .   \
Eg.,  if \n\n      y  =  ",
 Cell[BoxData[
  FormBox["a", TraditionalForm]]],
 " ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["r", "2"], TraditionalForm]]],
 "  +  ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox[
    RowBox[{"O", "[", "r", "]"}], 
    RowBox[{" ", "3"}]], TraditionalForm]]],
 "\n\nthen  ( using   \[Del]r = n ), \n\n       \[Del]y  =   \[Del]a  ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["r", "2"], TraditionalForm]]],
 "  +   a \[CircleTimes] n  r   +   ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox[
    RowBox[{"O", "[", "r", "]"}], 
    RowBox[{" ", "2"}]], TraditionalForm]]],
 "  \n\nWe can not drop the  \[Del]a  term!  For example, if  a = n  then we \
would get the wrong answer because  \[Del]n  is  ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox[
    RowBox[{"O", "[", "r", "]"}], 
    RowBox[{" ", 
     RowBox[{"-", "1"}]}]], TraditionalForm]]],
 ".          \nTherefore,  there is nothing clever we can do with the highest \
term. Just calculate  \[Del]  as a normal expression and then take series to \
the required order,"
}], "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"\[Del]", "f_SeriesData"}], " ", ":=", " ", 
   RowBox[{"Series", "[", 
    RowBox[{
     RowBox[{"\[Del]", 
      RowBox[{"Normal", "[", "f", "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"f", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"[", "5", "]"}], "]"}], "-", "2"}]}], "}"}]}], "]"}]}], 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "197", "]"}]], "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "The gradient operator,  grad[ ] =  ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[Del]", "#"], TraditionalForm]]]
}], "Subsection"],

Cell["Added 06/06/2017.", "Text"],

Cell["\<\
Code elsewhere for grad:  FieldType and SlotType.

NB.  Any user defined values for  grad[ ]   should instead be made in terms \
of  \[Del].  \
\>", "Text"],

Cell[TextData[{
 "The output tex is in terms of   ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[Del]", "#"], TraditionalForm]]],
 "(x).   It would be nice to remove parentheses.\nThis could be done as a  \
TeXit  filter, and would be OK because  \[Del]  hence  grad   always expands \
so we never get  grad[x y]  or grad[x+y]  in tex output,\nso taking out the  \
( )  is not a problem.\n\nBetter, would be to change  CustomTex  to allow \
parametrized string replacements:  grad(x_) \[RuleDelayed] ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[Del]", "#"], TraditionalForm]]],
 " x ."
}], "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CustomTeX", "[", 
   RowBox[{"grad", ",", "\"\<\\\\nabla^\\\\sharp\>\""}], "]"}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"Clear", "[", "grad", "]"}]], "Input",
 InitializationCell->True],

Cell["\<\
\[OpenCurlyDoubleQuote]\[Sharp]\[CloseCurlyDoubleQuote]  is input as \\[\
\[VeryThinSpace]Sharp\[VeryThinSpace]] ,\
\>", "Text"],

Cell[BoxData[
 RowBox[{"grad", "/:", 
  RowBox[{"MakeBoxes", "[", 
   RowBox[{
    RowBox[{"grad", "[", "x_", "]"}], ",", "StandardForm"}], "]"}], ":=", 
  RowBox[{"RowBox", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"SuperscriptBox", "[", 
      RowBox[{"\"\<\[Del]\>\"", ",", "\"\<\[Sharp]\>\""}], "]"}], ",", 
     RowBox[{"ToBoxes", "[", 
      RowBox[{"x", ",", "StandardForm"}], "]"}]}], "}"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"MakeExpression", "[", 
   RowBox[{
    RowBox[{"RowBox", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"SuperscriptBox", "[", 
        RowBox[{"\"\<\[Del]\>\"", ",", "\"\<\[Sharp]\>\""}], "]"}], ",", 
       "x_"}], "}"}], "]"}], ",", "StandardForm"}], "]"}], ":=", 
  RowBox[{"MakeExpression", "[", 
   RowBox[{
    RowBox[{"RowBox", "[", 
     RowBox[{"{", 
      RowBox[{"\"\<grad[\>\"", ",", "x", ",", "\"\<]\>\""}], "}"}], "]"}], 
    ",", "StandardForm"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"grad", "[", "xx", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  SuperscriptBox["\[Del]", "\[Sharp]"], "xx"}]], "Output"]
}, Open  ]],

Cell["Cut-and-paste above,", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   SuperscriptBox["\[Del]", "\[Sharp]"], "xx"}], "//", "FullForm"}]], "Input"],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"grad", "[", "xx", "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output"]
}, Open  ]],

Cell["Bracketing seems OK,", "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"a", "\[CircleTimes]", 
  RowBox[{"grad", "[", "xx", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grad", "[", "xx", "]"}], "\[CircleTimes]", "a"}]}], "Input"],

Cell[BoxData[
 RowBox[{"a", "\[CircleTimes]", 
  RowBox[{
   SuperscriptBox["\[Del]", "\[Sharp]"], "xx"}]}]], "Output"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   SuperscriptBox["\[Del]", "\[Sharp]"], "xx"}], "\[CircleTimes]", 
  "a"}]], "Output"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"DelTograd", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Del]", 
      RowBox[{"(", "$X_", ")"}]}], "\[RuleDelayed]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"grad", "[", "$X", "]"}], ",", 
       RowBox[{"Metric", "[", "]"}]}], "\[RightAngleBracket]"}]}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"gradToDel", " ", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"grad", "[", "$X_", "]"}], "\[RuleDelayed]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"\[Del]", "$X"}], ",", 
       RowBox[{"MetricInverse", "[", "]"}]}], "\[RightAngleBracket]"}]}], 
    "}"}]}], ";"}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["Rules for grad[ ],  same as those for \[Del]", "Subsubsection"],

Cell[CellGroupData[{

Cell["        grad[ ]  of Lists", "Subsubsection"],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"grad", ",", "Listable"}], "]"}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["        Basic properties", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"deg", "[", 
   RowBox[{"grad", "[", " ", "v_", "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"deg", "[", "v", "]"}], "+", "1"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"a_", "?", "NumericQ"}], "]"}], "=", "0"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"grad", "[", "v_Plus", "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{"grad", ",", "v"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell["\<\
Times is Flat so each  f _ in the following can match multiple factors.
At most one of  the  f_  will have degree > 0.
The slot created by  \[Del] is last,\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467108658495781*^9, 3.467108704917168*^9}, {
   3.467113504208002*^9, 3.467113528841833*^9}, {3.467120271270797*^9, 
   3.467120319418405*^9}, {3.467284845922973*^9, 3.467284927392711*^9}, {
   3.467285683779427*^9, 3.467285767103554*^9}, {3.478630848755242*^9, 
   3.478630925812347*^9}, {3.478630997893272*^9, 3.478631017409254*^9}, {
   3.47863117479917*^9, 3.478631340254095*^9}, 3.478874272650542*^9, 
   3.479724792531641*^9, {3.615689455252488*^9, 3.615689468597186*^9}, {
   3.6156895309812603`*^9, 3.61568953517344*^9}, {3.615689629078068*^9, 
   3.615689745766449*^9}, {3.615692258262989*^9, 3.615692293798726*^9}, {
   3.615693546734583*^9, 3.615693604414901*^9}, {3.615694443029242*^9, 
   3.61569447181287*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"grad", "[", 
   RowBox[{"f1_", " ", "f2_"}], "]"}], ":=", " ", 
  RowBox[{"Expand", "[", 
   RowBox[{
    RowBox[{"f1", "\[CircleTimes]", 
     RowBox[{"grad", "[", "f2", "]"}]}], " ", "+", " ", 
    RowBox[{"f2", "\[CircleTimes]", 
     RowBox[{"grad", "[", "f1", "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["        grad[ ]   of  \[CircleTimes] products", "Subsubsection"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", "v_CircleTimes", "]"}], ":=", 
   RowBox[{
    RowBox[{"mvToLast", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"deg", "[", 
        RowBox[{"First", "[", "v", "]"}], "]"}], "+", "1"}], ",", 
      RowBox[{
       RowBox[{"grad", "[", 
        RowBox[{"First", "[", "v", "]"}], "]"}], "\[CircleTimes]", 
       RowBox[{"Rest", "[", "v", "]"}]}]}], "]"}], "+", 
    RowBox[{
     RowBox[{"First", "[", "v", "]"}], "\[CircleTimes]", 
     RowBox[{"grad", "[", 
      RowBox[{"Rest", "[", "v", "]"}], "]"}]}]}]}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "198", "]"}]], "Output"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["        grad[ ]   of trig and other elementary functions", \
"Subsubsection"],

Cell["\<\
We test the degree in case we want to overload these later for Clifford \
algebra...\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467108658495781*^9, 3.467108704917168*^9}, {
   3.467113504208002*^9, 3.467113528841833*^9}, {3.467120271270797*^9, 
   3.467120319418405*^9}, {3.467284845922973*^9, 3.467284927392711*^9}, {
   3.467285683779427*^9, 3.467285767103554*^9}, {3.478630848755242*^9, 
   3.478630925812347*^9}, {3.478630997893272*^9, 3.478631017409254*^9}, {
   3.47863117479917*^9, 3.478631340254095*^9}, {3.478631720603895*^9, 
   3.478631735018586*^9}, {3.478631836501138*^9, 3.478631846915305*^9}, {
   3.478631887658069*^9, 3.478631964748448*^9}, {3.478632063255664*^9, 
   3.478632063783149*^9}, {3.47863906118876*^9, 3.478639098896737*^9}, {
   3.479370606632008*^9, 3.479370611111254*^9}, 3.479724795272265*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"grad", "[", 
   RowBox[{"Sin", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", "  ", 
  RowBox[{
   RowBox[{"Cos", "[", "f", "]"}], " ", 
   RowBox[{"grad", "[", "f", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"Cos", "[", 
     RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"Sin", "[", "f", "]"}]}], " ", 
    RowBox[{"grad", "[", "f", "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grad", "[", 
   RowBox[{"Csc", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"-", 
    RowBox[{"Cot", "[", "f", "]"}]}], " ", 
   RowBox[{"Csc", "[", "f", "]"}], " ", 
   RowBox[{"grad", "[", "f", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"Sec", "[", 
     RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", "   ", 
   RowBox[{
    RowBox[{"Sec", "[", "f", "]"}], " ", 
    RowBox[{"Tan", "[", "f", "]"}], 
    RowBox[{"grad", "[", "f", "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grad", "[", 
   RowBox[{"Tan", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", "   ", 
  RowBox[{
   SuperscriptBox[
    RowBox[{"Sec", "[", "f", "]"}], "2"], " ", 
   RowBox[{"grad", "[", "f", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grad", "[", 
   RowBox[{"Cot", "[", 
    RowBox[{"f_", "?", "deg0Q"}], "]"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"-", 
    SuperscriptBox[
     RowBox[{"Csc", "[", "f", "]"}], "2"]}], " ", 
   RowBox[{"grad", "[", "f", "]"}]}]}]}], "Input",
 InitializationCell->True],

Cell["\<\
Exp[ x ]   is   Power[ E, x ]   so needs to be done like this,\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"grad", "[", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"a_", "?", "deg0Q"}], ")"}], 
    RowBox[{"b_", "?", "deg0Q"}]], "]"}], ":=", 
  RowBox[{
   RowBox[{"b", " ", 
    SuperscriptBox["a", 
     RowBox[{"b", "-", "1"}]], 
    RowBox[{"grad", "[", "a", "]"}]}], "+", 
   RowBox[{
    SuperscriptBox["a", "b"], " ", 
    RowBox[{"Log", "[", "a", "]"}], " ", 
    RowBox[{"grad", "[", "b", "]"}]}]}]}]], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "        grad[ ]   of  \[LeftAngleBracket]  ,  ,  ,  \[RightAngleBracket]  \
and  ",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", "   ", "\[RightAngleBracket]"}], "ab"], 
   TraditionalForm]]]
}], "Subsubsection"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", "X_", "\[RightAngleBracket]"}], 
     "ab__List"], "]"}], ":=", " ", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"grad", "[", "X", "]"}], "\[RightAngleBracket]"}], "ab"]}], 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "199", "]"}]], "Output"]
}, Open  ]],

Cell["For the 2-argument bracket:", "Text",
 CellChangeTimes->{{3.6146382438772306`*^9, 3.614638311588883*^9}, {
  3.6146387493337793`*^9, 3.614638774869255*^9}, {3.653868790617196*^9, 
  3.6538688174328003`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"X_", "?", "deg1Q"}], ",", "Y_"}], "\[RightAngleBracket]"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X", ",", 
      RowBox[{"grad", "[", "Y", "]"}]}], "\[RightAngleBracket]"}], "+", " ", 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"Y", "\[CircleTimes]", 
       RowBox[{"grad", "[", "X", "]"}]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{"deg", "[", "Y", "]"}], "+", "1"}]}], "}"}]]}]}], 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "200", "]"}]], "Output"]
}, Open  ]],

Cell["If   deg[X]  > 1  or if   deg[X]   is symbolic,", "Text",
 CellChangeTimes->{{3.653868671530657*^9, 3.653868725466053*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X_", ",", "Y_"}], "\[RightAngleBracket]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X", ",", 
      RowBox[{"grad", "[", "Y", "]"}]}], "\[RightAngleBracket]"}], "+", " ", 
    RowBox[{"mvToLast", "[", 
     RowBox[{
      RowBox[{"deg", "[", "X", "]"}], ",", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{"grad", "[", "X", "]"}], "\[CircleTimes]", "Y"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"deg", "[", "X", "]"}], ",", 
         RowBox[{
          RowBox[{"deg", "[", "X", "]"}], "+", "2"}]}], "}"}]]}], "]"}]}]}], 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "201", "]"}]], "Output"]
}, Open  ]],

Cell["For multi-arg  bracket:", "Text",
 CellChangeTimes->{{3.6146382438772306`*^9, 3.614638311588883*^9}, {
  3.6146387493337793`*^9, 3.614638774869255*^9}, {3.653868819976775*^9, 
  3.653868820312687*^9}}],

Cell["\<\
If  X  is deg 1 then do the mv  so that  \[Del]X  is on the right,\
\>", "Text",
 CellChangeTimes->{{3.6146382438772306`*^9, 3.614638311588883*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"a_AngleBracket", "/;", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "a", "]"}], ">", "2"}], " ", "&&", 
      RowBox[{
       RowBox[{"deg", "[", 
        RowBox[{"First", "[", "a", "]"}], "]"}], "===", "1"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"First", "[", "a", "]"}], ",", 
      RowBox[{"grad", "[", 
       RowBox[{"Rest", "[", "a", "]"}], "]"}]}], "\[RightAngleBracket]"}], 
    "+", 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"Rest", "[", "a", "]"}], "\[CircleTimes]", 
       RowBox[{"grad", "[", 
        RowBox[{"First", "[", "a", "]"}], "]"}]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", 
       RowBox[{
        RowBox[{"deg", "[", 
         RowBox[{"Rest", "[", "a", "]"}], "]"}], "+", "1"}]}], "}"}]]}]}], 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "202", "]"}]], "Output"]
}, Open  ]],

Cell["If   deg[X]  > 1  or if   deg[X]   is symbolic,", "Text",
 CellChangeTimes->{{3.653868671530657*^9, 3.653868725466053*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"a_AngleBracket", "/;", 
     RowBox[{
      RowBox[{"Length", "[", "a", "]"}], ">", "2"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"First", "[", "a", "]"}], ",", 
      RowBox[{"grad", "[", 
       RowBox[{"Rest", "[", "a", "]"}], "]"}]}], "\[RightAngleBracket]"}], 
    "+", 
    RowBox[{"mvToLast", "[", 
     RowBox[{
      RowBox[{"deg", "[", 
       RowBox[{"First", "[", "a", "]"}], "]"}], ",", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{"grad", "[", 
          RowBox[{"First", "[", "a", "]"}], "]"}], "\[CircleTimes]", 
         RowBox[{"Rest", "[", "a", "]"}]}], "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"deg", "[", 
          RowBox[{"First", "[", "a", "]"}], "]"}], ",", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"First", "[", "a", "]"}], "]"}], "+", "2"}]}], "}"}]]}], 
     "]"}]}]}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "203", "]"}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.655420152617146*^9, 3.655420170393196*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearField", "[", 
   RowBox[{"{", 
    RowBox[{"w", ",", "x", ",", "y", ",", "z"}], "}"}], "]"}], ";", 
  RowBox[{"NewField", "[", 
   RowBox[{
    RowBox[{"{", "1", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"w", ",", "x", ",", "y", ",", "z"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearField", "[", 
   RowBox[{"{", 
    RowBox[{"X", ",", "Y", ",", "Z"}], "}"}], "]"}], ";", 
  RowBox[{"NewField", "[", 
   RowBox[{
    RowBox[{"{", "2", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"X", ",", "Y", ",", "Z"}], "}"}]}], "]"}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6146399333056726`*^9, 3.614639939498863*^9}, {
   3.614642196652787*^9, 3.614642224996797*^9}, {3.614642461924663*^9, 
   3.6146424652405767`*^9}, {3.614659013781822*^9, 3.614659035146833*^9}, {
   3.614659085719261*^9, 3.614659117480957*^9}, {3.614659197669465*^9, 
   3.614659217960929*^9}, {3.6554124678951797`*^9, 3.6554124744385633`*^9}, 
   3.6554201703933163`*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170393375*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", 
    RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2"}], "]"}], "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"2", ",", "4"}], "}"}]], "]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.615687973742215*^9, 3.6538631623512907`*^9, 
  3.6538689336921864`*^9, 3.6554130474147377`*^9, 3.6554201703934402`*^9}],

Cell[BoxData[
 RowBox[{"StartDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614639965502326*^9, 3.6146399723030853`*^9}, 
   3.655420170393496*^9}],

Cell[BoxData[
 RowBox[{"StopDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659290326108*^9, 3.614659294295577*^9}, 
   3.6554201703935413`*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659127362576*^9, 3.614659133106614*^9}, 
   3.655420170393591*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]186\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"\[Del]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X_", ",", "Y_"}], "\[RightAngleBracket]"}]}], ":=", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", 
       RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
     RowBox[{"mvToLast", "[", 
      RowBox[{
       RowBox[{"deg", "[", "X", "]"}], ",", 
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
          RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"deg", "[", "X", "]"}], ",", 
          RowBox[{
           RowBox[{"deg", "[", "X", "]"}], "+", "2"}]}], "}"}]]}], "]"}]}]}]}],
  SequenceForm["rule[\[VeryThinSpace]186\[VeryThinSpace]]:", "  ", 
   Defer[Del[
      AngleBracket[
       Pattern[$CellContext`X, 
        Blank[]], 
       Pattern[$CellContext`Y, 
        Blank[]]]] := AngleBracket[$CellContext`X, 
       Del[$CellContext`Y]] + $CellContext`mvToLast[
       $CellContext`deg[$CellContext`X], 
       Subscript[
        AngleBracket[
         CircleTimes[
          Del[$CellContext`X], $CellContext`Y]], {
         $CellContext`deg[$CellContext`X], $CellContext`deg[$CellContext`X] + 
         2}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060096068*^9, 
  3.655420170393639*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", 
       RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
     RowBox[{"mvToLast", "[", 
      RowBox[{
       RowBox[{"deg", "[", "X", "]"}], ",", 
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
          RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"deg", "[", "X", "]"}], ",", 
          RowBox[{
           RowBox[{"deg", "[", "X", "]"}], "+", "2"}]}], "}"}]]}], "]"}]}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[AngleBracket[$CellContext`X, 
      Del[$CellContext`Y]] + $CellContext`mvToLast[
      $CellContext`deg[$CellContext`X], 
      Subscript[
       AngleBracket[
        CircleTimes[
         Del[$CellContext`X], $CellContext`Y]], {
        $CellContext`deg[$CellContext`X], $CellContext`deg[$CellContext`X] + 
        2}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060208335*^9, 
  3.65542017039368*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]1\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"\[CircleTimes]", "v_"}], ":=", "v"}]}],
  SequenceForm["rule[\[VeryThinSpace]1\[VeryThinSpace]]:", "  ", 
   Defer[CircleTimes[
      Pattern[$CellContext`v, 
       Blank[]]] := $CellContext`v]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060209475*^9, 
  3.655420170393721*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{"\[Del]", "X"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    Del[$CellContext`X]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060360302*^9, 
  3.6554201703937597`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]59\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{
     RowBox[{"mvToLast", "[", 
      RowBox[{"n_Integer", ",", "X_"}], "]"}], "/;", 
     RowBox[{"TrueQ", "[", 
      RowBox[{"n", "<", 
       RowBox[{"deg", "[", "X", "]"}]}], "]"}]}], ":=", 
    RowBox[{
     RowBox[{"mv", "[", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", "X", "]"}], "]"}], ",", "n"}], "]"}], ",", 
        "n"}], "]"}], "]"}], "[", "X", "]"}]}]}],
  SequenceForm["rule[\[VeryThinSpace]59\[VeryThinSpace]]:", "  ", 
   Defer[Condition[
      $CellContext`mvToLast[
       Pattern[$CellContext`n, 
        Blank[Integer]], 
       Pattern[$CellContext`X, 
        Blank[]]], 
      TrueQ[$CellContext`n < $CellContext`deg[$CellContext`X]]] := \
$CellContext`mv[
      Append[
       DeleteCases[
        Range[
         $CellContext`deg[$CellContext`X]], $CellContext`n], \
$CellContext`n]][$CellContext`X]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060427655*^9, 
  3.655420170393799*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{
     RowBox[{"mv", "[", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", 
            SubscriptBox[
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{
               RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
              "\[RightAngleBracket]"}], 
             RowBox[{"{", 
              RowBox[{"2", ",", "4"}], "}"}]], "]"}], "]"}], ",", "2"}], 
         "]"}], ",", "2"}], "]"}], "]"}], "[", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
       "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"2", ",", "4"}], "}"}]], "]"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    $CellContext`mv[
     Append[
      DeleteCases[
       Range[
        $CellContext`deg[
         Subscript[
          AngleBracket[
           CircleTimes[
            Del[$CellContext`X], $CellContext`Y]], {2, 4}]]], 2], 2]][
     Subscript[
      AngleBracket[
       CircleTimes[
        Del[$CellContext`X], $CellContext`Y]], {2, 4}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060521605*^9, 
  3.65542017039384*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]36\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"mv", "[", "n_List", "]"}], ":=", 
    RowBox[{"mv", "[", 
     RowBox[{"Sequence", "@@", "n"}], "]"}]}]}],
  SequenceForm["rule[\[VeryThinSpace]36\[VeryThinSpace]]:", "  ", 
   Defer[$CellContext`mv[
      Pattern[$CellContext`n, 
       Blank[List]]] := $CellContext`mv[
      Apply[Sequence, $CellContext`n]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.655413060522402*^9, 
  3.65542017039388*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{"mv", "[", 
     RowBox[{"Sequence", "@@", 
      RowBox[{"{", 
       RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "]"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    $CellContext`mv[
     Apply[Sequence, {1, 3, 2}]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653868942346292*^9, 3.6554130606726227`*^9, 
  3.655420170393921*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", 
    RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2"}], "]"}], "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"2", ",", "4"}], "}"}]], "]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.6538689429488773`*^9, 3.6554130606733828`*^9, 
  3.655420170393968*^9}],

Cell[BoxData[
 RowBox[{"StopDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659290326108*^9, 3.614659294295577*^9}, 
   3.655420170394003*^9}],

Cell[BoxData[{
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(", 
   RowBox[{"%", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"X", "\[Rule]", 
       RowBox[{"x", "\[CircleTimes]", "y"}]}], ",", 
      RowBox[{"Y", "\[Rule]", 
       RowBox[{"z", "\[CircleTimes]", "w"}]}]}], "}"}]}], ")"}], " ", "-", 
  " ", 
  RowBox[{"\[Del]", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}], "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"X", "\[Rule]", 
        RowBox[{"x", "\[CircleTimes]", "y"}]}], ",", 
       RowBox[{"Y", "\[Rule]", 
        RowBox[{"z", "\[CircleTimes]", "w"}]}]}], "}"}]}], 
    ")"}]}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659162915042*^9, 3.6146591933006144`*^9}, {
   3.6146592306610937`*^9, 3.614659269944994*^9}, 3.655420170394047*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", 
    RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2"}], "]"}], "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", "X"}], "\[CircleTimes]", "Y"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"2", ",", "4"}], "}"}]], "]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653856967441422*^9, 3.6538689558588543`*^9, 
  3.6538689979319572`*^9, 3.655420170394095*^9}],

Cell[BoxData["0"], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653856967441422*^9, 3.6538689558588543`*^9, 
  3.653868997939365*^9, 3.655420170394156*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170394189*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", 
    RowBox[{"\[Del]", "y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"y", ",", 
    RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.615688118415242*^9, 3.6538570564166603`*^9, 
  3.6538690030247507`*^9, 3.6554201703942347`*^9}],

Cell[BoxData[
 RowBox[{"StartDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614639965502326*^9, 3.6146399723030853`*^9}, 
   3.65542017039427*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "y"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170394299*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]183\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"\[Del]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"X_", "?", "deg1Q"}], ",", "Y_"}], "\[RightAngleBracket]"}]}], 
    ":=", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X", ",", 
       RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}], "+", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"Y", "\[CircleTimes]", 
        RowBox[{"\[Del]", "X"}]}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"deg", "[", "Y", "]"}], "+", "1"}]}], "}"}]]}]}]}],
  SequenceForm["rule[\[VeryThinSpace]183\[VeryThinSpace]]:", "  ", 
   Defer[Del[
      AngleBracket[
       PatternTest[
        Pattern[$CellContext`X, 
         Blank[]], $CellContext`deg1Q], 
       Pattern[$CellContext`Y, 
        Blank[]]]] := AngleBracket[$CellContext`X, 
       Del[$CellContext`Y]] + Subscript[
       AngleBracket[
        CircleTimes[$CellContext`Y, 
         Del[$CellContext`X]]], {1, $CellContext`deg[$CellContext`Y] + 1}]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653869017562316*^9, 3.65542017039434*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"x", ",", 
       RowBox[{"\[Del]", "y"}]}], "\[RightAngleBracket]"}], "+", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"y", "\[CircleTimes]", 
        RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{
         RowBox[{"deg", "[", "y", "]"}], "+", "1"}]}], "}"}]]}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[AngleBracket[$CellContext`x, 
      Del[$CellContext`y]] + Subscript[
      AngleBracket[
       CircleTimes[$CellContext`y, 
        Del[$CellContext`x]]], {1, $CellContext`deg[$CellContext`y] + 1}]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653869017698135*^9, 3.655420170394382*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"rule[\[VeryThinSpace]74\[VeryThinSpace]]:\"\>", 
   "\[InvisibleSpace]", "\<\"  \"\>", "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1_", "\[CircleTimes]", "X2_"}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
     RowBox[{
      RowBox[{"a", "===", 
       RowBox[{"deg", "[", "X1", "]"}]}], "&&", 
      RowBox[{"b", "===", 
       RowBox[{"a", "+", "1"}]}]}]}], ":=", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}]}],
  SequenceForm["rule[\[VeryThinSpace]74\[VeryThinSpace]]:", "  ", 
   Defer[Condition[
      Subscript[
       AngleBracket[
        CircleTimes[
         Pattern[$CellContext`X1, 
          Blank[]], 
         Pattern[$CellContext`X2, 
          Blank[]]]], {
        Pattern[$CellContext`a, 
         Blank[]], 
        Pattern[$CellContext`b, 
         Blank[]]}], 
      And[$CellContext`a === $CellContext`deg[$CellContext`X1], \
$CellContext`b === $CellContext`a + 1]] := 
    AngleBracket[$CellContext`X1, $CellContext`X2]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.65386901770238*^9, 3.655420170394423*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"    rhs =   \"\>", "\[InvisibleSpace]", 
   TagBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"y", ",", 
      RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}],
    HoldForm]}],
  SequenceForm["    rhs =   ", 
   HoldForm[
    AngleBracket[$CellContext`y, 
     Del[$CellContext`x]]]],
  Editable->False]], "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.653869017849453*^9, 3.655420170394477*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", 
    RowBox[{"\[Del]", "y"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"y", ",", 
    RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{
  3.614642443732833*^9, {3.6146542316142187`*^9, 3.6146542520714493`*^9}, 
   3.614658924623312*^9, 3.653857068577862*^9, {3.65386901405835*^9, 
   3.65386901785402*^9}, 3.6554201703945227`*^9}],

Cell[BoxData[
 RowBox[{"StopDebug", "[", "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.614659290326108*^9, 3.614659294295577*^9}, 
   3.655420170394557*^9}],

Cell[BoxData[
 RowBox[{"\[Del]", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "Y", ",", "z"}], "\[RightAngleBracket]"}]}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.655420170394588*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"z", ",", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"x", ",", 
      RowBox[{"\[Del]", "Y"}]}], "\[RightAngleBracket]"}]}], 
   "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"Y", ",", "z"}], "\[RightAngleBracket]"}], ",", 
    RowBox[{"\[Del]", "x"}]}], "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"x", ",", "Y", ",", 
    RowBox[{"\[Del]", "z"}]}], "\[RightAngleBracket]"}]}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.65386903700355*^9, 3.6554201703946342`*^9}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["        grad[ ]   of  mv[ ][ ] ", "Subsubsection"],

Cell["mv[ ]  and  grad[ ]  commute,", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{
     RowBox[{"mv", "[", "n__", "]"}], "[", "X_", "]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"mv", "[", "n", "]"}], "[", 
    RowBox[{"grad", "[", "X", "]"}], "]"}]}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "204", "]"}]], "Output"]
}, Open  ]],

Cell["\<\
mvToLast[ ]   is just a special case of  mv[ ],   but the last slot of  X   \
is the 2nd last slot of   \[Del]X   so we need to move the \[Del]-slot to \
last,\
\>", "Text",
 CellChangeTimes->{{3.6538635911729*^9, 3.653863624532516*^9}, {
   3.653863713987352*^9, 3.6538637461787863`*^9}, {3.653864179646039*^9, 
   3.653864197181723*^9}, {3.653866856687839*^9, 3.653866865871585*^9}, 
   3.65386693071896*^9, {3.653867033549869*^9, 3.6538670829094133`*^9}, {
   3.653867152044527*^9, 3.653867213260007*^9}, {3.653867477113244*^9, 
   3.653867543752431*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"mvToLast", "[", 
     RowBox[{"n_", ",", "X_"}], "]"}], "]"}], ":=", 
   RowBox[{"mvToLast", "[", 
    RowBox[{
     RowBox[{"deg", "[", "X", "]"}], ",", 
     RowBox[{
      RowBox[{"mvToLast", "[", "n", "]"}], "[", 
      RowBox[{"grad", "[", "X", "]"}], "]"}]}], "]"}]}], "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "205", "]"}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651605156106372*^9, 3.651605157450458*^9}, 
   3.655420283191711*^9}],

Cell[BoxData[
 RowBox[{"mvToLast", "[", 
  RowBox[{
   RowBox[{"deg", "[", "X", "]"}], ",", "X"}], "]"}]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.653867414910058*^9, 3.653867426762618*^9}, 
   3.6554202831917953`*^9}],

Cell[BoxData["X"], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6554202706298723`*^9, 3.655420283191875*^9}}],

Cell["\<\
If fixed-length args for  mv[n]  are being used then the resulting  mv  will \
automatically become  mv[n, deg[X+1] ] ,\
\>", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604915821741*^9, 3.6516050499491377`*^9}, {
   3.6516050904433203`*^9, 3.6516050906674747`*^9}, 3.655420283191924*^9}],

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"X", ",", "Y"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{"2", ",", "X"}], "]"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604011194244*^9, 3.651604022524269*^9}, {
   3.651604097562748*^9, 3.651604116074546*^9}, {3.651605120796707*^9, 
   3.651605133501232*^9}, 3.655420283191963*^9}],

Cell[BoxData[{
 RowBox[{"\[Del]", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "1"}], "]"}], "[", "X", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"\[Del]", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "1"}], "]"}], "[", "Y", "]"}]}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604042665856*^9, 3.651604059579987*^9}, {
   3.6516051376143084`*^9, 3.651605142175061*^9}, 3.6554202831920023`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1", ",", "3"}], "]"}], "[", 
  RowBox[{"\[Del]", "X"}], "]"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604054508523*^9, 3.651604060890423*^9}, 
   3.651604175910171*^9, 3.65160514317831*^9, 3.653867604787859*^9, 
   3.6554202831920443`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1"}], "]"}], "[", 
  RowBox[{"\[Del]", "Y"}], "]"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.651604054508523*^9, 3.651604060890423*^9}, 
   3.651604175910171*^9, 3.65160514317831*^9, 3.653867604794312*^9, 
   3.655420283192082*^9}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["        grad[ ]   of Series", "Subsubsection"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", "f_SeriesData", "]"}], " ", ":=", " ", 
   RowBox[{"Series", "[", 
    RowBox[{
     RowBox[{"grad", "[", 
      RowBox[{"Normal", "[", "f", "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"f", "[", 
        RowBox[{"[", "2", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"[", "5", "]"}], "]"}], "-", "2"}]}], "}"}]}], "]"}]}], 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"rule", "[", "206", "]"}]], "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[TextData[{
 "\nAfter expressions have been fully expanded using the above rules for \
grad[ ],  **then**  apply any known values for \[Del].\nIt is important to do \
things in this order, else the simplification rules are going to struggle \
trying to cancel inner  g  with outer ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["g", 
    RowBox[{"-", "1"}]], TraditionalForm]]],
 ".\nFor example, the external field code for taking grad[ ]  of a Taylor \
expansion of F (with F of vector type)  wont simplify as it should."
}], "Text"],

Cell["\<\
Something weird. Might need to run this before so that it works after,\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Definition", "[", "grad", "]"}], ";"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{"grad", "[", 
    RowBox[{"X_", "/;", 
     RowBox[{"ValueQ", "[", 
      RowBox[{"\[Del]", "X"}], "]"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", "X"}], ",", 
      RowBox[{"MetricInverse", "[", "]"}]}], "\[RightAngleBracket]"}], "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Del]", "Y_"}], "\[RuleDelayed]", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{
        RowBox[{"grad", "[", "Y", "]"}], ",", 
        RowBox[{"Metric", "[", "]"}]}], "\[RightAngleBracket]"}]}], "}"}]}]}],
   "]"}]], "Input",
 InitializationCell->True,
 CellID->807694977],

Cell[BoxData[
 RowBox[{"rule", "[", "207", "]"}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Definition", "[", "grad", "]"}]], "Input"],

Cell[BoxData[
 InterpretationBox[GridBox[{
    {
     RowBox[{
      RowBox[{"Attributes", "[", "grad", "]"}], "=", 
      RowBox[{"{", "Listable", "}"}]}]},
    {" "},
    {GridBox[{
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"a_", "?", "NumericQ"}]}], "=", "0"}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], "v_Plus"}], ":=", 
         RowBox[{"grad", "/@", "v"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"f1_", " ", "f2_"}]}], ":=", 
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"f1", "\[CircleTimes]", 
            RowBox[{
             SuperscriptBox["\[Del]", "\[Sharp]"], "f2"}]}], "+", 
           RowBox[{"f2", "\[CircleTimes]", 
            RowBox[{
             SuperscriptBox["\[Del]", "\[Sharp]"], "f1"}]}]}], "]"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], "v_CircleTimes"}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "197", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{
             RowBox[{"mvToLast", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"deg", "[", 
                 RowBox[{"First", "[", "v", "]"}], "]"}], "+", "1"}], ",", 
               RowBox[{
                RowBox[{
                 SuperscriptBox["\[Del]", "\[Sharp]"], 
                 RowBox[{"First", "[", "v", "]"}]}], "\[CircleTimes]", 
                RowBox[{"Rest", "[", "v", "]"}]}]}], "]"}], "+", 
             RowBox[{
              RowBox[{"First", "[", "v", "]"}], "\[CircleTimes]", 
              RowBox[{
               SuperscriptBox["\[Del]", "\[Sharp]"], 
               RowBox[{"Rest", "[", "v", "]"}]}]}]}], "]"}]}], ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"f_", "?", "deg0Q"}], ")"}], "p_"]}], ":=", 
         RowBox[{"p", " ", 
          SuperscriptBox["f", 
           RowBox[{"p", "-", "1"}]], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"Sin", "[", 
           RowBox[{"f_", "?", "deg0Q"}], "]"}]}], ":=", 
         RowBox[{
          RowBox[{"Cos", "[", "f", "]"}], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"Cos", "[", 
           RowBox[{"f_", "?", "deg0Q"}], "]"}]}], ":=", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "f", "]"}]}], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"Csc", "[", 
           RowBox[{"f_", "?", "deg0Q"}], "]"}]}], ":=", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Cot", "[", "f", "]"}]}], " ", 
          RowBox[{"Csc", "[", "f", "]"}], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"Sec", "[", 
           RowBox[{"f_", "?", "deg0Q"}], "]"}]}], ":=", 
         RowBox[{
          RowBox[{"Sec", "[", "f", "]"}], " ", 
          RowBox[{"Tan", "[", "f", "]"}], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"Tan", "[", 
           RowBox[{"f_", "?", "deg0Q"}], "]"}]}], ":=", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"Sec", "[", "f", "]"}], "2"], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"Cot", "[", 
           RowBox[{"f_", "?", "deg0Q"}], "]"}]}], ":=", 
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox[
            RowBox[{"Csc", "[", "f", "]"}], "2"]}], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"f_", "?", "deg0Q"}]]}], ":=", 
         RowBox[{
          RowBox[{"Exp", "[", "f", "]"}], " ", 
          RowBox[{
           SuperscriptBox["\[Del]", "\[Sharp]"], "f"}]}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"\<\"Subscript\"\>", "[", 
           RowBox[{
            RowBox[{"\[LeftAngleBracket]", "X_", "\[RightAngleBracket]"}], 
            ",", "ab__List"}], "]"}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "198", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{"\<\"Subscript\"\>", "[", 
             RowBox[{
              RowBox[{"\[LeftAngleBracket]", 
               RowBox[{
                SuperscriptBox["\[Del]", "\[Sharp]"], "X"}], 
               "\[RightAngleBracket]"}], ",", "ab"}], "]"}], "]"}]}], ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"\[LeftAngleBracket]", 
           RowBox[{
            RowBox[{"X_", "?", "deg1Q"}], ",", "Y_"}], 
           "\[RightAngleBracket]"}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "199", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{"X", ",", 
               RowBox[{
                SuperscriptBox["\[Del]", "\[Sharp]"], "Y"}]}], 
              "\[RightAngleBracket]"}], "+", 
             RowBox[{"\<\"Subscript\"\>", "[", 
              RowBox[{
               RowBox[{"\[LeftAngleBracket]", 
                RowBox[{"Y", "\[CircleTimes]", 
                 RowBox[{
                  SuperscriptBox["\[Del]", "\[Sharp]"], "X"}]}], 
                "\[RightAngleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{
                  RowBox[{"deg", "[", "Y", "]"}], "+", "1"}]}], "}"}]}], 
              "]"}]}], "]"}]}], ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"\[LeftAngleBracket]", 
           RowBox[{"X_", ",", "Y_"}], "\[RightAngleBracket]"}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "200", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{"X", ",", 
               RowBox[{
                SuperscriptBox["\[Del]", "\[Sharp]"], "Y"}]}], 
              "\[RightAngleBracket]"}], "+", 
             RowBox[{"mvToLast", "[", 
              RowBox[{
               RowBox[{"deg", "[", "X", "]"}], ",", 
               RowBox[{"\<\"Subscript\"\>", "[", 
                RowBox[{
                 RowBox[{"\[LeftAngleBracket]", 
                  RowBox[{
                   RowBox[{
                    SuperscriptBox["\[Del]", "\[Sharp]"], "X"}], 
                   "\[CircleTimes]", "Y"}], "\[RightAngleBracket]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"deg", "[", "X", "]"}], ",", 
                   RowBox[{
                    RowBox[{"deg", "[", "X", "]"}], "+", "2"}]}], "}"}]}], 
                "]"}]}], "]"}]}], "]"}]}], ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"a_AngleBracket", "/;", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "a", "]"}], ">", "2"}], "&&", 
            RowBox[{
             RowBox[{"deg", "[", 
              RowBox[{"First", "[", "a", "]"}], "]"}], "===", "1"}]}]}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "201", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{
               RowBox[{"First", "[", "a", "]"}], ",", 
               RowBox[{
                SuperscriptBox["\[Del]", "\[Sharp]"], 
                RowBox[{"Rest", "[", "a", "]"}]}]}], "\[RightAngleBracket]"}],
              "+", 
             RowBox[{"\<\"Subscript\"\>", "[", 
              RowBox[{
               RowBox[{"\[LeftAngleBracket]", 
                RowBox[{
                 RowBox[{"Rest", "[", "a", "]"}], "\[CircleTimes]", 
                 RowBox[{
                  SuperscriptBox["\[Del]", "\[Sharp]"], 
                  RowBox[{"First", "[", "a", "]"}]}]}], 
                "\[RightAngleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{
                  RowBox[{"deg", "[", 
                   RowBox[{"Rest", "[", "a", "]"}], "]"}], "+", "1"}]}], 
                "}"}]}], "]"}]}], "]"}]}], ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"a_AngleBracket", "/;", 
           RowBox[{
            RowBox[{"Length", "[", "a", "]"}], ">", "2"}]}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "202", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{
               RowBox[{"First", "[", "a", "]"}], ",", 
               RowBox[{
                SuperscriptBox["\[Del]", "\[Sharp]"], 
                RowBox[{"Rest", "[", "a", "]"}]}]}], "\[RightAngleBracket]"}],
              "+", 
             RowBox[{"mvToLast", "[", 
              RowBox[{
               RowBox[{"deg", "[", 
                RowBox[{"First", "[", "a", "]"}], "]"}], ",", 
               RowBox[{"\<\"Subscript\"\>", "[", 
                RowBox[{
                 RowBox[{"\[LeftAngleBracket]", 
                  RowBox[{
                   RowBox[{
                    SuperscriptBox["\[Del]", "\[Sharp]"], 
                    RowBox[{"First", "[", "a", "]"}]}], "\[CircleTimes]", 
                   RowBox[{"Rest", "[", "a", "]"}]}], 
                  "\[RightAngleBracket]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"deg", "[", 
                    RowBox[{"First", "[", "a", "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"deg", "[", 
                    RowBox[{"First", "[", "a", "]"}], "]"}], "+", "2"}]}], 
                  "}"}]}], "]"}]}], "]"}]}], "]"}]}], ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{
           RowBox[{"mv", "[", "n__", "]"}], "[", "X_", "]"}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "203", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{
             RowBox[{"mv", "[", "n", "]"}], "[", 
             RowBox[{
              SuperscriptBox["\[Del]", "\[Sharp]"], "X"}], "]"}], "]"}]}], 
          ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"mvToLast", "[", 
           RowBox[{"n_", ",", "X_"}], "]"}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "204", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{"mvToLast", "[", 
             RowBox[{
              RowBox[{"deg", "[", "X", "]"}], ",", 
              RowBox[{
               RowBox[{"mvToLast", "[", "n", "]"}], "[", 
               RowBox[{
                SuperscriptBox["\[Del]", "\[Sharp]"], "X"}], "]"}]}], "]"}], 
            "]"}]}], ")"}]}]},
       {" "},
       {
        RowBox[{
         RowBox[{
          SuperscriptBox["\[Del]", "\[Sharp]"], 
          RowBox[{"X_", "/;", 
           RowBox[{"ValueQ", "[", 
            RowBox[{"\[Del]", "X"}], "]"}]}]}], ":=", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"LogAsUsed", "[", "379", "]"}], ";", 
           RowBox[{"Snoopr", "[", 
            RowBox[{
             RowBox[{"\[LeftAngleBracket]", 
              RowBox[{
               RowBox[{"\[Del]", "X"}], ",", 
               RowBox[{"MetricInverse", "[", "]"}]}], 
              "\[RightAngleBracket]"}], "/.", "\[VeryThinSpace]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"\[Del]", "Y_"}], "\[RuleDelayed]", 
               RowBox[{"\[LeftAngleBracket]", 
                RowBox[{
                 RowBox[{
                  SuperscriptBox["\[Del]", "\[Sharp]"], "Y"}], ",", 
                 RowBox[{"Metric", "[", "]"}]}], "\[RightAngleBracket]"}]}], 
              "}"}]}], "]"}]}], ")"}]}]}
      },
      BaselinePosition->{Baseline, {1, 1}},
      GridBoxAlignment->{
       "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
        "RowsIndexed" -> {}},
      GridBoxItemSize->{"Columns" -> {{
           Scaled[0.999]}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
        "RowsIndexed" -> {}}]},
    {" "},
    {GridBox[{
       {
        RowBox[{"grad", "/:", 
         RowBox[{"MakeBoxes", "[", 
          RowBox[{
           RowBox[{
            SuperscriptBox["\[Del]", "\[Sharp]"], "x_"}], 
           ",", "\<\"StandardForm\"\>"}], "]"}], ":=", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"SuperscriptBox", "[", 
             RowBox[{"\<\"\[Del]\"\>", ",", "\<\"\[Sharp]\"\>"}], "]"}], ",", 
            
            RowBox[{"ToBoxes", "[", 
             RowBox[{"x", ",", "\<\"StandardForm\"\>"}], "]"}]}], "}"}], 
          "]"}]}]}
      },
      BaselinePosition->{Baseline, {1, 1}},
      GridBoxAlignment->{
       "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
        "RowsIndexed" -> {}},
      GridBoxItemSize->{"Columns" -> {{
           Scaled[0.999]}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
        "RowsIndexed" -> {}}]}
   },
   BaselinePosition->{Baseline, {1, 1}},
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}}],
  Definition[$CellContext`grad],
  Editable->False]], "Output"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["The curvature identity  --  messing about", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
   3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
   3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
   3.48042476399629*^9, 3.480424778951466*^9}, {3.480477169549407*^9, 
   3.480477199429993*^9}, 3.480477245698426*^9, {3.653716892089407*^9, 
   3.6537168992891293`*^9}, {3.653817000525063*^9, 3.653817034508738*^9}, {
   3.653880782939595*^9, 3.653880789099317*^9}, {3.655420842544986*^9, 
   3.655420848544963*^9}}],

Cell["-----------------------------------------------------------", "Text",
 CellChangeTimes->{{3.653874100043811*^9, 3.653874102880063*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"u", ",", "v", ",", "W", ",", "X", ",", "Y", ",", "Z"}], "}"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"u", ",", "v"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.653852628119523*^9, 3.653852649374296*^9}, {
  3.653867859077976*^9, 3.653867872678001*^9}, {3.653868158146668*^9, 
  3.653868164402216*^9}, {3.6538682390415*^9, 3.653868243633288*^9}, {
  3.653874140942709*^9, 3.6538741414705*^9}, {3.655421416138832*^9, 
  3.6554214186985826`*^9}}],

Cell[BoxData[
 TemplateBox[{RowBox[{"{", 
     RowBox[{"u", ",", "v"}], "}"}],
   "\" are sections of the tangent bundle \"",
   RowBox[{"\"T\"", "[", "\"M\"", "]"}],"\".\""},
  "RowDefault"]], "Output",
 CellChangeTimes->{3.655421419150319*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  SubscriptBox["\[Del]", "v"], 
  RowBox[{"(", 
   RowBox[{"X", "\[CircleTimes]", "Y"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.653852453079296*^9, 3.653852475744843*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"X", "\[CircleTimes]", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Del]", "Y"}], ",", "v"}], "\[RightAngleBracket]"}]}], "+", 
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Del]", "X"}], ",", "v"}], "\[RightAngleBracket]"}], 
   "\[CircleTimes]", "Y"}]}]], "Output",
 CellChangeTimes->{{3.653852465585885*^9, 3.653852476631269*^9}, {
   3.653852511704603*^9, 3.653852532815044*^9}, 3.65386783159735*^9, 
   3.6538740412545652`*^9, 3.653874075641822*^9, 3.653877053920096*^9, 
   3.653877202069352*^9, 3.653877433459996*^9, 3.655421443533732*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  SubscriptBox["\[Del]", "v"], 
  RowBox[{"(", 
   RowBox[{
   "W", "\[CircleTimes]", "X", "\[CircleTimes]", "Y", "\[CircleTimes]", "Z"}],
    ")"}]}]], "Input",
 CellChangeTimes->{{3.6538740809252872`*^9, 3.653874087805027*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"W", "\[CircleTimes]", "X", "\[CircleTimes]", "Y", "\[CircleTimes]", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Del]", "Z"}], ",", "v"}], "\[RightAngleBracket]"}]}], "+", 
  RowBox[{"W", "\[CircleTimes]", "X", "\[CircleTimes]", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Del]", "Y"}], ",", "v"}], "\[RightAngleBracket]"}], 
   "\[CircleTimes]", "Z"}], "+", 
  RowBox[{"W", "\[CircleTimes]", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Del]", "X"}], ",", "v"}], "\[RightAngleBracket]"}], 
   "\[CircleTimes]", "Y", "\[CircleTimes]", "Z"}], "+", 
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Del]", "W"}], ",", "v"}], "\[RightAngleBracket]"}], 
   "\[CircleTimes]", "X", "\[CircleTimes]", "Y", "\[CircleTimes]", 
   "Z"}]}]], "Output",
 CellChangeTimes->{3.653874088254033*^9, 3.653877445412508*^9, 
  3.655421445379397*^9}]
}, Open  ]],

Cell["-----------------------------------------------------------", "Text",
 CellChangeTimes->{{3.653874100043811*^9, 3.653874102880063*^9}}],

Cell["Note that  X  is arbitrary degree,", "Text",
 CellChangeTimes->{{3.653881186023243*^9, 3.653881212903047*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"u", ",", "v", ",", "X"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{
   RowBox[{"{", "1", "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"u", ",", "v"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.653852628119523*^9, 3.653852649374296*^9}, {
   3.653867859077976*^9, 3.653867872678001*^9}, {3.653868158146668*^9, 
   3.653868164402216*^9}, {3.6538682390415*^9, 3.653868243633288*^9}, {
   3.653874140942709*^9, 3.6538741414705*^9}, 3.653881197976747*^9}],

Cell[BoxData[
 TemplateBox[{RowBox[{"{", 
     RowBox[{"u", ",", "v"}], "}"}],
   "\" are sections of the tangent bundle \"",
   RowBox[{"\"T\"", "[", "\"M\"", "]"}],"\".\""},
  "RowDefault"]], "Output",
 CellChangeTimes->{3.655421461515628*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   SubscriptBox["\[Del]", "u"], 
   RowBox[{
    SubscriptBox["\[Del]", "v"], "X"}]}], "-", 
  RowBox[{
   SubscriptBox["\[Del]", "v"], 
   RowBox[{
    SubscriptBox["\[Del]", "u"], "X"}]}]}]], "Input",
 CellChangeTimes->{{3.653868254000689*^9, 3.653868275536647*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", 
       RowBox[{"\[Del]", "X"}]}], ",", "u"}], "\[RightAngleBracket]"}], ",", 
    "v"}], "\[RightAngleBracket]"}], "-", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", 
       RowBox[{"\[Del]", "X"}]}], ",", "v"}], "\[RightAngleBracket]"}], ",", 
    "u"}], "\[RightAngleBracket]"}], "-", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[Del]", "X"}], ",", 
    RowBox[{"\[Del]", "u"}], ",", "v"}], "\[RightAngleBracket]"}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[Del]", "X"}], ",", 
    RowBox[{"\[Del]", "v"}], ",", "u"}], "\[RightAngleBracket]"}]}]], "Output",\

 CellChangeTimes->{
  3.653874207350411*^9, {3.65387524342552*^9, 3.653875264652269*^9}, 
   3.653880501336566*^9, 3.653880544622723*^9, 3.6554214696697273`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"XR", "=", 
  RowBox[{
   RowBox[{"\[Del]", 
    RowBox[{"\[Del]", "X"}]}], "-", 
   RowBox[{"mvToLast", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"deg", "[", "X", "]"}], "+", "1"}], ",", 
     RowBox[{"\[Del]", 
      RowBox[{"\[Del]", "X"}]}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6538694891193733`*^9, 3.6538695254093924`*^9}, {
  3.653869601890239*^9, 3.653869603777178*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Del]", 
   RowBox[{"\[Del]", "X"}]}], "-", 
  RowBox[{"mvToLast", "[", 
   RowBox[{
    RowBox[{"1", "+", 
     RowBox[{"deg", "[", "X", "]"}]}], ",", 
    RowBox[{"\[Del]", 
     RowBox[{"\[Del]", "X"}]}]}], "]"}]}]], "Output",
 CellChangeTimes->{3.653869534294731*^9, 3.653869605595249*^9, 
  3.653873906897573*^9, 3.653880588533619*^9, 3.655421473175424*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[LeftAngleBracket]", 
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"XR", ",", "u"}], "\[RightAngleBracket]"}], ",", "v"}], 
  "\[RightAngleBracket]"}]], "Input",
 CellChangeTimes->{{3.653869586115396*^9, 3.6538696568802557`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", 
       RowBox[{"\[Del]", "X"}]}], ",", "u"}], "\[RightAngleBracket]"}], ",", 
    "v"}], "\[RightAngleBracket]"}], "-", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Del]", 
       RowBox[{"\[Del]", "X"}]}], ",", "v"}], "\[RightAngleBracket]"}], ",", 
    "u"}], "\[RightAngleBracket]"}]}]], "Output",
 CellChangeTimes->{{3.6538696309137287`*^9, 3.653869657341646*^9}, 
   3.653880601683975*^9, 3.65542147553578*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  SubscriptBox["\[Del]", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Del]", "u"], "v"}], "-", 
    RowBox[{
     SubscriptBox["\[Del]", "v"], "u"}]}]], "X"}]], "Input",
 CellChangeTimes->{{3.653870570873892*^9, 3.6538705995397587`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Del]", "X"}], ",", 
     RowBox[{"\[Del]", "u"}], ",", "v"}], "\[RightAngleBracket]"}]}], "+", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[Del]", "X"}], ",", 
    RowBox[{"\[Del]", "v"}], ",", "u"}], "\[RightAngleBracket]"}]}]], "Output",\

 CellChangeTimes->{3.653870602341151*^9, 3.653872641115803*^9, 
  3.653880604114929*^9, 3.655421476906457*^9}]
}, Open  ]],

Cell[TextData[{
 "The Torsion tensor enters in two places:  in XR  and in ",
 Cell[BoxData[
  RowBox[{"  ", 
   RowBox[{
    RowBox[{
     SubscriptBox["\[Del]", "u"], "v"}], "-", 
    RowBox[{
     SubscriptBox["\[Del]", "v"], "u"}]}]}]],
  CellChangeTimes->{{3.6538707744337893`*^9, 3.653870802447507*^9}}],
 " .  \nNash and Sen, p187."
}], "Text",
 CellChangeTimes->{{3.653882442209168*^9, 3.653882534953046*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"XR", ",", "u"}], "\[RightAngleBracket]"}], ",", "v"}], 
    "\[RightAngleBracket]"}]}], "+", 
  RowBox[{
   SubscriptBox["\[Del]", "u"], 
   RowBox[{
    SubscriptBox["\[Del]", "v"], "X"}]}], "-", 
  RowBox[{
   SubscriptBox["\[Del]", "v"], 
   RowBox[{
    SubscriptBox["\[Del]", "u"], "X"}]}], " ", "-", " ", 
  RowBox[{
   SubscriptBox["\[Del]", 
    RowBox[{
     RowBox[{
      SubscriptBox["\[Del]", "u"], "v"}], "-", 
     RowBox[{
      SubscriptBox["\[Del]", "v"], "u"}]}]], "X"}]}]], "Input",
 CellChangeTimes->{{3.6538707744337893`*^9, 3.653870802447507*^9}}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{
  3.6538737639128857`*^9, {3.6538738159505177`*^9, 3.6538738542858133`*^9}, {
   3.653873924588516*^9, 3.653873935588706*^9}, 3.653880661625823*^9, 
   3.655421486419661*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Divergence and curl,  as in  F = curl [A]", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
   3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
   3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
   3.467126548768611*^9, 3.467126560140989*^9}, {3.467126913123894*^9, 
   3.46712691617785*^9}, {3.480478649322764*^9, 3.480478654995763*^9}, 
   3.480478720470288*^9}],

Cell["\<\
The derivative index of the derivative of a rank 2 is the 3rd index. The \
divergence is the trace over the last index pair...

20/05/2010   replaced    ExpandAll   by   ExpandTensor    in both  div  and \
curl.\
\>", "Text",
 CellChangeTimes->{{3.467285991718287*^9, 3.467286105899277*^9}, {
  3.467307686200064*^9, 3.467307749545063*^9}, {3.483353295509305*^9, 
  3.483353344880042*^9}}],

Cell["\<\
div\[VeryThinSpace]\[VeryThinSpace][ X ]  is the contraction on the last two \
slots of  \[Del]X .  
05/06/2016   div :  removed restriction that the last slot be vector type, \
since the  contraction can introduce an implied metric (as done everywhere \
else).
\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"div", "[", "f_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Last", "[", 
      RowBox[{"SlotType", "[", "f", "]"}], "]"}], "===", 
     RowBox[{"Tangent", "[", 
      RowBox[{"Manifold", "[", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"ExpandTensor", "[", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"grad", "[", "f", "]"}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"deg", "[", "f", "]"}], ",", 
        RowBox[{
         RowBox[{"deg", "[", "f", "]"}], "+", "1"}]}], "}"}]], "]"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"ExpandTensor", "[", 
     SubscriptBox[
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"\[Del]", "f"}], "\[RightAngleBracket]"}], 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"deg", "[", "f", "]"}], ",", 
        RowBox[{
         RowBox[{"deg", "[", "f", "]"}], "+", "1"}]}], "}"}]], "]"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True],

Cell["\<\

curl [ A ]  is the anti-symmetrization (times a factor of  - 2)  on the last \
two slots of   \[Del] A .
The last slot of  A  must be a vector-like slot (type Tangent[ M ]).
This has been defined for any degee, not just for vectors A,

Old defn,\
\>", "Text",
 CellChangeTimes->{{3.479368507603179*^9, 3.479368800862423*^9}, 
   3.479724921684229*^9, {3.48047875515792*^9, 3.480478785532731*^9}, {
   3.655673277088851*^9, 3.655673358336096*^9}, {3.655673443758793*^9, 
   3.655673577053094*^9}, {3.655673609036767*^9, 3.6556736302686977`*^9}, {
   3.674106784616416*^9, 3.674106790088278*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"curl", "[", "v_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{
         RowBox[{"Last", "[", 
          RowBox[{"SlotType", "[", "v", "]"}], "]"}], "===", 
         RowBox[{"Tangent", "[", 
          RowBox[{"Manifold", "[", "]"}], "]"}]}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<curl: The last element of the list SlotType[\>\"", ",", "v", 
          ",", "\"\<]\[MediumSpace]=\[ThickSpace]\>\"", ",", 
          RowBox[{"SlotType", "[", "v", "]"}], ",", "\"\< should be \>\"", 
          ",", " ", 
          RowBox[{"Tangent", "[", 
           RowBox[{"Manifold", "[", "]"}], "]"}], ",", "\"\<.\>\""}], " ", 
         "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", 
         RowBox[{"Metric", "[", "]"}], "]"}], "===", "Metric"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<curl: A metric is required.\>\"", "]"}], 
        ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ExpandTensor", "[", 
      RowBox[{
       RowBox[{"mvToLast", "[", 
        RowBox[{
         RowBox[{"deg", "[", "v", "]"}], ",", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{
           RowBox[{"\[Del]", "v"}], ",", 
           RowBox[{"MetricInverse", "[", "]"}]}], "\[RightAngleBracket]"}]}], 
        "]"}], "-", 
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{
         RowBox[{"\[Del]", "v"}], ",", 
         RowBox[{"MetricInverse", "[", "]"}]}], "\[RightAngleBracket]"}]}], 
      "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.614467873516073*^9, 3.6144678738027077`*^9}, 
   3.6538632120142603`*^9, {3.655673602173086*^9, 3.6556736030531597`*^9}, {
   3.655673676364121*^9, 3.6556739898163567`*^9}, {3.6556740387918577`*^9, 
   3.6556741201528997`*^9}, {3.655674154454588*^9, 3.655674167046234*^9}, {
   3.6556741971740217`*^9, 3.655674242661469*^9}, {3.655674327060273*^9, 
   3.6556743361162786`*^9}, {3.6556748486861258`*^9, 3.655674942780871*^9}, {
   3.655674982738469*^9, 3.6556750011800528`*^9}}],

Cell["\<\
05/06/2016   curl  now returns a tensor of one higher degree, with the new \
(last) slot of  curl[ X ]  being of the same type as the last slot of  X.
Thus, if  A  is a vector then  F = curl[A]  has 2 vector-type slots.  If  A \
is a covector (1-form) then  F has 2 covector slots (2-form).

07/06/2017  If last slot is vector type, then it is assumed that  grad[ ]  \
might simplify better than a raised  \[Del],  so we use that. \
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"curl", "[", "v_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Last", "[", 
      RowBox[{"SlotType", "[", "v", "]"}], "]"}], "===", 
     RowBox[{"Tangent", "[", 
      RowBox[{"Manifold", "[", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"ExpandTensor", "[", 
     RowBox[{
      RowBox[{"mvToLast", "[", 
       RowBox[{
        RowBox[{"deg", "[", "v", "]"}], ",", 
        RowBox[{"grad", "[", "v", "]"}]}], "]"}], "-", 
      RowBox[{"grad", "[", "v", "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Last", "[", 
        RowBox[{"SlotType", "[", "v", "]"}], "]"}], "===", 
       RowBox[{"Cotangent", "[", 
        RowBox[{"Manifold", "[", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"ExpandTensor", "[", 
       RowBox[{
        RowBox[{"mvToLast", "[", 
         RowBox[{
          RowBox[{"deg", "[", "v", "]"}], ",", 
          RowBox[{"\[Del]", "v"}]}], "]"}], "-", 
        RowBox[{"\[Del]", "v"}]}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
       "Print", "[", 
        "\"\<curl: The last slot of the argument has unknown type \
(vector/covector).\>\"", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"ClearMetric", "[", "]"}]], "Input",
 CellChangeTimes->{{3.6556741736259108`*^9, 3.6556741792857027`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Head", "[", 
   RowBox[{"Metric", "[", "]"}], "]"}], "===", "Metric"}]], "Input"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.655674213699856*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MetricInverse", "[", "]"}]], "Input"],

Cell[BoxData[
 TemplateBox[{"g",RowBox[{"-", "1"}]},
  "Superscript"]], "Output",
 CellChangeTimes->{3.65567496263339*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"NewMetric", "[", "g", "]"}]], "Input",
 CellChangeTimes->{{3.655674950908986*^9, 3.655674954124589*^9}}],

Cell[BoxData[
 TemplateBox[{
  "\" Metric[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"","g",
   "\",\\n MetricInverse[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"",
   "\"ginv\"","\"\[MediumSpace]=\[ThickSpace]\"",TemplateBox[{"g", 
     RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox],
   "\",\\n MetricSignature[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"",
   RowBox[{"{", 
     RowBox[{
       RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1"}], "}"}],
   "\", and dim[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"","4",
   "\".\\n\"","\"  \[Del] is metric compatible: \"",TagBox[
    RowBox[{
      RowBox[{"\[Del]", "g"}], "=", "0"}], HoldForm],"\", \"",TagBox[
    RowBox[{
      RowBox[{"\[Del]", 
        TemplateBox[{"g", 
          RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox]}],
       "=", "0"}], HoldForm],"\".\\n\"",
   "\" \[LeftAngleBracket]\[VeryThinSpace]\[RightAngleBracket] is metric \
compatible: factors \"","g","\" and \"",TemplateBox[{"g", 
     RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox],
   "\" will be assumed as necessary.\""},
  "RowDefault"]], "Output",
 CellChangeTimes->{3.6556741862567987`*^9, 3.6556749545576982`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Stress-energy tensor:   TraceFreeSquare[  ]", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
  3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
  3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
  3.467126548768611*^9, 3.467126560140989*^9}, {3.467126913123894*^9, 
  3.46712691617785*^9}, {3.467198505051484*^9, 3.467198515544077*^9}, {
  3.467198638607828*^9, 3.467198678182335*^9}, {3.46728810114199*^9, 
  3.467288103412177*^9}, {3.46729713395404*^9, 3.467297152845731*^9}, {
  3.6556817472227182`*^9, 3.655681755478348*^9}}],

Cell["\<\
Using  ExpandTensor  here can be too slow.   StrutedTensor  is sufficient to \
simplify a bit,  
but leave most of the result unexpanded, which is better for later series \
expansions... \
\>", "Text",
 CellChangeTimes->{{3.481958386134141*^9, 3.481958616802449*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TraceFreeSquare", "[", "f_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "ff", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MatchQ", "[", 
       RowBox[{
        RowBox[{"SlotType", "[", "f", "]"}], ",", 
        RowBox[{"SlotData", "[", 
         RowBox[{
          RowBox[{"Tangent", "[", "_", "]"}], ",", 
          RowBox[{"Tangent", "[", "_", "]"}]}], "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ff", "=", 
        RowBox[{"StrutedTensor", "[", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"f", ",", 
           RowBox[{"rev", "[", "f", "]"}]}], "\[RightAngleBracket]"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ff", "-", 
        RowBox[{
         RowBox[{"1", "/", "4"}], " ", 
         RowBox[{"MetricInverse", "[", "]"}], " ", 
         SubscriptBox[
          RowBox[{"\[LeftAngleBracket]", "ff", "\[RightAngleBracket]"}], 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]]}]}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"MatchQ", "[", 
         RowBox[{
          RowBox[{"SlotType", "[", "f", "]"}], ",", 
          RowBox[{"SlotData", "[", 
           RowBox[{
            RowBox[{"Cotangent", "[", "_", "]"}], ",", 
            RowBox[{"Cotangent", "[", "_", "]"}]}], "]"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ff", "=", 
          RowBox[{"StrutedTensor", "[", 
           RowBox[{"\[LeftAngleBracket]", 
            RowBox[{"f", ",", 
             RowBox[{"rev", "[", "f", "]"}]}], "\[RightAngleBracket]"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ff", "-", 
          RowBox[{
           RowBox[{"1", "/", "4"}], " ", 
           RowBox[{"Metric", "[", "]"}], " ", 
           SubscriptBox[
            RowBox[{"\[LeftAngleBracket]", "ff", "\[RightAngleBracket]"}], 
            RowBox[{"{", 
             RowBox[{"1", ",", "2"}], "}"}]]}]}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<TraceFreeSquare: Argument should be a section of \>\"", ",", 
           SuperscriptBox[
            RowBox[{"Tangent", "[", 
             RowBox[{"Manifold", "[", "]"}], "]"}], 
            "\"\<\[CircleTimes]2\>\""], ",", "\"\< or \>\"", ",", 
           SuperscriptBox[
            RowBox[{"Cotangent", "[", 
             RowBox[{"Manifold", "[", "]"}], "]"}], 
            "\"\<\[CircleTimes]2\>\""], ",", "\"\<.\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "]"}]}], "]"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.480477289563107*^9, 3.480477319493188*^9}, {
  3.480477371369905*^9, 3.480477392580473*^9}, {3.4804774388587*^9, 
  3.480477450488391*^9}, {3.481537297545169*^9, 3.481537306134339*^9}, {
  3.481537341071693*^9, 3.481537399906199*^9}, {3.481537434554888*^9, 
  3.48153744396172*^9}, {3.481818174866413*^9, 3.481818178416885*^9}, {
  3.481818856565524*^9, 3.481818858209404*^9}, {3.481819619330794*^9, 
  3.481819630368121*^9}, {3.615741687204987*^9, 3.6157416894761887`*^9}, {
  3.655678251684496*^9, 3.655678260276206*^9}, {3.656125183730446*^9, 
  3.65612540100895*^9}, {3.656125455584855*^9, 3.656125494432375*^9}, {
  3.6561255332479467`*^9, 3.656125553455839*^9}, {3.674350685188653*^9, 
  3.674350767331665*^9}, {3.6743507984189787`*^9, 3.67435085217837*^9}, {
  3.674351025056299*^9, 3.674351028560285*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"TraceFreeSquare", "[", "x", "]"}]], "Input",
 CellChangeTimes->{{3.656125409408607*^9, 3.656125410944509*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"TraceFreeSquare: Argument should be a section of \"\>", 
   "\[InvisibleSpace]", 
   SuperscriptBox[
    RowBox[{"\<\"T\"\>", "[", "\<\"M\"\>", "]"}], "\<\"\[CircleTimes]2\"\>"], 
   "\[InvisibleSpace]", "\<\".\"\>"}],
  SequenceForm[
  "TraceFreeSquare: Argument should be a section of ", $CellContext`Tangent[
    "M"]^"\[CircleTimes]2", "."],
  Editable->False]], "Print",
 CellChangeTimes->{3.656125411419512*^9, 3.656125558504076*^9}],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{3.6561254114202633`*^9, 3.656125558504838*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearField", "[", "F", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2", ",", "0"}], "}"}], ",", "F"}], "]"}]}], "Input",
 CellChangeTimes->{{3.655678299778776*^9, 3.655678321443371*^9}}],

Cell[BoxData[
 TemplateBox[{"F","\" is a section of the tensor bundle \"",SuperscriptBox[
    RowBox[{"\"T\"", "[", "\"M\"", "]"}], 
    "\"\[VeryThinSpace]\[CircleTimes]2\""],"\" over \"","\"M\"","\".\""},
  "RowDefault"]], "Output",
 CellChangeTimes->{3.655678323523525*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"T", "=", 
  RowBox[{"TraceFreeSquare", "[", "F", "]"}]}]], "Input",
 CellChangeTimes->{{3.655678337651004*^9, 3.655678344131055*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"F", ",", 
    RowBox[{"rev", "[", "F", "]"}]}], "\[RightAngleBracket]"}], "-", 
  RowBox[{
   FractionBox["1", "4"], " ", 
   TemplateBox[{"g",RowBox[{"-", "1"}]},
    "Superscript"], " ", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"rev", "[", "F", "]"}], ",", "F"}], "\[RightAngleBracket]"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "2"}], "}"}]]}]}]], "Output",
 CellChangeTimes->{3.655678344914208*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", "T", "\[RightAngleBracket]"}], 
  RowBox[{"{", 
   RowBox[{"1", ",", "2"}], "}"}]]], "Input",
 CellChangeTimes->{{3.655678350729319*^9, 3.6556783614747877`*^9}}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.655678362864605*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"L", "=", 
  RowBox[{"-", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"F", ",", 
       RowBox[{"rev", "[", "F", "]"}]}], "\[RightAngleBracket]"}], 
     "\[RightAngleBracket]"}], 
    RowBox[{"1", ",", "2"}]]}]}]], "Input",
 CellChangeTimes->{{3.480477486591675*^9, 3.48047750404276*^9}}],

Cell[BoxData[
 RowBox[{"-", 
  SubscriptBox[
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"F", ",", 
      RowBox[{"rev", "[", "F", "]"}]}], "\[RightAngleBracket]"}], 
    "\[RightAngleBracket]"}], 
   RowBox[{"1", ",", "2"}]]}]], "Output",
 CellChangeTimes->{3.518081135780406*^9, 3.613716847455781*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Kronecker deltas:  \[Delta]\[VeryThinSpace]\[VeryThinSpace]\[VeryThinSpace][ \
n, r ]    ---  incomplete \
\>", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
   3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
   3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
   3.48042476399629*^9, 3.480424778951466*^9}, {3.480477169549407*^9, 
   3.480477199429993*^9}, 3.480477245698426*^9, {3.653716892089407*^9, 
   3.6537168992891293`*^9}, {3.653817000525063*^9, 3.653817034508738*^9}, {
   3.655423256788526*^9, 3.655423268004562*^9}, {3.655579609611065*^9, 
   3.65557966026579*^9}, {3.6555877043833113`*^9, 3.655587709903285*^9}, {
   3.6561214720252943`*^9, 3.656121487529052*^9}, 3.656121800710359*^9}],

Cell["Refs:   MTW  p87,  p128", "Text",
 CellChangeTimes->{{3.6538522779063168`*^9, 3.6538522874583893`*^9}, {
  3.653852338049572*^9, 3.6538523429935503`*^9}}],

Cell[TextData[{
 "\[Delta] [ n , r ]   is the generalized \[Delta]  of type  { r, r }  in  \
n-dimensions.\n\[DoubleStruckCapitalR]  is    \
\\[\[VeryThinSpace]DoubleStruckCapitalR\[VeryThinSpace]]     and is input as  \
  [Esc] dsR [Esc] .\nFor the purpose matching up slots in contractions,   \
Tangent[ ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[DoubleStruckCapitalR]", "n"], TraditionalForm]]],
 " ]  and  Cotangent[ ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["\[DoubleStruckCapitalR]", "n"], TraditionalForm]]],
 " ]   are taken to match the corresponding bundles of any  n-dimensional \
manifold."
}], "Text",
 CellChangeTimes->{{3.6538174708070087`*^9, 3.6538176170451527`*^9}, {
  3.65385204718969*^9, 3.653852047445438*^9}, {3.654031953588232*^9, 
  3.6540320445627213`*^9}, {3.654033294386902*^9, 3.654033646382317*^9}, {
  3.654033768382506*^9, 3.6540338805076838`*^9}, {3.655422004211812*^9, 
  3.65542203640303*^9}, {3.6555796407461643`*^9, 3.655579643258074*^9}}],

Cell[BoxData[
 RowBox[{"Quiet", "[", 
  RowBox[{"ClearField", "[", "\[Delta]", "]"}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6539925097554693`*^9, 3.653992545494302*^9}, {
   3.654001692288924*^9, 3.654001694308632*^9}, 3.654001735318345*^9, {
   3.654001768050762*^9, 3.654001769985836*^9}, {3.6540317302322893`*^9, 
   3.654031733303863*^9}, 3.655422087730504*^9, {3.655589914147135*^9, 
   3.655589918498658*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Delta]", "[", 
   RowBox[{"_", ",", "0"}], "]"}], ":=", "1"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Delta]", "[", 
   RowBox[{"n_", ",", "1"}], "]"}], ":=", 
  RowBox[{"\[Delta]", "[", "n", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6555799889815493`*^9, 3.6555799948535433`*^9}, {
   3.655580064324815*^9, 3.655580064404468*^9}, 3.655588539060586*^9, {
   3.655588666690971*^9, 3.655588667481532*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FieldType", "[", "\[InvisibleSpace]", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"n_", ",", "r_"}], "]"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    SuperscriptBox["\[DoubleStruckCapitalR]", "n"], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Tangent", "[", 
         SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}], ",", "r"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cotangent", "[", 
         SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}], ",", "r"}], 
       "}"}]}], "}"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FieldType", "[", "\[InvisibleSpace]", 
   RowBox[{"\[Delta]", "[", "n_", "]"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{
    SuperscriptBox["\[DoubleStruckCapitalR]", "n"], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Tangent", "[", 
         SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}], ",", "1"}], 
       "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Cotangent", "[", 
         SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}], ",", "1"}], 
       "}"}]}], "}"}]}], "}"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6539862153589497`*^9, 3.6539862277269983`*^9}, {
  3.65398628334173*^9, 3.6539863139172*^9}, {3.653986352902069*^9, 
  3.653986398348208*^9}, {3.653986602328569*^9, 3.653986655319085*^9}, {
  3.653986724165648*^9, 3.653986738405258*^9}, {3.65400209257898*^9, 
  3.654002123389798*^9}, {3.654031496795548*^9, 3.654031594093444*^9}, {
  3.654031740696156*^9, 3.654031790264542*^9}, {3.654031853847066*^9, 
  3.654031899560762*^9}, {3.65542236075148*^9, 3.655422365101632*^9}, {
  3.655424039004305*^9, 3.6554240437397537`*^9}, {3.6555886307714977`*^9, 
  3.655588631673126*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SlotType", "[", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"n_", ",", "r_"}], "]"}], "]"}], ":=", 
  RowBox[{"Apply", "[", 
   RowBox[{"SlotData", ",", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Tangent", "[", 
         SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}], ",", 
        RowBox[{"{", "r", "}"}]}], "]"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Cotangent", "[", 
         SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}], ",", 
        RowBox[{"{", "r", "}"}]}], "]"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SlotType", "[", 
   RowBox[{"\[Delta]", "[", "n_", "]"}], "]"}], ":=", 
  RowBox[{"SlotData", "[", 
   RowBox[{
    RowBox[{"Tangent", "[", 
     SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}], ",", 
    RowBox[{"Cotangent", "[", 
     SuperscriptBox["\[DoubleStruckCapitalR]", "n"], "]"}]}], 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655590014478063*^9, 3.655590085904683*^9}, {
  3.655590119927965*^9, 3.6555901352320623`*^9}, {3.655590177647596*^9, 
  3.655590200111134*^9}, {3.656121690103516*^9, 3.656121722903017*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SlotType", "[", 
  RowBox[{"\[Delta]", "[", 
   RowBox[{"4", ",", "2"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.655590145263797*^9, 3.6555901629115133`*^9}}],

Cell[BoxData[
 RowBox[{"SlotData", "[", 
  RowBox[{
   RowBox[{"\<\"T\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "4"], "]"}], ",", 
   RowBox[{"\<\"T\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "4"], "]"}], ",", 
   RowBox[{"\<\"\\!\\(\\*SuperscriptBox[\\(T\\), \
\\(\\(\[VeryThinSpace]\\)\\(*\\)\\)]\\)\[NegativeThinSpace]\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "4"], "]"}], ",", 
   RowBox[{"\<\"\\!\\(\\*SuperscriptBox[\\(T\\), \
\\(\\(\[VeryThinSpace]\\)\\(*\\)\\)]\\)\[NegativeThinSpace]\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "4"], "]"}]}], "]"}]], "Output",\

 CellChangeTimes->{{3.655590152065033*^9, 3.655590163499756*^9}, 
   3.656121734455831*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"deg", "[", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"_", ",", "r_"}], "]"}], "]"}], ":=", 
  RowBox[{"2", "r"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"deg", "[", 
   RowBox[{"\[Delta]", "[", "_", "]"}], "]"}], ":=", "2"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6554223725031347`*^9, 3.65542239011104*^9}, {
   3.655424048875716*^9, 3.6554240512595263`*^9}, 3.655588516580946*^9, {
   3.655588639427252*^9, 3.655588651158526*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FieldQ", "[", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"_", ",", "_"}], "]"}], "]"}], ":=", 
  "True"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FieldQ", "[", 
   RowBox[{"\[Delta]", "[", "_", "]"}], "]"}], ":=", "True"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655422402955633*^9, 3.655422419134595*^9}, {
  3.65542405693952*^9, 3.655424058667568*^9}, {3.6555885103408127`*^9, 
  3.655588511516953*^9}, {3.6555886225154667`*^9, 3.6555886233206453`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Del]", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"_", ",", "_"}], "]"}]}], ":=", "0"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Del]", 
   RowBox[{"\[Delta]", "[", "_", "]"}]}], ":=", "0"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655422430891876*^9, 3.6554224409583473`*^9}, {
  3.655424061915609*^9, 3.655424063963545*^9}, {3.655588529028686*^9, 
  3.655588530468527*^9}, {3.6555886144995213`*^9, 3.655588615288948*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[GothicCapitalD]", "[", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"_", ",", "_"}], "]"}], "]"}], ":=", "0"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[GothicCapitalD]", "[", 
   RowBox[{"\[Delta]", "[", "_", "]"}], "]"}], ":=", "0"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655608638777383*^9, 3.6556086629310913`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"pD", "[", 
   RowBox[{
    RowBox[{"\[Delta]", "[", 
     RowBox[{"_", ",", "_"}], "]"}], ",", "__"}], "]"}], ":=", 
  "0"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pD", "[", 
   RowBox[{
    RowBox[{"\[Delta]", "[", "_", "]"}], ",", "__"}], "]"}], ":=", 
  "0"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655608714754753*^9, 3.6556087415785513`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"\[Delta]", "[", 
       RowBox[{"n_", ",", "r_"}], "]"}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
    RowBox[{
     RowBox[{"a", "\[LessEqual]", "r"}], "&&", 
     RowBox[{"b", ">", "r"}]}]}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], 
     RowBox[{"a", "+", 
      RowBox[{"(", 
       RowBox[{"b", "-", "r"}], ")"}]}]], 
    RowBox[{"(", 
     RowBox[{"n", "-", "r", "+", "1"}], ")"}], 
    RowBox[{"\[Delta]", "[", 
     RowBox[{"n", ",", 
      RowBox[{"r", "-", "1"}]}], "]"}]}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.654029664882441*^9, 3.654029699265942*^9}, {
  3.65403002238162*^9, 3.654030022461548*^9}, {3.654030072239246*^9, 
  3.654030110028574*^9}, {3.654030171563789*^9, 3.6540301810039787`*^9}, {
  3.654030214587488*^9, 3.654030271610902*^9}, {3.65403031023423*^9, 
  3.654030310506143*^9}, {3.654030367389538*^9, 3.6540304277212973`*^9}, {
  3.65403215280309*^9, 3.654032195938723*^9}, {3.655424066795965*^9, 
  3.655424068491583*^9}, {3.655579920695118*^9, 3.6555799267105703`*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "208", "]"}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"AddRule", "[", 
  RowBox[{
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"\[Delta]", "[", 
       RowBox[{"n_", ",", "r_"}], "]"}], "\[RightAngleBracket]"}], 
     RowBox[{"ab__List", ",", 
      RowBox[{"{", 
       RowBox[{"a_", ",", "b_"}], "}"}]}]], "/;", 
    RowBox[{
     RowBox[{"a", "\[LessEqual]", "r"}], "&&", 
     RowBox[{"b", ">", "r"}]}]}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"-", "1"}], ")"}], 
     RowBox[{"a", "+", 
      RowBox[{"(", 
       RowBox[{"b", "-", "r"}], ")"}]}]], 
    RowBox[{"(", 
     RowBox[{"n", "-", "r", "+", "1"}], ")"}], 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"\[Delta]", "[", 
       RowBox[{"n", ",", 
        RowBox[{"r", "-", "1"}]}], "]"}], "\[RightAngleBracket]"}], 
     RowBox[{"abDrop", "[", 
      RowBox[{
       RowBox[{"{", "ab", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"a", ",", "b"}], "}"}]}], "]"}]]}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655579733129147*^9, 3.6555798090320053`*^9}, {
  3.6555799312707567`*^9, 3.655579935910458*^9}}],

Cell[BoxData[
 RowBox[{"rule", "[", "209", "]"}]], "Output"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Delta]", "[", "_", "]"}], ",", "X_"}], 
    "\[RightAngleBracket]"}], "/;", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"First", "[", 
      RowBox[{"SlotType", "[", "X", "]"}], "]"}], ",", 
     RowBox[{"Tangent", "[", "_", "]"}]}], "]"}]}], ":=", 
  "X"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Delta]", "[", "_", "]"}], ",", "X_", ",", "Y__"}], 
    "\[RightAngleBracket]"}], "/;", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"First", "[", 
      RowBox[{"SlotType", "[", "X", "]"}], "]"}], ",", 
     RowBox[{"Tangent", "[", "_", "]"}]}], "]"}]}], ":=", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", ",", "Y"}], "\[RightAngleBracket]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      RowBox[{"\[Delta]", "[", "_", "]"}], ",", "X_", ",", "Y___"}], 
     "\[RightAngleBracket]"}], "/;", 
    RowBox[{"MatchQ", "[", 
     RowBox[{
      RowBox[{"First", "[", 
       RowBox[{"SlotType", "[", "X", "]"}], "]"}], ",", 
      RowBox[{"Cotangent", "[", "_", "]"}]}], "]"}]}], ":=", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"MetricInverse", "[", 
      RowBox[{"Manifold", "[", "X", "]"}], "]"}], ",", "X", ",", "Y"}], 
    "\[RightAngleBracket]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"X_", ",", 
     RowBox[{"\[Delta]", "[", "_", "]"}]}], "\[RightAngleBracket]"}], "/;", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"Last", "[", 
      RowBox[{"SlotType", "[", "X", "]"}], "]"}], ",", 
     RowBox[{"Cotangent", "[", "_", "]"}]}], "]"}]}], ":=", 
  "X"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"Y__", ",", "X_", ",", 
     RowBox[{"\[Delta]", "[", "_", "]"}]}], "\[RightAngleBracket]"}], "/;", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"Last", "[", 
      RowBox[{"SlotType", "[", "X", "]"}], "]"}], ",", 
     RowBox[{"Cotangent", "[", "_", "]"}]}], "]"}]}], ":=", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"Y", ",", "X"}], "\[RightAngleBracket]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"Y___", ",", "X_", ",", 
      RowBox[{"\[Delta]", "[", "_", "]"}]}], "\[RightAngleBracket]"}], "/;", 
    RowBox[{"MatchQ", "[", 
     RowBox[{
      RowBox[{"Last", "[", 
       RowBox[{"SlotType", "[", "X", "]"}], "]"}], ",", 
      RowBox[{"Tangent", "[", "_", "]"}]}], "]"}]}], ":=", 
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"Y", ",", "X", ",", 
     RowBox[{"Metric", "[", 
      RowBox[{"Manifold", "[", "X", "]"}], "]"}]}], 
    "\[RightAngleBracket]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  SubscriptBox[
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{"\[Delta]", "[", "n_", "]"}], "\[RightAngleBracket]"}], 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}]], ":=", "n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X1__", "\[CircleTimes]", 
       RowBox[{"\[Delta]", "[", "n_", "]"}], "\[CircleTimes]", "X2__"}], 
      "\[RightAngleBracket]"}], 
     RowBox[{"ab1___List", ",", "ab_List", ",", "ab2___List"}]], "/;", 
    RowBox[{"ab", "===", 
     RowBox[{
      RowBox[{"deg", "[", "X1", "]"}], "+", 
      RowBox[{"{", 
       RowBox[{"1", ",", "2"}], "}"}]}]}]}], ":=", 
   RowBox[{"n", 
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{"X1", "\[CircleTimes]", "X2"}], "\[RightAngleBracket]"}], 
     RowBox[{"abDrop", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ab1", ",", "ab2"}], "}"}], ",", "ab"}], "]"}]]}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655587806862193*^9, 3.6555878696278687`*^9}, {
   3.6555879121085997`*^9, 3.65558800494633*^9}, {3.6555880937226143`*^9, 
   3.655588100858267*^9}, {3.655588152393703*^9, 3.655588165023501*^9}, {
   3.655588397718609*^9, 3.655588424286496*^9}, {3.655588715666307*^9, 
   3.655588748258*^9}, {3.65558939867092*^9, 3.655589507016164*^9}, {
   3.655589549143732*^9, 3.655589569959351*^9}, {3.655596374113686*^9, 
   3.6555964013291807`*^9}, {3.655596432905171*^9, 3.6555964835842037`*^9}, {
   3.6556075466896267`*^9, 3.655607561281272*^9}, {3.655607640512082*^9, 
   3.655607650960005*^9}, {3.655607993867873*^9, 3.6556080288104753`*^9}, {
   3.6556081754175053`*^9, 3.655608218504897*^9}, {3.655608270663207*^9, 
   3.655608319095764*^9}, {3.655608355922575*^9, 3.655608390054825*^9}, {
   3.65560844714221*^9, 3.655608512229281*^9}, {3.655608542660954*^9, 
   3.655608553652852*^9}, {3.655608593220418*^9, 3.655608604212104*^9}, 
   3.655608787793687*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"\[Delta]", "[", 
     RowBox[{"n_", ",", "r_"}], "]"}], ",", "StandardForm"}], "]"}], ":=", 
  SubscriptBox["\[Delta]", 
   RowBox[{"Row", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\<(\>\"", ",", "n", ",", "\"\<,\>\"", ",", "r", ",", "\"\<)\>\""}], 
     "}"}], "]"}]]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655423975813805*^9, 3.65542397948498*^9}, {
  3.65542407629735*^9, 3.655424173418318*^9}, {3.655424237945619*^9, 
  3.655424241401474*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"\[Delta]", "[", "n_", "]"}], ",", "StandardForm"}], "]"}], ":=", 
  
  SubscriptBox["\[Delta]", 
   RowBox[{"Row", "[", 
    RowBox[{"{", 
     RowBox[{"\"\<(\>\"", ",", "n", ",", "\"\<)\>\""}], "}"}], 
    "]"}]]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655424260313489*^9, 3.655424274473296*^9}, 
   3.655588327527384*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"4", ",", "4"}], "]"}], "\[RightAngleBracket]"}], 
  RowBox[{"{", 
   RowBox[{"4", ",", "8"}], "}"}]], "\[IndentingNewLine]", 
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"\[Delta]", "[", 
    RowBox[{"4", ",", "4"}], "]"}], "\[RightAngleBracket]"}], 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"3", ",", "7"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"4", ",", "8"}], "}"}]}]]}], "Input",
 CellChangeTimes->{{3.655422932792637*^9, 3.655422948312303*^9}, {
  3.655423002992112*^9, 3.655423025959517*^9}}],

Cell[BoxData[
 SubscriptBox["\[Delta]", 
  TemplateBox[{"\"(\"","4","\",\"","3","\")\""},
   "RowDefault"]]], "Output",
 CellChangeTimes->{
  3.655580187047192*^9, {3.655608862738661*^9, 3.6556088680460873`*^9}}],

Cell[BoxData[
 RowBox[{"2", " ", 
  SubscriptBox["\[Delta]", 
   TemplateBox[{"\"(\"","4","\",\"","2","\")\""},
    "RowDefault"]]}]], "Output",
 CellChangeTimes->{
  3.655580187047192*^9, {3.655608862738661*^9, 3.655608868046988*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Expand\[Delta]1", "[", "X_", "]"}], ":=", " ", 
  RowBox[{"X", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Delta]", "[", 
      RowBox[{"n_", ",", "r_"}], "]"}], "\[RuleDelayed]", 
     RowBox[{
      RowBox[{"r", "!"}], 
      RowBox[{
       RowBox[{"alt", "[", 
        RowBox[{"Range", "[", "r", "]"}], "]"}], "[", 
       RowBox[{
        RowBox[{"mv", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"2", "j"}], "-", "1"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "r"}], "}"}]}], "]"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"2", "j"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "r"}], "}"}]}], "]"}]}], "]"}], 
         "]"}], "[", 
        RowBox[{"TensorPower", "[", 
         RowBox[{
          RowBox[{"\[Delta]", "[", 
           RowBox[{"n", ",", "1"}], "]"}], ",", "r"}], "]"}], "]"}], 
       "]"}]}]}], "}"}]}]}]], "Input",
 CellChangeTimes->{{3.65558022474445*^9, 3.655580479951275*^9}, {
   3.655580522142733*^9, 3.655580561822118*^9}, {3.655581321348303*^9, 
   3.655581345987852*^9}, {3.655581564049152*^9, 3.655581605680593*^9}, 
   3.655629176059524*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Expand\[Delta]", "[", "X_", "]"}], ":=", " ", 
  RowBox[{"X", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Delta]", "[", 
      RowBox[{"n_", ",", "r_"}], "]"}], "\[RuleDelayed]", 
     RowBox[{
      RowBox[{"r", "!"}], 
      RowBox[{
       RowBox[{"alt", "[", 
        RowBox[{"r", "+", 
         RowBox[{"Range", "[", "r", "]"}]}], "]"}], "[", 
       RowBox[{
        RowBox[{"mv", "[", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"2", "j"}], "-", "1"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "r"}], "}"}]}], "]"}], ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"2", "j"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "r"}], "}"}]}], "]"}]}], "]"}], 
         "]"}], "[", 
        RowBox[{"TensorPower", "[", 
         RowBox[{
          RowBox[{"\[Delta]", "[", 
           RowBox[{"n", ",", "1"}], "]"}], ",", "r"}], "]"}], "]"}], 
       "]"}]}]}], "}"}]}]}]], "Input",
 CellChangeTimes->{{3.65558022474445*^9, 3.655580479951275*^9}, {
  3.655580522142733*^9, 3.655580561822118*^9}, {3.655581321348303*^9, 
  3.655581345987852*^9}, {3.655581564049152*^9, 3.655581605680593*^9}, {
  3.655591101796053*^9, 3.655591102467905*^9}, {3.655591191267013*^9, 
  3.655591192514861*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Delta]", "[", 
   RowBox[{"4", ",", "2"}], "]"}], "//", "Expand\[Delta]"}]], "Input",
 CellChangeTimes->{{3.655580498926955*^9, 3.655580505246881*^9}, {
  3.655591200178823*^9, 3.655591200690567*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2", ",", "4"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "4", ",", "2"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}]}]], "Output",
 CellChangeTimes->{
  3.655591110807768*^9, {3.655591197312999*^9, 3.655591201672711*^9}, 
   3.655608908010997*^9, 3.6556292179925213`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"\[Delta]", "[", 
     RowBox[{"4", ",", "4"}], "]"}], "//", "Expand\[Delta]"}], ")"}], "-", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"\[Delta]", "[", 
     RowBox[{"4", ",", "4"}], "]"}], "//", "Expand\[Delta]1"}], 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.655629190778708*^9, 3.655629203242612*^9}}],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.655629207221078*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"\[Delta]", "[", 
   RowBox[{"4", ",", "4"}], "]"}], "//", "Expand\[Delta]"}]], "Input",
 CellChangeTimes->{{3.655580498926955*^9, 3.655580505246881*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "2", ",", "4", ",", "6", ",", 
     "8"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "2", ",", "4", ",", "8", ",", 
     "6"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "2", ",", "6", ",", "4", ",", 
     "8"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "2", ",", "6", ",", "8", ",", 
     "4"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "2", ",", "8", ",", "4", ",", 
     "6"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "2", ",", "8", ",", "6", ",", 
     "4"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "4", ",", "2", ",", "6", ",", 
     "8"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "4", ",", "2", ",", "8", ",", 
     "6"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "4", ",", "6", ",", "2", ",", 
     "8"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "4", ",", "6", ",", "8", ",", 
     "2"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "4", ",", "8", ",", "2", ",", 
     "6"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "4", ",", "8", ",", "6", ",", 
     "2"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "6", ",", "2", ",", "4", ",", 
     "8"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "6", ",", "2", ",", "8", ",", 
     "4"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "6", ",", "4", ",", "2", ",", 
     "8"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "6", ",", "4", ",", "8", ",", 
     "2"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "6", ",", "8", ",", "2", ",", 
     "4"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "6", ",", "8", ",", "4", ",", 
     "2"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "8", ",", "2", ",", "4", ",", 
     "6"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "8", ",", "2", ",", "6", ",", 
     "4"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "8", ",", "4", ",", "2", ",", 
     "6"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "8", ",", "4", ",", "6", ",", 
     "2"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "8", ",", "6", ",", "2", ",", 
     "4"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{
    "1", ",", "3", ",", "5", ",", "7", ",", "8", ",", "6", ",", "4", ",", 
     "2"}], "]"}], "[", 
   RowBox[{
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}]}]], "Output",
 CellChangeTimes->{3.655580505996719*^9, 3.655580606342684*^9, 
  3.655580745748583*^9, 3.6555816098548813`*^9, 3.655591071380743*^9, 
  3.65560891479939*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[Delta]", "[", 
     RowBox[{"4", ",", "4"}], "]"}], "//", "Expand\[Delta]"}], 
   "\[RightAngleBracket]"}], 
  RowBox[{"{", 
   RowBox[{"1", ",", "5"}], "}"}]]], "Input",
 CellChangeTimes->{{3.655580821306679*^9, 3.65558084242622*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "2", ",", "4", ",", "6"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "2", ",", "6", ",", "4"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "4", ",", "2", ",", "6"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "4", ",", "6", ",", "2"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "6", ",", "2", ",", "4"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "6", ",", "4", ",", "2"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "1", ",", "4", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "1", ",", "6", ",", "4"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "4", ",", "1", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "4", ",", "6", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "6", ",", "1", ",", "4"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "6", ",", "4", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "1", ",", "3", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "1", ",", "6", ",", "3"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "3", ",", "1", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "3", ",", "6", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "6", ",", "1", ",", "3"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "6", ",", "3", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "1", ",", "3", ",", "5"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "1", ",", "5", ",", "3"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "3", ",", "1", ",", "5"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "3", ",", "5", ",", "1"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "5", ",", "1", ",", "3"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "5", ",", "3", ",", "1"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}]}]], "Output",
 CellChangeTimes->{3.65558084522952*^9, 3.655608927033682*^9, 
  3.655629224356904*^9}]
}, Open  ]],

Cell["..... this should not have rev in it ?", "Text",
 CellChangeTimes->{{3.6555809922802677`*^9, 3.65558102834371*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"rev", "[", 
     RowBox[{"\[Delta]", "[", "4", "]"}], "]"}], ",", 
    RowBox[{"rev", "[", 
     RowBox[{"\[Delta]", "[", "4", "]"}], "]"}]}], "\[RightAngleBracket]"}], ":=", 
  RowBox[{"rev", "[", 
   RowBox[{"\[Delta]", "[", "4", "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655609130829321*^9, 3.655609161852734*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[Delta]", "[", 
     RowBox[{"4", ",", "4"}], "]"}], "//", "Expand\[Delta]"}], 
   "\[RightAngleBracket]"}], 
  RowBox[{"{", 
   RowBox[{"1", ",", "5"}], "}"}]]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "2", ",", "4", ",", "6"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "2", ",", "6", ",", "4"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "4", ",", "2", ",", "6"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "4", ",", "6", ",", "2"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "+", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "6", ",", "2", ",", "4"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"4", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "6", ",", "4", ",", "2"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "1", ",", "4", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "1", ",", "6", ",", "4"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "4", ",", "1", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "4", ",", "6", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "6", ",", "1", ",", "4"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "3", ",", "5", ",", "6", ",", "4", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    RowBox[{"rev", "[", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "]"}], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "1", ",", "3", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "1", ",", "6", ",", "3"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "3", ",", "1", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "3", ",", "6", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "6", ",", "1", ",", "3"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "6", ",", "3", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "1", ",", "3", ",", "5"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "1", ",", "5", ",", "3"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "3", ",", "1", ",", "5"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "3", ",", "5", ",", "1"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "5", ",", "1", ",", "3"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "5", ",", "3", ",", "1"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}]}]], "Output",
 CellChangeTimes->{3.655609181425767*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1", ",", "3", ",", "4", ",", "5", ",", "6"}], "]"}], 
  "[", 
  RowBox[{
   RowBox[{"\[Delta]", "[", "4", "]"}], "\[CircleTimes]", 
   RowBox[{"\[Delta]", "[", "4", "]"}], "\[CircleTimes]", 
   RowBox[{"\[Delta]", "[", "4", "]"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.655609239053171*^9, 3.6556092720431547`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "1"}], "]"}], "[", 
   SubscriptBox["\[Delta]", 
    TemplateBox[{"\"(\"","4","\")\""},
     "RowDefault"]], "]"}], "\[CircleTimes]", 
  SubscriptBox["\[Delta]", 
   TemplateBox[{"\"(\"","4","\")\""},
    "RowDefault"]], "\[CircleTimes]", 
  SubscriptBox["\[Delta]", 
   TemplateBox[{"\"(\"","4","\")\""},
    "RowDefault"]]}]], "Output",
 CellChangeTimes->{3.6556092738308783`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1"}], "]"}], "[", 
  RowBox[{"\[Delta]", "[", "4", "]"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1"}], "]"}], "[", 
  SubscriptBox["\[Delta]", 
   TemplateBox[{"\"(\"","4","\")\""},
    "RowDefault"]], "]"}]], "Output",
 CellChangeTimes->{3.65560941359831*^9, 3.655629268742606*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  SubscriptBox[
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[Delta]", "[", 
      RowBox[{"4", ",", "4"}], "]"}], "//", "Expand\[Delta]"}], 
    "\[RightAngleBracket]"}], 
   RowBox[{"{", 
    RowBox[{"1", ",", "5"}], "}"}]], "/.", 
  RowBox[{
   RowBox[{"rev", "[", 
    RowBox[{"\[Delta]", "[", "4", "]"}], "]"}], "\[Rule]", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"2", ",", "1"}], "]"}], "[", 
    RowBox[{"\[Delta]", "[", "4", "]"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.6556092995308943`*^9, 3.6556093228266068`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"3", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "2", ",", "4", ",", "6"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"3", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "2", ",", "6", ",", "4"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"3", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "4", ",", "2", ",", "6"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "+", 
  RowBox[{"3", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "4", ",", "6", ",", "2"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "+", 
  RowBox[{"3", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "6", ",", "2", ",", "4"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "-", 
  RowBox[{"3", " ", 
   RowBox[{
    RowBox[{"mv", "[", 
     RowBox[{"1", ",", "3", ",", "5", ",", "6", ",", "4", ",", "2"}], "]"}], 
    "[", 
    RowBox[{
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]], "\[CircleTimes]", 
     SubscriptBox["\[Delta]", 
      TemplateBox[{"\"(\"","4","\")\""},
       "RowDefault"]]}], "]"}]}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "1", ",", "3", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "1", ",", "6", ",", "3"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "3", ",", "1", ",", "6"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "3", ",", "6", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "6", ",", "1", ",", "3"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "5", ",", "6", ",", "3", ",", "1"}], "]"}], 
   "[", 
   RowBox[{
    SubscriptBox[
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]], "\[CircleTimes]", 
       SubscriptBox["\[Delta]", 
        TemplateBox[{"\"(\"","4","\")\""},
         "RowDefault"]]}], "\[RightAngleBracket]"}], 
     RowBox[{"{", 
      RowBox[{"1", ",", "6"}], "}"}]], "\[CircleTimes]", 
    SubscriptBox["\[Delta]", 
     TemplateBox[{"\"(\"","4","\")\""},
      "RowDefault"]]}], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "1", ",", "3", ",", "5"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "1", ",", "5", ",", "3"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "3", ",", "1", ",", "5"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "3", ",", "5", ",", "1"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "-", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "5", ",", "1", ",", "3"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}], "+", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"2", ",", "4", ",", "6", ",", "5", ",", "3", ",", "1"}], "]"}], 
   "[", 
   SubscriptBox[
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]], "\[CircleTimes]", 
      SubscriptBox["\[Delta]", 
       TemplateBox[{"\"(\"","4","\")\""},
        "RowDefault"]]}], "\[RightAngleBracket]"}], 
    RowBox[{"{", 
     RowBox[{"1", ",", "8"}], "}"}]], "]"}]}]], "Output",
 CellChangeTimes->{3.6556093250962477`*^9, 3.655629291400681*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Symbolic metric:   NewMetric[ ],  Metric[ ] ", "Subsection",
 CellChangeTimes->{{3.467119314622471*^9, 3.467119372544761*^9}, {
   3.467120202756169*^9, 3.467120227661777*^9}, {3.467121129569379*^9, 
   3.467121156634774*^9}, {3.467121644582208*^9, 3.467121684332472*^9}, {
   3.48042476399629*^9, 3.480424778951466*^9}, {3.480477169549407*^9, 
   3.480477199429993*^9}, 3.480477245698426*^9, {3.653716892089407*^9, 
   3.6537168992891293`*^9}, {3.6554438558618183`*^9, 3.655443895317698*^9}, {
   3.655488710177245*^9, 3.655488721792904*^9}, 3.655587697631755*^9, 
   3.655669630270396*^9}],

Cell["\<\
Eventually it would be nice to have multiple manifolds each with their own \
metric.
That would also allow copies of the same manifold, so in effect, more than \
one metric on a manifold.
Individual  \[Del]  and  \[LeftAngleBracket] \[RightAngleBracket]  would need \
to be defined for each manifold (or copy of a manifold).\
\>", "Text",
 CellChangeTimes->{{3.6555206630326*^9, 3.655520875589905*^9}}],

Cell["\<\
22/11/2016 :  Removed,
    NewMetric[g_] := NewMetric[g, {-1, 1, 1, 1}]
    Logic changed to allow no signature, no dim to be specified, or to be \
specified before or later.
\
\>", "Text"],

Cell["\<\
30/05/2017:  I dont think  DetMetric[ ]  has been used anywhere yet,\
\>", "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"SignDetMetric", "[", "_", "]"}], ",", 
    RowBox[{"DetMetric", "[", "_", "]"}]}], "}"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewConstant", "[", 
  RowBox[{"SignDetMetric", "[", "_", "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewField", "[", 
  RowBox[{"0", ",", 
   RowBox[{"{", 
    RowBox[{"DetMetric", "[", "_", "]"}], "}"}]}], "]"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 TemplateBox[{
  RowBox[{"DetMetric", "[", "_", "]"}],"\" is a scalar field on \"","\"M\"",
   "\".\""},
  "RowDefault"]], "Output"]
}, Open  ]],

Cell["SignDetMetric[\[OpenCurlyDoubleQuote]M\[CloseCurlyDoubleQuote]]  is  \
\[PlusMinus]1, therefore,", "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Power", "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"SignDetMetric", "[", "M_", "]"}], "^", "n_Integer"}], "/;", 
     RowBox[{"EvenQ", "[", "n", "]"}]}], ")"}], ":=", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"SignDetMetric", "[", "M_", "]"}], "^", "n_Integer"}], "/;", 
     RowBox[{"OddQ", "[", "n", "]"}]}], ")"}], "=", 
   RowBox[{"SignDetMetric", "[", "M", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Protect", "[", "Power", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"SignDetMetric", "[", "]"}], ":=", 
  RowBox[{"SignDetMetric", "[", 
   RowBox[{"Manifold", "[", "]"}], "]"}]}]], "Input",
 InitializationCell->True],

Cell["\<\
30/05/2017: Added, so that \[CurlyEpsilon] rules that use a metric know what \
degree it is even if a metric symbol has not been chosen yet,\
\>", "Text"],

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"Metric", "[", "_", "]"}], ",", 
    RowBox[{"MetricInverse", "[", "_", "]"}]}], "}"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewField", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"0", ",", "2"}], "}"}], ",", 
    RowBox[{"Metric", "[", "_", "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewField", "[", 
   RowBox[{
    RowBox[{"{", "2", "}"}], ",", 
    RowBox[{"MetricInverse", "[", "_", "]"}]}], "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{"Clear", "[", "NewMetric", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewMetric", "[", "g_", "]"}], ":=", " ", 
  RowBox[{"NewMetric", "[", 
   RowBox[{"g", ",", 
    RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewMetric", "[", 
   RowBox[{"g_", ",", 
    RowBox[{"{", "sigs___Integer", "}"}]}], "]"}], ":=", 
  RowBox[{"NewMetric", "[", 
   RowBox[{
    RowBox[{"Manifold", "[", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"g", ",", 
      RowBox[{"ToExpression", "[", 
       RowBox[{
        RowBox[{"ToString", "[", "g", "]"}], "<>", "\"\<inv\>\""}], "]"}]}], 
     "}"}], ",", 
    RowBox[{"{", "sigs", "}"}]}], "]"}]}]}], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"NewMetric", "[", 
   RowBox[{"M_", ",", 
    RowBox[{"{", 
     RowBox[{"g_Symbol", ",", "ginv_Symbol"}], "}"}], ",", 
    RowBox[{"{", "sigs___Integer", "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"msg1", ",", "msg2", ",", "msg"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"Apply", "[", 
         RowBox[{"SameQ", ",", 
          RowBox[{"Abs", "[", 
           RowBox[{"{", 
            RowBox[{"1", ",", "sigs"}], "}"}], "]"}]}], "]"}]}], ",", 
       RowBox[{
       "Return", "[", 
        "\"\<The metric signature should be a list with elements \
\[PlusMinus]1.\>\"", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Metric", "[", "M", "]"}], "=", "g"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MetricInverse", "[", "M", "]"}], "=", "ginv"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", " ", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"{", "sigs", "}"}], "]"}], "===", "0"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"MetricSignature", "[", "M", "]"}], "=", 
         RowBox[{"{", "sigs", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", " ", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", 
        RowBox[{"MetricSignature", "[", "M", "]"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"dim", "[", "M", "]"}], "=", 
         RowBox[{"Length", "[", 
          RowBox[{"MetricSignature", "[", "M", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"SignDetMetric", "[", "M", "]"}], "=", 
         RowBox[{"Apply", "[", 
          RowBox[{"Times", ",", 
           RowBox[{"MetricSignature", "[", "M", "]"}]}], "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"NewField", "[", 
      RowBox[{"M", ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Cotangent", "[", "M", "]"}], ",", "2"}], "}"}], "}"}], ",",
        "g"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"NewField", "[", 
      RowBox[{"M", ",", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Tangent", "[", "M", "]"}], ",", "2"}], "}"}], "}"}], ",", 
       "ginv"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Del]", "g"}], ":=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Del]", "ginv"}], "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"AssumeSymmetric", "[", 
      RowBox[{"{", 
       RowBox[{"g", ",", "ginv"}], "}"}], "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"g", "/:", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"g", ",", "ginv"}], "\[RightAngleBracket]"}], ":=", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"2", ",", "1"}], "]"}], "[", 
       RowBox[{"\[Delta]", "[", 
        RowBox[{"dim", "[", "M", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ginv", "/:", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"ginv", ",", "g"}], "\[RightAngleBracket]"}], ":=", 
      RowBox[{"\[Delta]", "[", 
       RowBox[{"dim", "[", "M", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "g", "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]], ":=", 
      RowBox[{"dim", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "ginv", "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]], ":=", 
      RowBox[{"dim", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1__", "\[CircleTimes]", "g", "\[CircleTimes]", "X2__"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", "ab_List", ",", "ab2___List"}]], "/;", 
       RowBox[{"ab", "===", 
        RowBox[{
         RowBox[{"deg", "[", "X1", "]"}], "+", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}]}]}], ":=", 
      RowBox[{
       RowBox[{"dim", "[", "M", "]"}], 
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1", "\[CircleTimes]", "X2"}], "\[RightAngleBracket]"}], 
        RowBox[{"abDrop", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ab1", ",", "ab2"}], "}"}], ",", "ab"}], "]"}]]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1__", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2__"}],
          "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", "ab_List", ",", "ab2___List"}]], "/;", 
       RowBox[{"ab", "===", 
        RowBox[{
         RowBox[{"deg", "[", "X1", "]"}], "+", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}]}]}], ":=", 
      RowBox[{
       RowBox[{"dim", "[", "M", "]"}], 
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1", "\[CircleTimes]", "X2"}], "\[RightAngleBracket]"}], 
        RowBox[{"abDrop", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ab1", ",", "ab2"}], "}"}], ",", "ab"}], "]"}]]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1___", "\[CircleTimes]", "g", "\[CircleTimes]", "X2___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a1_", ",", "b1_"}], "}"}], ",", "ab2___List", ",", 
         RowBox[{"{", 
          RowBox[{"a2_", ",", "b2_"}], "}"}], ",", "ab3___List"}]], "/;", 
       RowBox[{"SubsetQ", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a1", ",", "b1", ",", "a2", ",", "b2"}], "}"}], ",", " ", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]}], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"X1", "\[CircleTimes]", "X2"}], "\[RightAngleBracket]"}], 
       RowBox[{"abDrop", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ab1", ",", "ab2", ",", "ab3", ",", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a1", ",", "b1", ",", "a2", ",", "b2"}], "}"}], ",", 
             " ", 
             RowBox[{
              RowBox[{"deg", "[", "X1", "]"}], "+", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a1_", ",", "b1_"}], "}"}], ",", "ab2___List", ",", 
         RowBox[{"{", 
          RowBox[{"a2_", ",", "b2_"}], "}"}], ",", "ab3___List"}]], "/;", 
       RowBox[{"SubsetQ", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a1", ",", "b1", ",", "a2", ",", "b2"}], "}"}], ",", " ", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]}], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"X1", "\[CircleTimes]", "X2"}], "\[RightAngleBracket]"}], 
       RowBox[{"abDrop", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ab1", ",", "ab2", ",", "ab3", ",", 
           RowBox[{"Complement", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"a1", ",", "b1", ",", "a2", ",", "b2"}], "}"}], ",", 
             " ", 
             RowBox[{
              RowBox[{"deg", "[", "X1", "]"}], "+", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X1__", ",", "X_", ",", "g"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"degBracket", "[", 
         RowBox[{"X1", ",", "X"}], "]"}]}]}], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1", ",", "X"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{"ab1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}], ",", "ab2"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X1__", ",", "X_", ",", "ginv"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"degBracket", "[", 
         RowBox[{"X1", ",", "X"}], "]"}]}]}], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1", ",", "X"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{"ab1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}], ",", "ab2"}]]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X_", ",", "g"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"deg", "[", "X", "]"}]}]}], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "X", "\[RightAngleBracket]"}], 
       RowBox[{"ab1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}], ",", "ab2"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X_", ",", "ginv"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"deg", "[", "X", "]"}]}]}], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "X", "\[RightAngleBracket]"}], 
       RowBox[{"ab1", ",", 
        RowBox[{"{", 
         RowBox[{"a", ",", "b"}], "}"}], ",", "ab2"}]]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"g", ",", "X_", ",", "X1__"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X", ",", "X1"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b"}], "}"}], ",", "ab"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"ginv", ",", "X_", ",", "X1__"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X", ",", "X1"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b"}], "}"}], ",", "ab"}]]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"g", ",", "X_"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "X", "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b"}], "}"}], ",", "ab"}]]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"ginv", ",", "X_"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], ":=", 
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "X", "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b"}], "}"}], ",", "ab"}]]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "g", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"Delete", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"deg", "[", 
              RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "]"}], ",", 
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X"}], "]"}]}], "]"}], ",", 
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X"}], "]"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X", ",", "g"}], "\[RightAngleBracket]"}], "\[CircleTimes]", 
        "X2", "\[CircleTimes]", "X3"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "g", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X", ",", "X2"}], "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"Delete", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"deg", "[", 
              RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"g", ",", "X"}], "\[RightAngleBracket]"}], "\[CircleTimes]", 
        "X2", "\[CircleTimes]", "X3"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "g", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2"}], "]"}], "+", "3"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", "X1", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X2"}], "]"}], "+", "1"}], "}"}], ",", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"deg", "[", "X1", "]"}], "+", "1"}], ",", 
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X2"}], "]"}]}], "]"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", "X2", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"g", ",", "X"}], "\[RightAngleBracket]"}], "\[CircleTimes]", 
        "X3"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "g", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "+", "2"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X2", ",", "X"}], "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", "X1", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"deg", "[", 
            RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "}"}], ",", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"deg", "[", "X1", "]"}], "+", "1"}], ",", 
            RowBox[{
             RowBox[{"deg", "[", 
              RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "-", "1"}]}], 
           "]"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", "X2", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X", ",", "g"}], "\[RightAngleBracket]"}], "\[CircleTimes]", 
        "X3"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "ginv", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"Delete", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"deg", "[", 
              RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "]"}], ",", 
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X"}], "]"}]}], "]"}], ",", 
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X"}], "]"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X", ",", "ginv"}], "\[RightAngleBracket]"}], 
        "\[CircleTimes]", "X2", "\[CircleTimes]", "X3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "ginv", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X", ",", "X2"}], "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"Delete", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"deg", "[", 
              RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"ginv", ",", "X"}], "\[RightAngleBracket]"}], 
        "\[CircleTimes]", "X2", "\[CircleTimes]", "X3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2"}], "]"}], "+", "3"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", "X1", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X2"}], "]"}], "+", "1"}], "}"}], ",", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"deg", "[", "X1", "]"}], "+", "1"}], ",", 
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X2"}], "]"}]}], "]"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", "X2", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"ginv", ",", "X"}], "\[RightAngleBracket]"}], 
        "\[CircleTimes]", "X3"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "+", "2"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X2", ",", "X"}], "]"}], "]"}]}]}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mv", "[", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"deg", "[", "X1", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"deg", "[", 
            RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "}"}], ",", 
          RowBox[{"Range", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"deg", "[", "X1", "]"}], "+", "1"}], ",", 
            RowBox[{
             RowBox[{"deg", "[", 
              RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "-", "1"}]}], 
           "]"}]}], "]"}], "]"}], "[", 
       RowBox[{"X1", "\[CircleTimes]", "X2", "\[CircleTimes]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X", ",", "ginv"}], "\[RightAngleBracket]"}], 
        "\[CircleTimes]", "X3"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"g", "/:", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1__", ",", "g", ",", "X2__"}], "\[RightAngleBracket]"}], ":=", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ginv", "/:", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1__", ",", "ginv", ",", "X2__"}], "\[RightAngleBracket]"}], ":=", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"g", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"X1__", ",", "X2_", ",", "g"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"LastIsCotangentQ", "[", 
        RowBox[{"X2", ",", "M"}], "]"}]}], ":=", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"g", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"X_", ",", "g"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"LastIsCotangentQ", "[", 
        RowBox[{"X", ",", "M"}], "]"}]}], ":=", "X"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ginv", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"X1__", ",", "X2_", ",", "ginv"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"LastIsTangentQ", "[", 
        RowBox[{"X2", ",", "M"}], "]"}]}], ":=", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ginv", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"X_", ",", "ginv"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"LastIsTangentQ", "[", 
        RowBox[{"X", ",", "M"}], "]"}]}], ":=", "X"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"g", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"g", ",", "X1_", ",", "X2__"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"FirstIsCotangentQ", "[", 
        RowBox[{"X1", ",", "M"}], "]"}]}], ":=", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"g", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"g", ",", "X_"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"FirstIsCotangentQ", "[", 
        RowBox[{"X", ",", "M"}], "]"}]}], ":=", "X"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ginv", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"ginv", ",", "X1_", ",", "X2__"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"FirstIsTangentQ", "[", 
        RowBox[{"X1", ",", "M"}], "]"}]}], ":=", 
      RowBox[{"\[LeftAngleBracket]", 
       RowBox[{"X1", ",", "X2"}], "\[RightAngleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ginv", "/:", 
      RowBox[{
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"ginv", ",", "X_"}], "\[RightAngleBracket]"}], "/;", 
       RowBox[{"FirstIsTangentQ", "[", 
        RowBox[{"X", ",", "M"}], "]"}]}], ":=", "X"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[GothicCapitalD]", "[", "g", "]"}], "=", "0"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[GothicCapitalD]", "[", "ginv", "]"}], "=", "0"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Format", "[", 
       RowBox[{"ginv", ",", "StandardForm"}], "]"}], ":=", 
      RowBox[{"Superscript", "[", 
       RowBox[{"g", ",", 
        RowBox[{"-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"msg1", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", 
         RowBox[{"MetricSignature", "[", "M", "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<MetricSignature[\>\"", "<>", "M", "<>", "\"\<] = \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"MetricSignature", "[", "M", "]"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
        "\"\<MetricSignature[\>\"", "<>", "M", "<>", 
         "\"\<] is arbitrary\>\""}]}], "\[IndentingNewLine]", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"msg2", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"ValueQ", "[", 
         RowBox[{"dim", "[", "M", "]"}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<dim[\>\"", "<>", "M", "<>", "\"\<] = \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"dim", "[", "M", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<dim[\>\"", "<>", "M", "<>", "\"\<] is arbitrary\>\""}]}],
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"msg", "=", 
      RowBox[{"Row", "[", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
        "\"\< Metric[\>\"", ",", "M", ",", 
         "\"\<]\[MediumSpace]=\[ThickSpace]\>\"", ",", "g", ",", 
         "\"\<,\\n MetricInverse[\>\"", ",", "M", ",", 
         "\"\<]\[MediumSpace]=\[ThickSpace]\>\"", ",", 
         RowBox[{"ToString", "[", "ginv", "]"}], ",", 
         "\"\<\[MediumSpace] (output as\[ThickSpace]\>\"", ",", "ginv", ",", 
         "\"\<),\\n \>\"", ",", "\[IndentingNewLine]", "msg1", ",", 
         "\"\<,\\n \>\"", ",", "\[IndentingNewLine]", 
         "\"\<SignDetMetric[\>\"", ",", "M", ",", "\"\<] = \>\"", ",", 
         RowBox[{"SignDetMetric", "[", "M", "]"}], ",", "\"\<,\\n \>\"", ",", 
         "\[IndentingNewLine]", "msg2", ",", "\"\<.\\n\>\"", ",", 
         "\[IndentingNewLine]", "\"\<  \[Del] is metric compatible: \>\"", 
         " ", ",", 
         RowBox[{"HoldForm", "[", 
          RowBox[{
           RowBox[{"\[Del]", "g"}], "=", "0"}], "]"}], ",", " ", "\"\<, \>\"",
          ",", 
         RowBox[{"HoldForm", "[", 
          RowBox[{
           RowBox[{"\[Del]", " ", "ginv"}], "=", "0"}], "]"}], ",", 
         "\"\<.\\n\>\"", ",", "\[IndentingNewLine]", 
         "\"\< \[LeftAngleBracket]\[VeryThinSpace]\[RightAngleBracket] is \
metric compatible: factors \>\"", ",", " ", "g", ",", "\"\< and \>\"", ",", 
         "ginv", ",", " ", "\"\< will be assumed as necessary.\>\""}], "}"}], 
       " ", "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True],

Cell["\<\
------------------------------------------------------------------------------\
------------------------------------------------------------------------------\
------
This sort of thing still has no rules to simplify,\
\>", "Text",
 CellChangeTimes->{{3.656181489463438*^9, 3.6561815015841293`*^9}, {
  3.656182089023357*^9, 3.656182118750785*^9}, {3.656182597784416*^9, 
  3.656182613800003*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"M", ",", "\[Eta]"}], "\[RightAngleBracket]"}], "\[CircleTimes]",
     "k", "\[CircleTimes]", "\[Eta]inv"}], "\[RightAngleBracket]"}], 
  RowBox[{"{", 
   RowBox[{"2", ",", "4"}], "}"}]]], "Input",
 CellChangeTimes->{{3.65618052531629*^9, 3.6561805314441557`*^9}}],

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{
    RowBox[{"\[LeftAngleBracket]", 
     RowBox[{"M", ",", "\[Eta]"}], "\[RightAngleBracket]"}], "\[CircleTimes]",
     "k", "\[CircleTimes]", 
    TemplateBox[{"\[Eta]",RowBox[{"-", "1"}]},
     "Superscript"]}], "\[RightAngleBracket]"}], 
  RowBox[{"{", 
   RowBox[{"2", ",", "4"}], "}"}]]], "Output",
 CellChangeTimes->{3.656180535908361*^9}]
}, Open  ]],

Cell["... it needs something like, ", "Text",
 CellChangeTimes->{{3.656181489463438*^9, 3.6561815015841293`*^9}, {
  3.656182089023357*^9, 3.656182118750785*^9}, {3.656182178765891*^9, 
  3.656182197773676*^9}}],

Cell[BoxData[
 RowBox[{
  SubscriptBox[
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     RowBox[{"\[LeftAngleBracket]", 
      RowBox[{
       RowBox[{"X_", "?", "deg2Q"}], ",", "\[Eta]"}], 
      "\[RightAngleBracket]"}], "\[CircleTimes]", 
     RowBox[{"k_", "?", "deg1Q"}], "\[CircleTimes]", "\[Eta]inv"}], 
    "\[RightAngleBracket]"}], 
   RowBox[{"{", 
    RowBox[{"2", ",", "4"}], "}"}]], ":=", " ", 
  RowBox[{
   RowBox[{"mv", "[", 
    RowBox[{"1", ",", "3", ",", "2"}], "]"}], "[", 
   RowBox[{"X", "\[CircleTimes]", "k"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.656123483182208*^9, 3.65612355280469*^9}, {
  3.656123595092243*^9, 3.656123621036035*^9}}],

Cell["\<\
ie.,  mv[ ]  equivalents of metric contractions. Similarly, we still need mv[ \
] equivalents of  \[Delta]  contractions. 
------------------------------------------------------------------------------\
------------------------------------------------------------------------------\
------\
\>", "Text",
 CellChangeTimes->{{3.656182487641707*^9, 3.656182586405308*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SlotType", "[", 
  RowBox[{"\[Delta]", "[", "4", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.655872164815337*^9, 3.655872170127162*^9}}],

Cell[BoxData[
 RowBox[{"SlotData", "[", 
  RowBox[{
   RowBox[{"\<\"T\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "4"], "]"}], ",", 
   RowBox[{"\<\"\\!\\(\\*SuperscriptBox[\\(T\\), \
\\(\\(\[VeryThinSpace]\\)\\(*\\)\\)]\\)\[NegativeThinSpace]\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "4"], "]"}]}], "]"}]], "Output",\

 CellChangeTimes->{3.655872171293418*^9, 3.656121533709405*^9, 
  3.65612181654243*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"SlotType", "[", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"g", ",", "ginv"}], "\[RightAngleBracket]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"SlotType", "[", 
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"ginv", ",", "g"}], "\[RightAngleBracket]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.655872250416803*^9, 3.6558722527179737`*^9}, {
  3.655872764812994*^9, 3.655872772549802*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"mv", "[", 
   RowBox[{"2", ",", "1"}], "]"}], "[", 
  RowBox[{"SlotData", "[", 
   RowBox[{
    RowBox[{"\<\"T\"\>", "[", 
     SuperscriptBox["\[DoubleStruckCapitalR]", "3"], "]"}], ",", 
    RowBox[{"\<\"\\!\\(\\*SuperscriptBox[\\(T\\), \
\\(\\(\[VeryThinSpace]\\)\\(*\\)\\)]\\)\[NegativeThinSpace]\"\>", "[", 
     SuperscriptBox["\[DoubleStruckCapitalR]", "3"], "]"}]}], "]"}], 
  "]"}]], "Output",
 CellChangeTimes->{
  3.65587246690692*^9, 3.655872740545519*^9, 3.65587277380472*^9, {
   3.656121536802649*^9, 3.6561215500077667`*^9}, 3.6561216261981163`*^9, 
   3.656121818355755*^9}],

Cell[BoxData[
 RowBox[{"SlotData", "[", 
  RowBox[{
   RowBox[{"\<\"T\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "3"], "]"}], ",", 
   RowBox[{"\<\"\\!\\(\\*SuperscriptBox[\\(T\\), \
\\(\\(\[VeryThinSpace]\\)\\(*\\)\\)]\\)\[NegativeThinSpace]\"\>", "[", 
    SuperscriptBox["\[DoubleStruckCapitalR]", "3"], "]"}]}], "]"}]], "Output",\

 CellChangeTimes->{
  3.65587246690692*^9, 3.655872740545519*^9, 3.65587277380472*^9, {
   3.656121536802649*^9, 3.6561215500077667`*^9}, 3.6561216261981163`*^9, 
   3.656121818356614*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manifold", "[", "]"}]], "Input",
 CellChangeTimes->{{3.656121589097269*^9, 3.656121591719998*^9}}],

Cell[BoxData["\<\"M\"\>"], "Output",
 CellChangeTimes->{3.6561215922134953`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FirstIsTangentQ", "[", 
   RowBox[{"X_", ",", "M_"}], "]"}], ":=", 
  RowBox[{"MatchQ", "[", 
   RowBox[{
    RowBox[{"SlotType", "[", "X", "]"}], ",", 
    RowBox[{"SlotData", "[", 
     RowBox[{
      RowBox[{"Tangent", "[", "M", "]"}], ",", "___"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FirstIsCotangentQ", "[", 
   RowBox[{"X_", ",", "M_"}], "]"}], ":=", 
  RowBox[{"MatchQ", "[", 
   RowBox[{
    RowBox[{"SlotType", "[", "X", "]"}], ",", 
    RowBox[{"SlotData", "[", 
     RowBox[{
      RowBox[{"Cotangent", "[", "M", "]"}], ",", "___"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LastIsTangentQ", "[", 
   RowBox[{"X_", ",", "M_"}], "]"}], ":=", 
  RowBox[{"MatchQ", "[", 
   RowBox[{
    RowBox[{"SlotType", "[", "X", "]"}], ",", 
    RowBox[{"SlotData", "[", 
     RowBox[{"___", ",", 
      RowBox[{"Tangent", "[", "M", "]"}]}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LastIsCotangentQ", "[", 
   RowBox[{"X_", ",", "M_"}], "]"}], ":=", 
  RowBox[{"MatchQ", "[", 
   RowBox[{
    RowBox[{"SlotType", "[", "X", "]"}], ",", 
    RowBox[{"SlotData", "[", 
     RowBox[{"___", ",", 
      RowBox[{"Cotangent", "[", "M", "]"}]}], "]"}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655871074182353*^9, 3.655871110432333*^9}, {
  3.655871179055113*^9, 3.65587129108534*^9}, {3.655871503562344*^9, 
  3.655871555994796*^9}, {3.6561199269551783`*^9, 3.656119968064571*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearMetric", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"NewMetric", "[", 
  RowBox[{"g", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", "1", ",", "1"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.65560091363564*^9, 3.655600919511264*^9}, {
  3.655601099459841*^9, 3.655601107204691*^9}, {3.6556055047314167`*^9, 
  3.655605519315956*^9}, {3.655605754248416*^9, 3.655605755191998*^9}, {
  3.65560589147855*^9, 3.6556058941344757`*^9}}],

Cell[BoxData[
 TemplateBox[{
  "\" Metric[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"","g",
   "\",\\n MetricInverse[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"",
   "\"ginv\"","\"\[MediumSpace]=\[ThickSpace]\"",TemplateBox[{"g", 
     RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox],
   "\",\\n MetricSignature[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"",
   RowBox[{"{", 
     RowBox[{
       RowBox[{"-", "1"}], ",", "1", ",", "1"}], "}"}],"\", and dim[\"",
   "\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"","3","\".\\n\"",
   "\"  \[Del] is metric compatible: \"",TagBox[
    RowBox[{
      RowBox[{"\[Del]", "g"}], "=", "0"}], HoldForm],"\", \"",TagBox[
    RowBox[{
      RowBox[{"\[Del]", 
        TemplateBox[{"g", 
          RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox]}],
       "=", "0"}], HoldForm],"\".\\n\"",
   "\" \[LeftAngleBracket]\[VeryThinSpace]\[RightAngleBracket] is metric \
compatible: factors \"","g","\" and \"",TemplateBox[{"g", 
     RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox],
   "\" will be assumed as necessary.\""},
  "RowDefault"]], "Output",
 CellChangeTimes->{
  3.65560589467878*^9, {3.65566648938383*^9, 3.655666494429572*^9}, {
   3.6556665291298323`*^9, 3.655666539886582*^9}, 3.655872460111745*^9, 
   3.656121547803006*^9, 3.656121622577232*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"NewManifold", "[", 
  RowBox[{"\"\<M\>\"", ",", "g", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1"}], "}"}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.655607151759975*^9, 3.655607161398387*^9}, {
  3.6556073098442698`*^9, 3.655607318788148*^9}}],

Cell[BoxData[
 TemplateBox[{
  "\" Metric[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"","g",
   "\",\\n MetricInverse[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"",
   "\"ginv\"","\"\[MediumSpace]=\[ThickSpace]\"",TemplateBox[{"g", 
     RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox],
   "\",\\n MetricSignature[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"",
   RowBox[{"{", 
     RowBox[{
       RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1"}], "}"}],
   "\", and dim[\"","\"M\"","\"]\[MediumSpace]=\[ThickSpace]\"","4",
   "\".\\n\"","\"  \[Del] is metric compatible: \"",TagBox[
    RowBox[{
      RowBox[{"\[Del]", "g"}], "=", "0"}], HoldForm],"\", \"",TagBox[
    RowBox[{
      RowBox[{"\[Del]", 
        TemplateBox[{"g", 
          RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox]}],
       "=", "0"}], HoldForm],"\".\\n\"",
   "\" \[LeftAngleBracket]\[VeryThinSpace]\[RightAngleBracket] is metric \
compatible: factors \"","g","\" and \"",TemplateBox[{"g", 
     RowBox[{"-", "1"}]}, "Superscript", SyntaxForm -> SuperscriptBox],
   "\" will be assumed as necessary.\""},
  "RowDefault"]], "Output",
 CellChangeTimes->{
  3.655607324199499*^9, 3.655607372386718*^9, 3.6556074259274807`*^9, 
   3.656172358784483*^9, {3.656172884241145*^9, 3.656172907371718*^9}, {
   3.6561962917672453`*^9, 3.6561962953138313`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Testing", "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.656172438301443*^9, 3.656172439933359*^9}, 
   3.65617297587855*^9}],

Cell[BoxData[{
 RowBox[{"ClearField", "[", 
  RowBox[{"{", 
   RowBox[{"X", ",", "Y"}], "}"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewField", "[", 
   RowBox[{
    RowBox[{"{", "3", "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"X", ",", "Y"}], "}"}]}], "]"}], ";"}]}], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6561724441960573`*^9, 3.65617249257335*^9}, 
   3.6561729758786793`*^9}],

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", "\[CircleTimes]", "g", "\[CircleTimes]", "Y"}], 
   "\[RightAngleBracket]"}], 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"5", ",", "6"}], "}"}]}]]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.6561724169852*^9, 3.656172418045908*^9}, 
   3.656172508284704*^9, {3.6561726176915092`*^9, 3.656172663594795*^9}, 
   3.656172975878763*^9}],

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", "\[CircleTimes]", "Y"}], "\[RightAngleBracket]"}], 
  RowBox[{"{", 
   RowBox[{"2", ",", "4"}], "}"}]]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.6561726800251217`*^9, 3.656172913776165*^9, 
  3.656172975878846*^9}],

Cell[BoxData[
 SubscriptBox[
  RowBox[{"\[LeftAngleBracket]", 
   RowBox[{"X", "\[CircleTimes]", "g", "\[CircleTimes]", "Y"}], 
   "\[RightAngleBracket]"}], 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"2", ",", "4"}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "5"}], "}"}]}]]], "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{{3.656172728298004*^9, 3.656172732761909*^9}, 
   3.656172975878934*^9}],

Cell[BoxData[
 RowBox[{
  SubscriptBox[
   RowBox[{"\[LeftAngleBracket]", "X", "\[RightAngleBracket]"}], 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}]], "\[CircleTimes]", "Y"}]], "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.},
 CellChangeTimes->{3.6561727337710457`*^9, 3.6561729162235126`*^9, 
  3.6561729758790073`*^9}]
}, Closed]],

Cell["\<\
Enquiry functions. Values are set in  NewMetric[ ].
The no-argument defaults are,\
\>", "Text",
 CellChangeTimes->{{3.65549112395499*^9, 3.6554912545776663`*^9}, {
  3.655496487102109*^9, 3.655496487574609*^9}, {3.6555151899496717`*^9, 
  3.655515223709215*^9}, {3.655601316689994*^9, 3.655601377729154*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Metric", "[", "]"}], ":=", 
  RowBox[{"Metric", "[", 
   RowBox[{"Manifold", "[", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MetricInverse", "[", "]"}], ":=", 
  RowBox[{"MetricInverse", "[", 
   RowBox[{"Manifold", "[", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MetricSignature", "[", "]"}], ":=", 
  RowBox[{"MetricSignature", "[", 
   RowBox[{"Manifold", "[", "]"}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655490588233942*^9, 3.655490588425915*^9}, {
  3.655490632013476*^9, 3.655490634548451*^9}, {3.655601379952302*^9, 
  3.655601408375358*^9}}],

Cell["\<\
Values for  \[Del]  and  \[GothicCapitalD]  are cleared by  ClearField[ ].
Upvalues are cleared by Clear[ ] applied to  {g, ginv}.\
\>", "Text",
 CellChangeTimes->{{3.655505471145893*^9, 3.65550550738549*^9}, {
  3.655516251504897*^9, 3.655516270591502*^9}, {3.655516753626493*^9, 
  3.655516775369199*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "ClearMetric", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearMetric", "[", "]"}], ":=", 
  RowBox[{"ClearMetric", "[", 
   RowBox[{"Manifold", "[", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearMetric", "[", "M_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"g", ",", "ginv"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", 
         RowBox[{"Metric", "[", "M", "]"}], "]"}], "===", "Metric"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"Row", "[", 
         RowBox[{"{", 
          RowBox[{
          "\"\<Nothing done: no metric is defined for manifold \>\"", ",", 
           "M"}], "}"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"g", "=", 
      RowBox[{"Metric", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ginv", "=", 
      RowBox[{"MetricInverse", "[", "M", "]"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "g", "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]], "=."}], ";", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", "ginv", "\[RightAngleBracket]"}], 
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}]], "=."}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1__", "\[CircleTimes]", "g", "\[CircleTimes]", "X2__"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", "ab_List", ",", "ab2___List"}]], "/;", 
       RowBox[{"ab", "===", 
        RowBox[{
         RowBox[{"deg", "[", "X1", "]"}], "+", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1__", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2__"}],
          "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", "ab_List", ",", "ab2___List"}]], "/;", 
       RowBox[{"ab", "===", 
        RowBox[{
         RowBox[{"deg", "[", "X1", "]"}], "+", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"X1___", "\[CircleTimes]", "g", "\[CircleTimes]", "X2___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a1_", ",", "b1_"}], "}"}], ",", "ab2___List", ",", 
         RowBox[{"{", 
          RowBox[{"a2_", ",", "b2_"}], "}"}], ",", "ab3___List"}]], "/;", 
       RowBox[{"SubsetQ", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a1", ",", "b1", ",", "a2", ",", "b2"}], "}"}], ",", " ", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a1_", ",", "b1_"}], "}"}], ",", "ab2___List", ",", 
         RowBox[{"{", 
          RowBox[{"a2_", ",", "b2_"}], "}"}], ",", "ab3___List"}]], "/;", 
       RowBox[{"SubsetQ", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"a1", ",", "b1", ",", "a2", ",", "b2"}], "}"}], ",", " ", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", 
          RowBox[{"{", 
           RowBox[{"1", ",", "2"}], "}"}]}]}], "]"}]}], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X1__", ",", "X_", ",", "g"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"degBracket", "[", 
         RowBox[{"X1", ",", "X"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X1__", ",", "X_", ",", "ginv"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"degBracket", "[", 
         RowBox[{"X1", ",", "X"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X_", ",", "g"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"deg", "[", "X", "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"\[LeftAngleBracket]", 
          RowBox[{"X_", ",", "ginv"}], "\[RightAngleBracket]"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"ab1___List", ",", 
         RowBox[{"{", 
          RowBox[{"a_", ",", "b_"}], "}"}], ",", "ab2___List"}]], "/;", 
       RowBox[{"b", "===", 
        RowBox[{"deg", "[", "X", "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"g", ",", "X_", ",", "X1__"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"ginv", ",", "X_", ",", "X1__"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "g", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "g", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X", ",", "X2"}], "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "g", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2"}], "]"}], "+", "3"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "g", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "+", "2"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X2", ",", "X"}], "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "ginv", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X1", ",", "X"}], "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "X_", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "ginv", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"a", "===", 
         RowBox[{
          RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "&&", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "1"}]}], "||", 
          RowBox[{"b", "===", 
           RowBox[{
            RowBox[{"deg", "[", 
             RowBox[{"X1", ",", "X", ",", "X2"}], "]"}], "+", "2"}]}]}], 
         ")"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X", ",", "X2"}], "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2"}], "]"}], "+", "3"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X2", "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SubscriptBox[
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{
         "X1___", "\[CircleTimes]", "ginv", "\[CircleTimes]", "X2___", 
          "\[CircleTimes]", "X_", "\[CircleTimes]", "X3___"}], 
         "\[RightAngleBracket]"}], 
        RowBox[{"{", 
         RowBox[{"a_", ",", "b_"}], "}"}]], "/;", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "1"}]}], "||", 
          RowBox[{"a", "===", 
           RowBox[{
            RowBox[{"deg", "[", "X1", "]"}], "+", "2"}]}]}], ")"}], "&&", 
        RowBox[{"b", "===", 
         RowBox[{
          RowBox[{"deg", "[", 
           RowBox[{"X1", ",", "X2", ",", "X"}], "]"}], "+", "2"}]}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", "X1", "]"}], "]"}], "&&", 
        RowBox[{"IntegerQ", "[", 
         RowBox[{"deg", "[", 
          RowBox[{"X2", ",", "X"}], "]"}], "]"}]}]}], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"g", ",", "X_"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      SubscriptBox[
       RowBox[{"\[LeftAngleBracket]", 
        RowBox[{"\[LeftAngleBracket]", 
         RowBox[{"ginv", ",", "X_"}], "\[RightAngleBracket]"}], 
        "\[RightAngleBracket]"}], 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"1", ",", "b_"}], "}"}], ",", "ab___List"}]], "=."}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Format", "[", 
       RowBox[{"ginv", ",", "StandardForm"}], "]"}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ClearField", "[", 
      RowBox[{"Evaluate", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Metric", "[", "M", "]"}], ",", 
         RowBox[{"MetricInverse", "[", "M", "]"}]}], "}"}], "]"}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{"Clear", ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Metric", "[", "M", "]"}], ",", 
            RowBox[{"MetricInverse", "[", "M", "]"}]}], "}"}], "]"}]}], "]"}],
        ";"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Metric", "[", "M", "]"}], "=."}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MetricInverse", "[", "M", "]"}], "=."}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MetricSignature", "[", "M", "]"}], "=."}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
DistinctQ[ ] ,    SignatureFunction[ ]   ---  use it to define  \[Eta]\
\[VeryThinSpace][ i, j ]\
\>", "Subsection"],

Cell[TextData[{
 "SignatureFunction[ \[Eta] , { ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "0"], TraditionalForm]]],
 ", ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "1"], TraditionalForm]]],
 ", ...  }  ] ,  where  ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["s", "i"], " ", "=", " ", 
    RowBox[{"\[PlusMinus]", "1"}]}], TraditionalForm]]],
 ",   will define an indexed scalar function  \[Eta]\[VeryThinSpace][ i, j ] \
,  such that \n\n                 \[Eta] [ i , i ]  =  ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "i"], TraditionalForm]]],
 "   \n                 \[Eta] [ i , j ]  =  0   if   i \[NotEqual] j\n       \
          \nwhere  i, j = 0,1,2, .... .   \n\nSignatureFunction[ \[Eta] , { \
",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "0"], TraditionalForm]]],
 ", ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "1"], TraditionalForm]]],
 ", ...  } , ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["i", "min"], TraditionalForm]]],
 " ]   will start the index range at  ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["i", "min"], TraditionalForm]]],
 "  instead of the default   ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["i", "min"], TraditionalForm]]],
 " = 0.\n\nSignatureFunction[ ]  will set up various useful relations, such \
as zero derivatives, simplifications for symbolic indices,\nsorted symbolic \
index order, and index range checks for numerical indices.\n\nThe index range \
  { ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["i", "min"], TraditionalForm]]],
 " , ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["i", "max"], TraditionalForm]]],
 " }   for  \[Eta]\[VeryThinSpace][ i, j ]   is returned as the value of   \
IndexRangeSF[ \[Eta]  ] .\nThe signature list  { ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "0"], TraditionalForm]]],
 ", ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["s", "1"], TraditionalForm]]],
 ", ... }   for  \[Eta]\[VeryThinSpace][ i, j ]   is returned as the value of \
  DiagonalSF[ \[Eta]  ] .\n\nClearSignatureFunction[ \[Eta] ]    will remove \
all definitions made by   SignatureFunction[  \[Eta] , ... ] . \n\nTypical \
usage:\n                                 SignatureFunction[ \[Eta] ,  { -1, \
1, 1, 1}  ]         \n                                                        \
       "
}], "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Distinct", "[", 
   RowBox[{"i_", ",", "j_"}], "]"}], ":=", 
  RowBox[{"Simplify", "[", 
   RowBox[{"!", 
    RowBox[{"(", 
     RowBox[{"i", "\[Equal]", "j"}], ")"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Distinct", "[", "i__", "]"}], ":=", 
  RowBox[{"Simplify", "[", 
   RowBox[{"Apply", "[", 
    RowBox[{"And", ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"!", 
         RowBox[{"Apply", "[", 
          RowBox[{"Equal", ",", "#"}], "]"}]}], "&"}], ",", 
       RowBox[{"Subsets", "[", 
        RowBox[{
         RowBox[{"Sort", "[", 
          RowBox[{"{", "i", "}"}], "]"}], ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}], "]"}], "]"}]}]], "Input",\

 InitializationCell->True],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Distinct", "[", 
  RowBox[{"i", ",", "j", ",", "k"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"i", "\[NotEqual]", "j"}], "&&", 
  RowBox[{"i", "\[NotEqual]", "k"}], "&&", 
  RowBox[{"j", "\[NotEqual]", "k"}]}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Distinct", "[", 
  RowBox[{"j", ",", "i", ",", "k"}], "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"i", "\[NotEqual]", "j"}], "&&", 
  RowBox[{"i", "\[NotEqual]", "k"}], "&&", 
  RowBox[{"j", "\[NotEqual]", "k"}]}]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SameQ", "[", 
  RowBox[{"1", ",", "2"}], "]"}]], "Input"],

Cell[BoxData["False"], "Output"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "SignatureFunction", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "SignatureFunction", "]"}], ";"}]}], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SignatureFunction", "[", 
   RowBox[{"f_Symbol", ",", " ", "diag_List"}], "]"}], ":=", 
  RowBox[{"SignatureFunction", "[", 
   RowBox[{"f", ",", " ", "diag", ",", "0"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SignatureFunction", "[", 
   RowBox[{"f_Symbol", ",", " ", "diag_List", ",", "imin_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "f", "]"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<SignatureFunction[]: Symbol \>\"", ",", 
          RowBox[{"Unevaluated", "[", "f", "]"}], ",", " ", 
          "\"\< already has a value.\>\""}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"Apply", "[", 
         RowBox[{"And", ",", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"SameQ", "[", 
                RowBox[{"1", ",", "#"}], "]"}], "||", 
               RowBox[{"SameQ", "[", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "#"}], "]"}]}], ")"}], "&"}], ",", 
            "diag"}], "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<The 2nd argument of SignatureFunction[] should be a list of \
integers equal to \[PlusMinus]1.\>\"", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "diag", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ClearField", "[", 
      RowBox[{"f", "[", 
       RowBox[{"_", ",", "_"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"NewConstant", "[", 
      RowBox[{"f", "[", 
       RowBox[{"_", ",", "_"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DiagonalSF", "[", "f", "]"}], "=", "diag"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndexRangeSF", "[", "f", "]"}], "=", " ", 
      RowBox[{"{", 
       RowBox[{"imin", ",", 
        RowBox[{"imin", "+", 
         RowBox[{"Length", "[", "diag", "]"}], "-", "1"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{
        RowBox[{"i_", "/;", 
         RowBox[{"TrueQ", "[", 
          RowBox[{"!", 
           RowBox[{
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "i", 
            "\[LessEqual]", 
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], ",", "j_"}], "]"}], 
      ":=", "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Index out of range \>\"", ",", 
          RowBox[{"IndexRangeSF", "[", "f", "]"}], ",", "\"\< : \>\"", ",", 
          " ", "f", ",", "\"\<[\>\"", ",", "i", ",", "\"\<,\>\"", ",", "j", 
          ",", "\"\<]\>\""}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"i_", ",", 
        RowBox[{"j_", "/;", 
         RowBox[{"TrueQ", "[", 
          RowBox[{"!", 
           RowBox[{
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "j", 
            "\[LessEqual]", 
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], ":=", 
      "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Index out of range \>\"", ",", 
          RowBox[{"IndexRangeSF", "[", "f", "]"}], ",", "\"\< : \>\"", ",", 
          " ", "f", ",", "\"\<[\>\"", ",", "i", ",", "\"\<,\>\"", ",", "j", 
          ",", "\"\<]\>\""}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"i_", ",", "j_"}], "]"}], "/;", 
       RowBox[{
        RowBox[{"Abs", "[", 
         RowBox[{"i", "-", "j"}], "]"}], ">", 
        RowBox[{
         RowBox[{
          RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], "-", 
         RowBox[{
          RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}]}]}]}], ":=", "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Index out of range \>\"", ",", 
          RowBox[{"IndexRangeSF", "[", "f", "]"}], ",", "\"\< : \>\"", ",", 
          " ", "f", ",", "\"\<[\>\"", ",", "i", ",", "\"\<,\>\"", ",", "j", 
          ",", "\"\<]\>\""}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"i_Integer", ",", "j_Integer"}], "]"}], ":=", 
      "\[IndentingNewLine]", "                 ", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "i", 
          "\[LessEqual]", 
          RowBox[{
           RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "&&", "\[IndentingNewLine]", 
         "                   ", 
         RowBox[{
          RowBox[{
           RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "j", 
          "\[LessEqual]", 
          RowBox[{
           RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
        "                     ", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"i", "===", "j"}], ",", 
          RowBox[{
           RowBox[{"DiagonalSF", "[", "f", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"i", "-", 
             RowBox[{
              RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], "]"}], "]"}], ",", 
          "0"}], "]"}], ",", " ", "\[IndentingNewLine]", 
        "                     ", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Index out of range \>\"", ",", 
           RowBox[{"IndexRangeSF", "[", "f", "]"}], ",", "\"\< : \>\"", ",", 
           " ", "f", ",", "\"\<[\>\"", ",", "i", ",", "\"\<,\>\"", ",", "j", 
           ",", "\"\<]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
         "                     ", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"j_", ",", "i_"}], "]"}], "/;", 
       RowBox[{"!", 
        RowBox[{"OrderedQ", "[", 
         RowBox[{"{", 
          RowBox[{"j", ",", "i"}], "}"}], "]"}]}]}], ":=", 
      RowBox[{"f", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"i_", ",", "j_"}], "]"}], "/;", 
       RowBox[{"Distinct", "[", 
        RowBox[{"i", ",", "j"}], "]"}]}], ":=", "0"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Apply", "[", 
        RowBox[{"SameQ", ",", "diag"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"f", "[", 
         RowBox[{"i_", ",", "i_"}], "]"}], "=", 
        RowBox[{"diag", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"f", "/:", 
        SuperscriptBox[
         RowBox[{"f", "[", 
          RowBox[{"i_", ",", "i_"}], "]"}], "2"], ":=", "1"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"f", "/:", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"f", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], 
        RowBox[{"n_", "?", "EvenQ"}]], "/;", 
       RowBox[{"n", ">", "2"}]}], ":=", 
      SuperscriptBox[
       RowBox[{"f", "[", 
        RowBox[{"i", ",", "j"}], "]"}], "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"f", "/:", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"f", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], 
        RowBox[{"n_", "?", "OddQ"}]], "/;", 
       RowBox[{"n", ">", "1"}]}], ":=", 
      RowBox[{"f", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "ClearSignatureFunction", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ClearSignatureFunction", "[", "f_Symbol", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Quiet", "[", 
      RowBox[{"(", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"IndexRangeSF", "[", "f", "]"}], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{
           RowBox[{"i_", "/;", 
            RowBox[{"TrueQ", "[", 
             RowBox[{"!", 
              RowBox[{
               RowBox[{
                RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "i", 
               "\[LessEqual]", 
               RowBox[{
                RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], ",", "j_"}], 
          "]"}], "=."}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"i_", ",", 
           RowBox[{"j_", "/;", 
            RowBox[{"TrueQ", "[", 
             RowBox[{"!", 
              RowBox[{
               RowBox[{
                RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "j", 
               "\[LessEqual]", 
               RowBox[{
                RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}]}], "]"}], "=."}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"i_", ",", "j_"}], "]"}], "/;", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"i", "-", "j"}], "]"}], ">", 
           RowBox[{
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "f", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}]}], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"i_Integer", ",", "j_Integer"}], "]"}], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"j_", ",", "i_"}], "]"}], "/;", 
          RowBox[{"!", 
           RowBox[{"OrderedQ", "[", 
            RowBox[{"{", 
             RowBox[{"j", ",", "i"}], "}"}], "]"}]}]}], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"f", "[", 
           RowBox[{"i_", ",", "j_"}], "]"}], "/;", 
          RowBox[{"Distinct", "[", 
           RowBox[{"i", ",", "j"}], "]"}]}], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"f", "[", 
          RowBox[{"i_", ",", "i_"}], "]"}], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"f", "/:", 
         SuperscriptBox[
          RowBox[{"f", "[", 
           RowBox[{"i_", ",", "i_"}], "]"}], "2"], "=."}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"f", "/:", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"f", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}], 
           RowBox[{"n_", "?", "EvenQ"}]], "/;", 
          RowBox[{"n", ">", "2"}]}], "=."}], ";", "\[IndentingNewLine]", 
        RowBox[{"f", "/:", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"f", "[", 
            RowBox[{"i_", ",", "j_"}], "]"}], 
           RowBox[{"n_", "?", "OddQ"}]], "/;", 
          RowBox[{"n", ">", "1"}]}], "=."}], ";"}], ")"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ClearField", "[", 
      RowBox[{"f", "[", 
       RowBox[{"_", ",", "_"}], "]"}], "]"}], ";"}]}], "]"}]}]}], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Examples",
 FontWeight->"Bold"]], "Text"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Eta]", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"SignatureFunction", "[", 
  RowBox[{"\[Eta]", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1"}], "}"}], ",", "1"}], 
  "]"}]}], "Input"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Symbol \"\>", "\[InvisibleSpace]", "\[Eta]", 
   "\[InvisibleSpace]", "\<\" already has a value.\"\>"}],
  SequenceForm["Symbol ", $CellContext`\[Eta], " already has a value."],
  Editable->False]], "Print"],

Cell[BoxData["$Aborted"], "Output"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Eta]", "=."}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ClearSignatureFunction", "[", "\[Eta]", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"SignatureFunction", "[", 
  RowBox[{"\[Eta]", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "1"}], ",", "1", ",", "1", ",", "1"}], "}"}]}], 
  "]"}]}], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"\[Eta]", "[", 
     RowBox[{"i", ",", "j"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"i", ",", "0", ",", "3"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "0", ",", "3"}], "}"}]}], "]"}], "//", 
  "MatrixForm"}]], "Input"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"-", "1"}], "0", "0", "0"},
     {"0", "1", "0", "0"},
     {"0", "0", "1", "0"},
     {"0", "0", "0", "1"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"\[Eta]", "[", 
  RowBox[{"j", ",", "i"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"\[Eta]", "[", 
  RowBox[{"i", ",", "2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"\[Eta]", "[", 
  RowBox[{"i", ",", 
   RowBox[{"i", "+", "1"}]}], "]"}], "\[IndentingNewLine]", 
 SuperscriptBox[
  RowBox[{"\[Eta]", "[", 
   RowBox[{"i", ",", "j"}], "]"}], "3"], "\[IndentingNewLine]", 
 SuperscriptBox[
  RowBox[{"\[Eta]", "[", 
   RowBox[{"i", ",", "j"}], "]"}], "4"], "\[IndentingNewLine]"}], "Input"],

Cell[BoxData[
 RowBox[{"\[Eta]", "[", 
  RowBox[{"i", ",", "j"}], "]"}]], "Output"],

Cell[BoxData[
 RowBox[{"\[Eta]", "[", 
  RowBox[{"2", ",", "i"}], "]"}]], "Output"],

Cell[BoxData["0"], "Output"],

Cell[BoxData[
 RowBox[{"\[Eta]", "[", 
  RowBox[{"i", ",", "j"}], "]"}]], "Output"],

Cell[BoxData[
 SuperscriptBox[
  RowBox[{"\[Eta]", "[", 
   RowBox[{"i", ",", "j"}], "]"}], "2"]], "Output"]
}, Open  ]],

Cell["Error messages:", "Text"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Eta]", "[", 
  RowBox[{"2", ",", "5"}], "]"}]], "Input"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Index out of range \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"0", ",", "3"}], "}"}], "\[InvisibleSpace]", "\<\" : \"\>", 
   "\[InvisibleSpace]", "\[Eta]", "\[InvisibleSpace]", "\<\"[\"\>", 
   "\[InvisibleSpace]", "2", "\[InvisibleSpace]", "\<\",\"\>", 
   "\[InvisibleSpace]", "5", "\[InvisibleSpace]", "\<\"]\"\>"}],
  SequenceForm[
  "Index out of range ", {0, 3}, " : ", $CellContext`\[Eta], "[", 2, ",", 5, 
   "]"],
  Editable->False]], "Print"],

Cell[BoxData["$Aborted"], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Eta]", "[", 
  RowBox[{"8", ",", "i"}], "]"}]], "Input"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Index out of range \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"0", ",", "3"}], "}"}], "\[InvisibleSpace]", "\<\" : \"\>", 
   "\[InvisibleSpace]", "\[Eta]", "\[InvisibleSpace]", "\<\"[\"\>", 
   "\[InvisibleSpace]", "8", "\[InvisibleSpace]", "\<\",\"\>", 
   "\[InvisibleSpace]", "i", "\[InvisibleSpace]", "\<\"]\"\>"}],
  SequenceForm[
  "Index out of range ", {0, 3}, " : ", $CellContext`\[Eta], "[", 8, 
   ",", $CellContext`i, "]"],
  Editable->False]], "Print"],

Cell[BoxData["$Aborted"], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Eta]", "[", 
  RowBox[{"j", ",", 
   RowBox[{"-", "1"}]}], "]"}]], "Input"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Index out of range \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"0", ",", "3"}], "}"}], "\[InvisibleSpace]", "\<\" : \"\>", 
   "\[InvisibleSpace]", "\[Eta]", "\[InvisibleSpace]", "\<\"[\"\>", 
   "\[InvisibleSpace]", "j", "\[InvisibleSpace]", "\<\",\"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"-", "1"}], "\[InvisibleSpace]", "\<\"]\"\>"}],
  SequenceForm[
  "Index out of range ", {0, 3}, " : ", $CellContext`\[Eta], 
   "[", $CellContext`j, ",", -1, "]"],
  Editable->False]], "Print"],

Cell[BoxData["$Aborted"], "Output"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[Eta]", "[", 
  RowBox[{
   RowBox[{"j", "-", "2"}], ",", 
   RowBox[{"j", "+", "4"}]}], "]"}]], "Input"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Index out of range \"\>", "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"0", ",", "3"}], "}"}], "\[InvisibleSpace]", "\<\" : \"\>", 
   "\[InvisibleSpace]", "\[Eta]", "\[InvisibleSpace]", "\<\"[\"\>", 
   "\[InvisibleSpace]", 
   RowBox[{
    RowBox[{"-", "2"}], "+", "j"}], "\[InvisibleSpace]", "\<\",\"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"4", "+", "j"}], "\[InvisibleSpace]", "\<\"]\"\>"}],
  SequenceForm[
  "Index out of range ", {0, 3}, " : ", $CellContext`\[Eta], 
   "[", -2 + $CellContext`j, ",", 4 + $CellContext`j, "]"],
  Editable->False]], "Print"],

Cell[BoxData["$Aborted"], "Output"]
}, Open  ]]
}, Closed]],

Cell[TextData[{
 "\nSignatureFunction[ \[Eta] ]    defines the general signature function   \
\[Eta] [ i , j ]    for an unspecified list of signature values  { \
\[PlusMinus]1 , \[PlusMinus]1 , \[PlusMinus]1 , .... }   and index range  { \
0, \[Infinity] } .\nSignatureFunction[ \[Eta] , imin]    has index range  { \
",
 Cell[BoxData[
  FormBox[
   SubscriptBox["i", "min"], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ", \[Infinity] } .\n"
}], "Text"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SignatureFunction", "[", "f_Symbol", "]"}], ":=", 
  RowBox[{"SignatureFunction", "[", 
   RowBox[{"f", ",", "0"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SignatureFunction", "[", 
   RowBox[{"f_Symbol", ",", " ", "imin_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ValueQ", "[", "f", "]"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Symbol \>\"", ",", 
          RowBox[{"Unevaluated", "[", "f", "]"}], ",", " ", 
          "\"\< already has a value.\>\""}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ClearField", "[", 
      RowBox[{"f", "[", 
       RowBox[{"_", ",", "_"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"NewConstant", "[", 
      RowBox[{"f", "[", 
       RowBox[{"_", ",", "_"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndexRangeSF", "[", "f", "]"}], "=", " ", 
      RowBox[{"{", 
       RowBox[{"imin", ",", "Infinity"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{
        RowBox[{"i_", "/;", 
         RowBox[{"TrueQ", "[", 
          RowBox[{"!", 
           RowBox[{
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "i"}]}], "]"}]}],
         ",", "j_"}], "]"}], ":=", "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Index out of range \>\"", ",", 
          RowBox[{"IndexRangeSF", "[", "f", "]"}], ",", "\"\< : \>\"", ",", 
          " ", "f", ",", "\"\<[\>\"", ",", "i", ",", "\"\<,\>\"", ",", "j", 
          ",", "\"\<]\>\""}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"i_", ",", 
        RowBox[{"j_", "/;", 
         RowBox[{"TrueQ", "[", 
          RowBox[{"!", 
           RowBox[{
            RowBox[{
             RowBox[{"IndexRangeSF", "[", "\[Eta]", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[LessEqual]", "j"}]}], 
          "]"}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Index out of range \>\"", ",", 
          RowBox[{"IndexRangeSF", "[", "f", "]"}], ",", "\"\< : \>\"", ",", 
          " ", "f", ",", "\"\<[\>\"", ",", "i", ",", "\"\<,\>\"", ",", "j", 
          ",", "\"\<]\>\""}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"j_", ",", "i_"}], "]"}], "/;", 
       RowBox[{"!", 
        RowBox[{"OrderedQ", "[", 
         RowBox[{"{", 
          RowBox[{"j", ",", "i"}], "}"}], "]"}]}]}], ":=", 
      RowBox[{"f", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", 
        RowBox[{"i_", ",", "j_"}], "]"}], "/;", 
       RowBox[{"Distinct", "[", 
        RowBox[{"i", ",", "j"}], "]"}]}], ":=", "0"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"f", "/:", 
      SuperscriptBox[
       RowBox[{"f", "[", 
        RowBox[{"i_", ",", "i_"}], "]"}], "2"], ":=", "1"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"f", "/:", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"f", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], 
        RowBox[{"n_", "?", "EvenQ"}]], "/;", 
       RowBox[{"n", ">", "2"}]}], ":=", 
      SuperscriptBox[
       RowBox[{"f", "[", 
        RowBox[{"i", ",", "j"}], "]"}], "2"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"f", "/:", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"f", "[", 
         RowBox[{"i_", ",", "j_"}], "]"}], 
        RowBox[{"n_", "?", "OddQ"}]], "/;", 
       RowBox[{"n", ">", "1"}]}], ":=", 
      RowBox[{"f", "[", 
       RowBox[{"i", ",", "j"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True]
}, Closed]],

Cell[CellGroupData[{

Cell["metric[ ]  and  id[ ]   ---  unused code?", "Subsection",
 CellChangeTimes->{{3.518091661960149*^9, 3.518091672488291*^9}, {
  3.5180917676166697`*^9, 3.5180917798092747`*^9}, {3.6554438347261343`*^9, 
  3.6554438547579317`*^9}}],

Cell["I dont think these are being used anywhere ?", "Text",
 CellChangeTimes->{{3.6554435564414463`*^9, 3.6554435965689993`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"id", "[", 
   RowBox[{"frame_", ",", "coframe_"}], "]"}], ":=", " ", 
  RowBox[{"Total", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Apply", "[", 
       RowBox[{"CircleTimes", ",", "#"}], "]"}], "&"}], ",", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"frame", ",", "coframe"}], "}"}], "]"}]}], "]"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479209033740675*^9, 3.479209037841995*^9}, {
  3.479209084984129*^9, 3.479209176773838*^9}, {3.479209379157672*^9, 
  3.479209451133831*^9}, {3.479209489274946*^9, 3.479209495748542*^9}, {
  3.479210064743688*^9, 3.479210074990674*^9}, {3.479210260810113*^9, 
  3.479210263575085*^9}, {3.479210478633063*^9, 3.479210481764609*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"metric", "[", 
   RowBox[{"frame_", ",", "coframe_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Flatten", "[", 
    RowBox[{"Outer", "[", 
     RowBox[{"AngleBracket", ",", "frame", ",", "frame"}], "]"}], "]"}], ".", 
   
   RowBox[{"Flatten", "[", 
    RowBox[{"Outer", "[", 
     RowBox[{"CircleTimes", ",", "coframe", ",", "coframe"}], "]"}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.479302840197018*^9, 3.479302876581179*^9}, {
  3.479302972928975*^9, 3.479302994493443*^9}, {3.479303105542755*^9, 
  3.479303119217799*^9}, {3.479303275238621*^9, 3.479303282480752*^9}, {
  3.479303345076139*^9, 3.479303360800068*^9}, {3.479303782783478*^9, 
  3.479303861927053*^9}, {3.48039682636026*^9, 3.48039683229403*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Levi-Civita tensor   ---   loaded package", "Subsection",
 CellChangeTimes->{{3.518091796490238*^9, 3.518091806003541*^9}}],

Cell["\<\
16/05/2011:    This code is now in a separate package in file   \
LeviCivitaMTW.nb .
It is loaded for backward compatibility, but is not used anywhere else in the \
 tpTensor  package so could be removed.\
\>", "Text",
 CellChangeTimes->{{3.433630532387532*^9, 3.433630580939618*^9}, 
   3.480431268357999*^9, {3.514485797962422*^9, 3.514485812377816*^9}, {
   3.514485902665286*^9, 3.514485963160947*^9}, {3.514485997800981*^9, 
   3.514486051704812*^9}, {3.514486093160964*^9, 3.514486201241156*^9}, 
   3.514486242284731*^9, {3.518087838456841*^9, 3.518087920030426*^9}, {
   3.655443631368647*^9, 3.655443657240477*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Times[ ]  formatting  ---   skip, still not right.", "Subsection",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
   3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
   3.466847315774946*^9}, {3.467116374646419*^9, 3.46711642431634*^9}, {
   3.46711960696055*^9, 3.4671196238522*^9}, {3.467119927661101*^9, 
   3.467119972098659*^9}, {3.467128615645867*^9, 3.467128681455527*^9}, {
   3.477546970046781*^9, 3.477547002085627*^9}, {3.478628338661941*^9, 
   3.478628350627573*^9}, {3.478628853653529*^9, 3.478628908917177*^9}, {
   3.480844678276059*^9, 3.480844690587619*^9}, 3.480849382799643*^9, {
   3.484302955893784*^9, 3.484302984581565*^9}, {3.6152524715330353`*^9, 
   3.615252478220889*^9}, {3.655443778646801*^9, 3.655443787510663*^9}}],

Cell[TextData[{
 "This will make elementary tensors and tensor products print after their \
coefficients, instead of according to OrderedQ\nor whatever  ",
 StyleBox["Mathematica",
  FontSlant->"Italic"],
 "    by default uses.\nThe case  a \[Congruent] -1 is so as to print   - X\
\[CircleTimes]Y   rather than  -1 X\[CircleTimes]Y   (with no formatting we \
would have got  - (X\[CircleTimes]Y)).\nThe case  Head \[Congruent] Plus  is \
required else no parentheses \"(  )\" are printed :   (a + b) \
x\[CircleTimes]y   appears  as   \" a + b x\[CircleTimes]y \".  \n\nJust \
checks deg, rather than looks for \[CircleTimes],  so that it works for \
single tensors too.\n\nTensor expressions are usually expanded out so that \
the argument  av  will have only one strut.  However, if the user \nuses \
Simplify[ ],  then it is possible to get sums of tensors over a common \
divisor etc.  So if  Length[strut] \[NotEqual] 1, we \nprint the result of  \
StrutedTensor[ ]  instead... "
}], "Text",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQBmIQ/aR0dujXVy8dpxmcSwfRtWdE8kB0i5RRKYjedze/
EkTnC+ytAtGt+/kbQHSIqWIniH6nItoHoi9neawE85cbuH8H0sLWi6JB9KK8
xqofQLrnbGoTiC71/dkForXqHk8C0bEzkmaC6LrgU3NAtMMfpV8gmsP9KtNP
IG16oeaH1+uXjl3MBmzeQDolc1opiE58/a8eRNe4meXkAOlkTeFOED0hymoC
iN7cLjEZRIum2i4G0TWrN4HpI8Jq674AabUjemD6wIZFTmxvXjrGRK6NA9G/
dtqkgugjNZ7pIFqoipGRHUjfO9HEBKLVmW8siXv30pGt78ZKEL22PNxK//1L
x93LFziB6Inaj6JA9Db9C7Ug+mTx7UYQvSnpVhuIbu1+3QWiK47G94JoHTfv
T/8+vHRk2rUWTOu+mfwNRJ/qngmmQx7M+gWixTgXgWkA9fj9ug==
  "]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Times", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{"av_Times", "/;", 
    RowBox[{
     RowBox[{"deg", "[", "av", "]"}], ">", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"abox", ",", "vbox", ",", "strut", ",", "a", ",", "v"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"strut", " ", "=", " ", 
      RowBox[{"struts", "[", "av", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "strut", "]"}], "\[NotEqual]", "1"}], ",", 
       RowBox[{"DisplayForm", "[", 
        RowBox[{"ToBoxes", "[", 
         RowBox[{"StrutedTensor", "[", "av", "]"}], "]"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"v", "=", 
         RowBox[{"First", "[", 
          RowBox[{"struts", "[", "av", "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"vbox", " ", "=", 
         RowBox[{"ToBoxes", "[", "v", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"a", "=", 
         RowBox[{"Coefficient", "[", 
          RowBox[{"av", ",", "v"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"a", "===", 
           RowBox[{"-", "1"}]}], ",", 
          RowBox[{"abox", "=", 
           RowBox[{"ToBoxes", "[", "\"\<-\>\"", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Head", "[", "a", "]"}], "===", "Plus"}], ",", " ", 
            RowBox[{"abox", "=", 
             RowBox[{"RowBox", "[", 
              RowBox[{"{", 
               RowBox[{"\"\<(\>\"", ",", 
                RowBox[{"ToBoxes", "[", "a", "]"}], ",", "\"\<)\>\""}], "}"}],
               "]"}]}], ",", 
            RowBox[{"abox", "=", 
             RowBox[{"ToBoxes", "[", "a", "]"}]}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DisplayForm", "[", 
         RowBox[{"RowBox", "[", 
          RowBox[{"{", 
           RowBox[{"abox", ",", "vbox"}], "}"}], "]"}], "]"}]}]}], "]"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "Times", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.478804141298961*^9, 3.478804166125863*^9}, {
   3.478804707658638*^9, 3.478804719162156*^9}, {3.478872325119499*^9, 
   3.478872325946055*^9}, {3.478872734919294*^9, 3.478872800788968*^9}, {
   3.478872831388815*^9, 3.47887284759654*^9}, {3.478873346047873*^9, 
   3.478873349255668*^9}, {3.478873519206976*^9, 3.478873521183428*^9}, {
   3.479152118216623*^9, 3.479152220098464*^9}, {3.479152276761772*^9, 
   3.479152278947566*^9}, {3.479933171557344*^9, 3.47993322213502*^9}, {
   3.480094876667903*^9, 3.480094885002005*^9}, {3.48041515640244*^9, 
   3.480415203065637*^9}, {3.480417288159393*^9, 3.480417313164486*^9}, {
   3.480526925819966*^9, 3.480526998791815*^9}, {3.480527040546362*^9, 
   3.4805273736425*^9}, {3.480778794507745*^9, 3.480778826068821*^9}, {
   3.480778859389994*^9, 3.480778869994991*^9}, {3.480778989554909*^9, 
   3.480779071016938*^9}, {3.480779104475776*^9, 3.480779357929544*^9}, {
   3.48077957296102*^9, 3.480779594470737*^9}, {3.480779838580453*^9, 
   3.480779840547525*^9}, {3.480840994779613*^9, 3.480841062602887*^9}, 
   3.480841320881239*^9, {3.480843384943076*^9, 3.480843454664139*^9}, {
   3.480843509559497*^9, 3.480843515750882*^9}, {3.480843594566547*^9, 
   3.480843637392226*^9}, {3.480843886102737*^9, 3.480843890588299*^9}, {
   3.480843928445857*^9, 3.480843945989033*^9}, {3.480844001974562*^9, 
   3.480844071762699*^9}, {3.480844116191823*^9, 3.480844132022903*^9}, {
   3.48084426728548*^9, 3.480844267724334*^9}, {3.480844313388484*^9, 
   3.480844318420265*^9}, {3.480844396330335*^9, 3.48084450217526*^9}, {
   3.481794461091451*^9, 3.481794480079163*^9}, {3.481794513592614*^9, 
   3.481794513800715*^9}}],

Cell["\<\
The above is still not quite right ...   get    a+(2b+2c)   instead of   \
a+2b+2c    because the internal representation is still  a + 2 (b + c)   
even though we are printing it after  StrutedTensor...\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
  3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
  3.466847315774946*^9}, {3.467116374646419*^9, 3.46711642431634*^9}, {
  3.467119423750829*^9, 3.467119460749968*^9}, {3.467186837477058*^9, 
  3.467186891369089*^9}, {3.478623532051306*^9, 3.478623639615922*^9}, {
  3.480848423868747*^9, 3.480848475563328*^9}, {3.480848616163014*^9, 
  3.480848701145972*^9}, {3.480848765593963*^9, 3.480848782273723*^9}, {
  3.480848827353858*^9, 3.480848865075035*^9}, {3.480849006729182*^9, 
  3.480849006864884*^9}, {3.48179452701798*^9, 3.481794529524175*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"deg", "[", "a", "]"}], "=", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deg", "[", "b", "]"}], "=", "1"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deg", "[", "c", "]"}], "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"a", "+", 
  RowBox[{"2", 
   RowBox[{"(", 
    RowBox[{"b", "+", "c"}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"deg", "[", "a", "]"}], "=."}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deg", "[", "b", "]"}], "=."}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"deg", "[", "c", "]"}], "=."}], ";"}]}], "Input",
 CellChangeTimes->{{3.480848601369091*^9, 3.480848610191692*^9}, {
  3.480848982257561*^9, 3.480848999215013*^9}}],

Cell[BoxData[
 RowBox[{"a", "+", 
  RowBox[{"(", 
   TagBox[
    RowBox[{
     TagBox[
      RowBox[{"2", "b"}],
      DisplayForm], "+", 
     TagBox[
      RowBox[{"2", "c"}],
      DisplayForm]}],
    DisplayForm], ")"}]}]], "Output",
 CellChangeTimes->{3.518081130884119*^9, 3.613716837171411*^9, 
  3.6137185097487993`*^9, 3.613718692989923*^9}]
}, Open  ]],

Cell["\<\
This is a grotty fix...  
I tryed changing this from Expand to StrutedTensor,  but changed it back \
again after adding  deg[ ] checking error code to struts[ ] ...\
\>", "Text",
 CellChangeTimes->{{3.465382641638598*^9, 3.465382664870949*^9}, {
  3.466847176173019*^9, 3.46684721355625*^9}, {3.466847298083375*^9, 
  3.466847315774946*^9}, {3.467116374646419*^9, 3.46711642431634*^9}, {
  3.467119423750829*^9, 3.467119460749968*^9}, {3.467186837477058*^9, 
  3.467186891369089*^9}, {3.478623532051306*^9, 3.478623639615922*^9}, {
  3.480848423868747*^9, 3.480848475563328*^9}, {3.480848616163014*^9, 
  3.480848701145972*^9}, {3.480848765593963*^9, 3.480848782273723*^9}, {
  3.480848827353858*^9, 3.480848865075035*^9}, {3.480849006729182*^9, 
  3.480849023296787*^9}, {3.481890468130023*^9, 3.481890499825092*^9}, {
  3.481895979742376*^9, 3.481896064668307*^9}, {3.481896095699112*^9, 
  3.481896119430222*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"$Post", "=", "Expand"}], ";"}]], "Input",
 CellChangeTimes->{{3.480849028073405*^9, 3.480849036603131*^9}, {
  3.481890504668048*^9, 3.481890508747903*^9}, {3.481896080523761*^9, 
  3.481896082359215*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Times", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{
    RowBox[{"v1_", " ", "v2_"}], "/;", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"deg", "[", "v1", "]"}], ">", "0"}], "&&", " ", 
     RowBox[{
      RowBox[{"deg", "[", "v2", "]"}], ">", "0"}]}]}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{"DisplayForm", "[", 
    RowBox[{"RowBox", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\nSyntax error: Missing \[CircleTimes] in expression \>\"", ",", 
       RowBox[{"ToBoxes", "[", "v1", "]"}], ",", 
       RowBox[{"ToBoxes", "[", "v2", "]"}], ",", 
       "\"\< .  \nOrdinary multiplication can not be used here because   deg[\
\>\"", ",", 
       RowBox[{"ToBoxes", "[", "v1", "]"}], ",", "\"\<] = \>\"", ",", 
       RowBox[{"ToBoxes", "[", 
        RowBox[{"deg", "[", "v1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
       "\"\< and   deg[\>\"", ",", 
       RowBox[{"ToBoxes", "[", "v2", "]"}], ",", "\"\<] = \>\"", ",", 
       RowBox[{"ToBoxes", "[", 
        RowBox[{"deg", "[", "v2", "]"}], "]"}], ",", "\"\<.\>\""}], "}"}], 
     "]"}], "]"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "Times", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.478804141298961*^9, 3.478804166125863*^9}, {
   3.478804707658638*^9, 3.478804719162156*^9}, {3.478872325119499*^9, 
   3.478872325946055*^9}, {3.478872734919294*^9, 3.478872800788968*^9}, {
   3.478872831388815*^9, 3.47887284759654*^9}, {3.478873346047873*^9, 
   3.478873349255668*^9}, {3.478873519206976*^9, 3.478873521183428*^9}, {
   3.479152118216623*^9, 3.479152220098464*^9}, {3.479152276761772*^9, 
   3.479152278947566*^9}, {3.479933171557344*^9, 3.47993322213502*^9}, {
   3.480094876667903*^9, 3.480094885002005*^9}, {3.48041515640244*^9, 
   3.480415226181645*^9}, {3.480415353354032*^9, 3.480415449302386*^9}, {
   3.480415484751804*^9, 3.480415548210297*^9}, {3.480416350824422*^9, 
   3.480416408525408*^9}, {3.480416474014323*^9, 3.480416485773627*^9}, {
   3.480416607282998*^9, 3.480416620562135*^9}, {3.48041667085313*^9, 
   3.480416692308116*^9}, 3.480416731529421*^9, {3.480416779900129*^9, 
   3.48041680072663*^9}, 3.480417733497384*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["", "Subsection",
 CellChangeTimes->{{3.478784599907823*^9, 3.478784644560371*^9}, {
   3.47879586709443*^9, 3.478795867413355*^9}, {3.480396747732327*^9, 
   3.480396751587948*^9}, 3.655258475667034*^9}],

Cell[BoxData[{
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"TrueQ", "[", "$PrintDebugLocation", "]"}], ",", 
   RowBox[{"Print", "[", "\"\<End of Part2\>\"", "]"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"SaveInitTime", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.655258480662313*^9, 3.655258485506802*^9}, {
  3.655661504911071*^9, 3.655661508424266*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1664, 1138},
WindowMargins->{{Automatic, 282}, {Automatic, 94}},
Visible->True,
Magnification:>1.25 Inherited,
FrontEndVersion->"11.0 for Linux x86 (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Info3614427270-5255022"->{
  Cell[11896, 257, 2475, 33, 107671, "Print",
   CellTags->"Info3614427270-5255022"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Info3614427270-5255022", 518167, 14253}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 228, 3, 81, "Section"],
Cell[CellGroupData[{
Cell[833, 29, 1034, 14, 56, "Subsection"],
Cell[1870, 45, 2874, 43, 107671, "Text"],
Cell[4747, 90, 1390, 35, 107671, "Input"],
Cell[6140, 127, 2243, 32, 107671, "Text"],
Cell[8386, 161, 1115, 29, 107671, "Input"],
Cell[9504, 192, 249, 5, 107671, "Text"],
Cell[9756, 199, 1604, 41, 107671, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[11397, 245, 349, 4, 45, "Subsection"],
Cell[CellGroupData[{
Cell[11771, 253, 122, 2, 107671, "Input"],
Cell[11896, 257, 2475, 33, 107671, "Print",
 CellTags->"Info3614427270-5255022"]
}, Open  ]],
Cell[CellGroupData[{
Cell[14408, 295, 244, 4, 107671, "Subsubsection"],
Cell[14655, 301, 285, 4, 107671, "Text"],
Cell[14943, 307, 876, 24, 107671, "Input"],
Cell[CellGroupData[{
Cell[15844, 335, 432, 10, 107671, "Input"],
Cell[16279, 347, 762, 14, 107671, "Output"]
}, Open  ]],
Cell[17056, 364, 466, 8, 107671, "Text"],
Cell[17525, 374, 350, 7, 107671, "Input"],
Cell[17878, 383, 370, 7, 107671, "Text"],
Cell[18251, 392, 2360, 51, 107671, "Input"],
Cell[20614, 445, 274, 3, 107671, "Text"],
Cell[CellGroupData[{
Cell[20913, 452, 335, 9, 107671, "Input"],
Cell[21251, 463, 628, 13, 107671, "Print"],
Cell[21882, 478, 572, 9, 107671, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[22503, 493, 129, 2, 107671, "Subsubsection"],
Cell[22635, 497, 1272, 19, 107671, "Text"],
Cell[23910, 518, 1712, 45, 107671, "Input",
 InitializationCell->True],
Cell[25625, 565, 637, 9, 107671, "Text"],
Cell[26265, 576, 215, 5, 107671, "Input"],
Cell[26483, 583, 219, 5, 107671, "Input"],
Cell[26705, 590, 268, 6, 107671, "Input"],
Cell[26976, 598, 751, 10, 107671, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27764, 613, 170, 2, 107671, "Subsubsection"],
Cell[27937, 617, 699, 14, 107671, "Text"],
Cell[28639, 633, 1311, 30, 107671, "Input",
 InitializationCell->True],
Cell[29953, 665, 386, 7, 107671, "Text"],
Cell[CellGroupData[{
Cell[30364, 676, 337, 10, 107671, "Input"],
Cell[30704, 688, 70, 1, 107671, "Output"]
}, Open  ]],
Cell[30789, 692, 739, 13, 107671, "Text"],
Cell[31531, 707, 623, 8, 107671, "Text"],
Cell[32157, 717, 2546, 66, 107671, "Input",
 InitializationCell->True],
Cell[34706, 785, 667, 9, 107671, "Text"],
Cell[35376, 796, 319, 8, 107671, "Input",
 InitializationCell->True],
Cell[35698, 806, 584, 9, 107671, "Text"],
Cell[36285, 817, 300, 6, 107671, "Input",
 InitializationCell->True],
Cell[36588, 825, 1468, 30, 107671, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[38081, 859, 367, 9, 107671, "Input"],
Cell[38451, 870, 185, 2, 107671, "Print"],
Cell[38639, 874, 537, 8, 107671, "Output"]
}, Open  ]],
Cell[39191, 885, 350, 6, 107671, "Input",
 InitializationCell->True],
Cell[39544, 893, 1480, 30, 107671, "Input",
 InitializationCell->True],
Cell[41027, 925, 783, 12, 107671, "Text"],
Cell[41813, 939, 1505, 29, 107671, "Input",
 InitializationCell->True],
Cell[43321, 970, 542, 7, 107671, "Text"],
Cell[43866, 979, 1536, 30, 107671, "Input",
 InitializationCell->True],
Cell[45405, 1011, 1553, 32, 107671, "Input",
 InitializationCell->True],
Cell[46961, 1045, 1588, 31, 107671, "Input",
 InitializationCell->True],
Cell[48552, 1078, 675, 11, 107671, "Text"],
Cell[CellGroupData[{
Cell[49252, 1093, 348, 10, 107671, "Input"],
Cell[49603, 1105, 727, 19, 107671, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50367, 1129, 144, 3, 107671, "Input"],
Cell[50514, 1134, 359, 8, 107671, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[50910, 1147, 287, 8, 107671, "Input"],
Cell[51200, 1157, 1167, 36, 107671, "Output"]
}, Open  ]],
Cell[52382, 1196, 937, 15, 107671, "Text"],
Cell[53322, 1213, 651, 17, 107671, "Input",
 InitializationCell->True],
Cell[53976, 1232, 490, 14, 107671, "Input",
 InitializationCell->True],
Cell[54469, 1248, 361, 10, 107671, "Input",
 InitializationCell->True],
Cell[54833, 1260, 359, 10, 107671, "Input",
 InitializationCell->True],
Cell[55195, 1272, 366, 10, 107671, "Input",
 InitializationCell->True],
Cell[55564, 1284, 359, 10, 107671, "Input",
 InitializationCell->True],
Cell[55926, 1296, 705, 9, 107671, "Text"],
Cell[56634, 1307, 242, 6, 107671, "Input",
 InitializationCell->True],
Cell[56879, 1315, 246, 6, 107671, "Input",
 InitializationCell->True],
Cell[57128, 1323, 295, 7, 107671, "Input",
 InitializationCell->True],
Cell[57426, 1332, 335, 8, 107671, "Input",
 InitializationCell->True]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[57810, 1346, 907, 14, 46, "Subsection"],
Cell[58720, 1362, 372, 7, 72, "Text"],
Cell[59095, 1371, 789, 24, 221, "Input"],
Cell[59887, 1397, 358, 6, 72, "Text"],
Cell[60248, 1405, 973, 23, 320, "Input"],
Cell[61224, 1430, 330, 6, 72, "Text"],
Cell[CellGroupData[{
Cell[61579, 1440, 497, 12, 72, "Input"],
Cell[62079, 1454, 5046, 136, 237, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[67162, 1595, 458, 11, 72, "Input"],
Cell[67623, 1608, 4448, 118, 156, "Output"]
}, Open  ]],
Cell[72086, 1729, 215, 3, 72, "Text"],
Cell[CellGroupData[{
Cell[72326, 1736, 757, 21, 125, "Input"],
Cell[73086, 1759, 1912, 57, 87, "Output"],
Cell[75001, 1818, 1898, 55, 87, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[76936, 1878, 688, 20, 125, "Input"],
Cell[77627, 1900, 1968, 58, 87, "Output"],
Cell[79598, 1960, 1769, 53, 87, "Output"]
}, Open  ]],
Cell[81382, 2016, 1100, 19, 265, "Text"],
Cell[82485, 2037, 863, 23, 132, "Input"],
Cell[CellGroupData[{
Cell[83373, 2064, 509, 13, 72, "Input"],
Cell[83885, 2079, 2807, 72, 127, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[86729, 2156, 663, 17, 72, "Input"],
Cell[87395, 2175, 4703, 114, 176, "Output"]
}, Open  ]],
Cell[92113, 2292, 425, 7, 72, "Text"],
Cell[CellGroupData[{
Cell[92563, 2303, 853, 22, 72, "Input"],
Cell[93419, 2327, 2278, 60, 106, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[95734, 2392, 983, 25, 85, "Input"],
Cell[96720, 2419, 2252, 59, 106, "Output"]
}, Open  ]],
Cell[98987, 2481, 178, 2, 71, "Text"],
Cell[CellGroupData[{
Cell[99190, 2487, 153, 3, 72, "Input"],
Cell[99346, 2492, 4016, 95, 127, "Output"]
}, Open  ]],
Cell[103377, 2590, 711, 13, 171, "Text"],
Cell[CellGroupData[{
Cell[104113, 2607, 652, 18, 125, "Input"],
Cell[104768, 2627, 990, 28, 78, "Output"],
Cell[105761, 2657, 990, 28, 78, "Output"]
}, Open  ]],
Cell[106766, 2688, 484, 11, 221, "Input"],
Cell[107253, 2701, 371, 7, 121, "Text"],
Cell[107627, 2710, 2063, 48, 358, "Input",
 InitializationCell->True],
Cell[109693, 2760, 445, 11, 112, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[110175, 2776, 627, 8, 46, "Subsection"],
Cell[110805, 2786, 1214, 22, 288, "Text"],
Cell[112022, 2810, 571, 15, 131, "Input",
 InitializationCell->True],
Cell[112596, 2827, 342, 6, 58, "Text"],
Cell[112941, 2835, 290, 7, 90, "Input",
 InitializationCell->True],
Cell[113234, 2844, 835, 21, 90, "Input",
 InitializationCell->True],
Cell[114072, 2867, 737, 20, 90, "Input",
 InitializationCell->True],
Cell[114812, 2889, 512, 14, 90, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[115349, 2907, 202, 3, 58, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[115554, 2912, 764, 15, 55128, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[116321, 2929, 596, 18, 34652, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[116920, 2949, 1204, 39, 51590, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[118127, 2990, 187, 3, 28652, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[118317, 2995, 553, 16, 54202, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[118873, 3013, 339, 9, 54202, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[119215, 3024, 470, 14, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[119688, 3040, 375, 7, 29378, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[120066, 3049, 269, 5, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[120338, 3056, 575, 11, 20218, "Message",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[120916, 3069, 363, 10, 31300, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[121282, 3081, 360, 5, 29378, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[121645, 3088, 466, 10, 51027, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[122114, 3100, 522, 11, 31300, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[122639, 3113, 597, 14, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[123239, 3129, 346, 5, 28652, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[123588, 3136, 713, 18, 90960, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[124304, 3156, 349, 9, 31300, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[124656, 3167, 351, 9, 31300, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[125010, 3178, 442, 10, 31300, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[125455, 3190, 351, 9, 31300, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[125809, 3201, 330, 9, 34652, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[126142, 3212, 149, 2, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[126294, 3216, 363, 8, 34652, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[126660, 3226, 216, 4, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[126879, 3232, 452, 11, 58408, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[127334, 3245, 197, 3, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[127534, 3250, 197, 3, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]],
Cell[127746, 3256, 1233, 32, 275, "Input",
 InitializationCell->True],
Cell[128982, 3290, 1209, 31, 287, "Input",
 InitializationCell->True],
Cell[130194, 3323, 1255, 32, 287, "Input",
 InitializationCell->True],
Cell[131452, 3357, 929, 22, 170, "Input",
 InitializationCell->True],
Cell[132384, 3381, 6099, 134, 482, "Input",
 InitializationCell->True],
Cell[138486, 3517, 368, 10, 77, "Text"],
Cell[138857, 3529, 6291, 139, 602, "Input",
 InitializationCell->True],
Cell[145151, 3670, 236, 5, 72, "Text"],
Cell[145390, 3677, 9195, 192, 1383, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[154610, 3873, 192, 3, 72, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[154805, 3878, 200, 3, 29378, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[155008, 3883, 1544, 40, 232025, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[156555, 3925, 4960, 152, 132141, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[161518, 4079, 436, 9, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[161957, 4090, 6515, 193, 252637, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[168475, 4285, 338, 7, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]],
Cell[168828, 4295, 908, 14, 63, "Text"],
Cell[CellGroupData[{
Cell[169761, 4313, 752, 20, 126, "Input",
 InitializationCell->True],
Cell[170516, 4335, 60, 1, 70, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[170625, 4342, 55, 0, 45, "Subsection"],
Cell[CellGroupData[{
Cell[170705, 4346, 156, 2, 44, "Subsubsection"],
Cell[170864, 4350, 690, 9, 72, "Text"],
Cell[171557, 4361, 313, 6, 112, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[171895, 4371, 65, 1, 72, "Input"],
Cell[171963, 4374, 491, 8, 72, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[172491, 4387, 162, 4, 72, "Input"],
Cell[172656, 4393, 531, 10, 72, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[173236, 4409, 133, 2, 35, "Subsubsection"],
Cell[173372, 4413, 306, 8, 112, "Input",
 InitializationCell->True],
Cell[173681, 4423, 249, 7, 112, "Input",
 InitializationCell->True],
Cell[173933, 4432, 210, 6, 112, "Input",
 InitializationCell->True],
Cell[174146, 4440, 1071, 17, 171, "Text"],
Cell[175220, 4459, 339, 10, 112, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[175584, 4473, 864, 22, 270, "Input"],
Cell[176451, 4497, 456, 11, 72, "Output"],
Cell[176910, 4510, 354, 9, 72, "Output"],
Cell[177267, 4521, 548, 14, 72, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[177852, 4540, 193, 7, 72, "Input"],
Cell[178048, 4549, 634, 18, 72, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[178719, 4572, 352, 7, 72, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[179074, 4581, 332, 7, 29378, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[179409, 4590, 1058, 17, 69950, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[180470, 4609, 927, 25, 51027, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[181400, 4636, 653, 18, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[182056, 4656, 1381, 29, 51027, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[183440, 4687, 222, 3, 29378, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[183665, 4692, 228, 5, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[183942, 4703, 181, 2, 35, "Subsubsection"],
Cell[CellGroupData[{
Cell[184148, 4709, 751, 20, 112, "Input",
 InitializationCell->True],
Cell[184902, 4731, 60, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[184999, 4737, 633, 16, 221, "Input"],
Cell[185635, 4755, 950, 26, 72, "Output"],
Cell[186588, 4783, 333, 10, 72, "Output"],
Cell[186924, 4795, 92, 2, 72, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[187065, 4803, 185, 2, 35, "Subsubsection"],
Cell[187253, 4807, 1087, 16, 46, "Text"],
Cell[188343, 4825, 581, 11, 108, "Text"],
Cell[188927, 4838, 734, 15, 78, "Text"],
Cell[189664, 4855, 973, 15, 47, "Text"],
Cell[190640, 4872, 1697, 54, 311, "Input",
 InitializationCell->True],
Cell[192340, 4928, 86, 2, 41, "Text"],
Cell[192429, 4932, 478, 16, 81, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[192944, 4953, 464, 10, 38, "Subsubsection"],
Cell[193411, 4965, 1246, 24, 227, "Text"],
Cell[194660, 4991, 2373, 35, 72, "Text"],
Cell[CellGroupData[{
Cell[197058, 5030, 522, 14, 126, "Input",
 InitializationCell->True],
Cell[197583, 5046, 60, 1, 70, "Output"]
}, Open  ]],
Cell[197658, 5050, 296, 5, 72, "Text"],
Cell[197957, 5057, 853, 23, 81, "Text"],
Cell[198813, 5082, 401, 7, 72, "Text"],
Cell[199217, 5091, 158, 3, 72, "Text"],
Cell[199378, 5096, 213, 3, 72, "Text"],
Cell[CellGroupData[{
Cell[199616, 5103, 919, 24, 125, "Input",
 InitializationCell->True],
Cell[200538, 5129, 60, 1, 70, "Output"]
}, Open  ]],
Cell[200613, 5133, 129, 1, 72, "Text"],
Cell[CellGroupData[{
Cell[200767, 5138, 1118, 29, 125, "Input",
 InitializationCell->True],
Cell[201888, 5169, 60, 1, 70, "Output"]
}, Open  ]],
Cell[201963, 5173, 207, 3, 72, "Text"],
Cell[202173, 5178, 150, 3, 72, "Text"],
Cell[202326, 5183, 1472, 37, 81, "Text"],
Cell[203801, 5222, 405, 7, 72, "Text"],
Cell[204209, 5231, 158, 3, 72, "Text"],
Cell[CellGroupData[{
Cell[204392, 5238, 1463, 37, 125, "Input",
 InitializationCell->True],
Cell[205858, 5277, 60, 1, 70, "Output"]
}, Open  ]],
Cell[205933, 5281, 129, 1, 72, "Text"],
Cell[CellGroupData[{
Cell[206087, 5286, 1488, 38, 182, "Input",
 InitializationCell->True],
Cell[207578, 5326, 60, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[207675, 5332, 143, 2, 72, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[207821, 5336, 1054, 26, 51027, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[208878, 5364, 228, 5, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[209109, 5371, 654, 17, 34652, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[209766, 5390, 205, 4, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[209974, 5396, 204, 4, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[210181, 5402, 278, 6, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[210462, 5410, 1606, 43, 25040, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[212071, 5455, 1249, 35, 25040, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[213323, 5492, 550, 13, 22922, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[213876, 5507, 392, 12, 21171, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[214271, 5521, 1306, 37, 21171, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[215580, 5560, 1467, 46, 25040, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[217050, 5608, 667, 16, 21171, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[217720, 5626, 527, 16, 21171, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[218250, 5644, 606, 17, 34652, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[218859, 5663, 202, 4, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[219064, 5669, 1013, 28, 51027, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[220080, 5699, 628, 17, 34652, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[220711, 5718, 194, 3, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[220908, 5723, 228, 5, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[221139, 5730, 438, 10, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[221580, 5742, 204, 4, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[221787, 5748, 228, 5, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[222018, 5755, 1369, 36, 25040, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[223390, 5793, 938, 25, 25040, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[224331, 5820, 1323, 36, 25040, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[225657, 5858, 491, 14, 21171, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[226151, 5874, 536, 12, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[226690, 5888, 202, 4, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[226895, 5894, 238, 5, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[227136, 5901, 697, 17, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[227882, 5924, 309, 4, 35, "Subsubsection"],
Cell[228194, 5930, 114, 1, 90, "Text"],
Cell[CellGroupData[{
Cell[228333, 5935, 377, 11, 140, "Input",
 InitializationCell->True],
Cell[228713, 5948, 60, 1, 70, "Output"]
}, Open  ]],
Cell[228788, 5952, 568, 10, 90, "Text"],
Cell[CellGroupData[{
Cell[229381, 5966, 674, 16, 140, "Input",
 InitializationCell->True],
Cell[230058, 5984, 60, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[230155, 5990, 168, 3, 90, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[230326, 5995, 262, 6, 29378, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[230591, 6003, 149, 2, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[230743, 6007, 340, 6, 29378, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[231086, 6015, 438, 9, 51027, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[231527, 6026, 466, 12, 51027, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[231996, 6040, 357, 8, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[232356, 6050, 345, 8, 29378, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[232750, 6064, 42, 0, 35, "Subsubsection"],
Cell[232795, 6066, 1401, 39, 493, "Text"],
Cell[CellGroupData[{
Cell[234221, 6109, 560, 18, 90, "Input",
 InitializationCell->True],
Cell[234784, 6129, 60, 1, 70, "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[234905, 6137, 152, 5, 56, "Subsection"],
Cell[235060, 6144, 33, 0, 46, "Text"],
Cell[235096, 6146, 166, 5, 108, "Text"],
Cell[235265, 6153, 605, 14, 177, "Text"],
Cell[235873, 6169, 163, 5, 73, "Input",
 InitializationCell->True],
Cell[236039, 6176, 88, 2, 73, "Input",
 InitializationCell->True],
Cell[236130, 6180, 138, 3, 47, "Text"],
Cell[236271, 6185, 452, 12, 73, "Input",
 InitializationCell->True],
Cell[236726, 6199, 552, 16, 73, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[237303, 6219, 58, 1, 48, "Input"],
Cell[237364, 6222, 82, 2, 50, "Output"]
}, Open  ]],
Cell[237461, 6227, 36, 0, 47, "Text"],
Cell[CellGroupData[{
Cell[237522, 6231, 113, 3, 48, "Input"],
Cell[237638, 6236, 182, 7, 47, "Output"]
}, Open  ]],
Cell[237835, 6246, 36, 0, 47, "Text"],
Cell[CellGroupData[{
Cell[237896, 6250, 191, 4, 83, "Input"],
Cell[238090, 6256, 119, 3, 50, "Output"],
Cell[238212, 6261, 122, 4, 50, "Output"]
}, Open  ]],
Cell[238349, 6268, 392, 12, 73, "Input",
 InitializationCell->True],
Cell[238744, 6282, 369, 11, 73, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[239138, 6297, 69, 0, 55, "Subsubsection"],
Cell[CellGroupData[{
Cell[239232, 6301, 50, 0, 55, "Subsubsection"],
Cell[239285, 6303, 126, 3, 90, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[239448, 6311, 49, 0, 43, "Subsubsection"],
Cell[239500, 6313, 199, 6, 90, "Input",
 InitializationCell->True],
Cell[239702, 6321, 159, 5, 90, "Input",
 InitializationCell->True],
Cell[239864, 6328, 170, 5, 90, "Input",
 InitializationCell->True],
Cell[240037, 6335, 1071, 17, 137, "Text"],
Cell[241111, 6354, 356, 10, 90, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[241504, 6369, 70, 0, 43, "Subsubsection"],
Cell[CellGroupData[{
Cell[241599, 6373, 634, 18, 90, "Input",
 InitializationCell->True],
Cell[242236, 6393, 60, 1, 70, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[242345, 6400, 83, 1, 43, "Subsubsection"],
Cell[242431, 6403, 973, 15, 47, "Text"],
Cell[243407, 6420, 1709, 54, 311, "Input",
 InitializationCell->True],
Cell[245119, 6476, 86, 2, 41, "Text"],
Cell[245208, 6480, 481, 16, 81, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[245726, 6501, 263, 8, 58, "Subsubsection"],
Cell[CellGroupData[{
Cell[246014, 6513, 372, 11, 101, "Input",
 InitializationCell->True],
Cell[246389, 6526, 60, 1, 70, "Output"]
}, Open  ]],
Cell[246464, 6530, 213, 3, 58, "Text"],
Cell[CellGroupData[{
Cell[246702, 6537, 704, 21, 100, "Input",
 InitializationCell->True],
Cell[247409, 6560, 60, 1, 70, "Output"]
}, Open  ]],
Cell[247484, 6564, 129, 1, 58, "Text"],
Cell[CellGroupData[{
Cell[247638, 6569, 827, 24, 100, "Input",
 InitializationCell->True],
Cell[248468, 6595, 60, 1, 70, "Output"]
}, Open  ]],
Cell[248543, 6599, 207, 3, 58, "Text"],
Cell[248753, 6604, 158, 3, 58, "Text"],
Cell[CellGroupData[{
Cell[248936, 6611, 1000, 30, 100, "Input",
 InitializationCell->True],
Cell[249939, 6643, 60, 1, 70, "Output"]
}, Open  ]],
Cell[250014, 6647, 129, 1, 58, "Text"],
Cell[CellGroupData[{
Cell[250168, 6652, 1101, 32, 146, "Input",
 InitializationCell->True],
Cell[251272, 6686, 60, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[251369, 6692, 143, 2, 58, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[251515, 6696, 1054, 26, 100, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[252572, 6724, 228, 5, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[252803, 6731, 654, 17, 68, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[253460, 6750, 205, 4, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[253668, 6756, 204, 4, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[253875, 6762, 278, 6, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[254156, 6770, 1606, 43, 50, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[255765, 6815, 1249, 35, 50, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[257017, 6852, 550, 13, 46, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[257570, 6867, 392, 12, 43, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[257965, 6881, 1306, 37, 43, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[259274, 6920, 1467, 46, 50, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[260744, 6968, 667, 16, 43, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[261414, 6986, 527, 16, 43, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[261944, 7004, 606, 17, 68, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[262553, 7023, 202, 4, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[262758, 7029, 1013, 28, 100, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[263774, 7059, 628, 17, 68, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[264405, 7078, 194, 3, 58, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[264602, 7083, 228, 5, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[264833, 7090, 438, 10, 58, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[265274, 7102, 204, 4, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[265481, 7108, 228, 5, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[265712, 7115, 1369, 36, 50, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[267084, 7153, 938, 25, 50, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[268025, 7180, 1323, 36, 50, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[269351, 7218, 491, 14, 43, "Print",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[269845, 7234, 536, 12, 58, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[270384, 7248, 202, 4, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[270589, 7254, 238, 5, 58, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[270830, 7261, 697, 17, 58, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[271576, 7284, 56, 0, 43, "Subsubsection"],
Cell[271635, 7286, 45, 0, 58, "Text"],
Cell[CellGroupData[{
Cell[271705, 7290, 301, 9, 90, "Input",
 InitializationCell->True],
Cell[272009, 7301, 60, 1, 70, "Output"]
}, Open  ]],
Cell[272084, 7305, 568, 10, 58, "Text"],
Cell[CellGroupData[{
Cell[272677, 7319, 407, 12, 90, "Input",
 InitializationCell->True],
Cell[273087, 7333, 60, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[273184, 7339, 168, 3, 58, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[273355, 7344, 262, 6, 72, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[273620, 7352, 149, 2, 72, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[273772, 7356, 340, 6, 72, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[274115, 7364, 438, 9, 125, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[274556, 7375, 466, 12, 125, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[275025, 7389, 357, 8, 72, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[275385, 7399, 345, 8, 72, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[275779, 7413, 52, 0, 43, "Subsubsection"],
Cell[CellGroupData[{
Cell[275856, 7417, 576, 18, 90, "Input",
 InitializationCell->True],
Cell[276435, 7437, 60, 1, 70, "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]],
Cell[276534, 7443, 539, 11, 143, "Text"],
Cell[277076, 7456, 94, 2, 47, "Text"],
Cell[277173, 7460, 84, 2, 48, "Input"],
Cell[CellGroupData[{
Cell[277282, 7466, 690, 21, 73, "Input",
 InitializationCell->True,
 CellID->807694977],
Cell[277975, 7489, 60, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[278072, 7495, 66, 1, 48, "Input"],
Cell[278141, 7498, 14992, 420, 1418, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[293182, 7924, 594, 8, 45, "Subsection"],
Cell[293779, 7934, 141, 1, 28652, "Text"],
Cell[CellGroupData[{
Cell[293945, 7939, 619, 14, 51027, "Input"],
Cell[294567, 7955, 245, 6, 29378, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[294849, 7966, 197, 5, 29378, "Input"],
Cell[295049, 7973, 629, 14, 29378, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[295715, 7992, 253, 7, 29378, "Input"],
Cell[295971, 8001, 951, 23, 29378, "Output"]
}, Open  ]],
Cell[296937, 8027, 141, 1, 28652, "Text"],
Cell[297081, 8030, 116, 1, 29378, "Text"],
Cell[CellGroupData[{
Cell[297222, 8035, 560, 12, 51027, "Input"],
Cell[297785, 8049, 245, 6, 29378, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[298067, 8060, 303, 10, 29378, "Input"],
Cell[298373, 8072, 986, 27, 29378, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[299396, 8104, 415, 12, 29378, "Input"],
Cell[299814, 8118, 398, 11, 29378, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[300249, 8134, 267, 6, 29378, "Input"],
Cell[300519, 8142, 629, 17, 29378, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[301185, 8164, 263, 8, 31300, "Input"],
Cell[301451, 8174, 473, 13, 29378, "Output"]
}, Open  ]],
Cell[301939, 8190, 416, 12, 51027, "Text"],
Cell[CellGroupData[{
Cell[302380, 8206, 710, 23, 31300, "Input"],
Cell[303093, 8231, 223, 4, 29378, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[303365, 8241, 446, 6, 45, "Subsection"],
Cell[303814, 8249, 399, 9, 87, "Text"],
Cell[304216, 8260, 286, 7, 87, "Text"],
Cell[304505, 8269, 1058, 30, 150, "Input",
 InitializationCell->True],
Cell[305566, 8301, 605, 13, 159, "Text"],
Cell[306174, 8316, 2405, 58, 218, "Input"],
Cell[308582, 8376, 455, 8, 112, "Text"],
Cell[309040, 8386, 1406, 37, 222, "Input",
 InitializationCell->True],
Cell[310449, 8425, 129, 2, 48, "Input"],
Cell[CellGroupData[{
Cell[310603, 8431, 116, 3, 48, "Input"],
Cell[310722, 8436, 73, 1, 47, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[310832, 8442, 61, 1, 48, "Input"],
Cell[310896, 8445, 122, 3, 50, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[311055, 8453, 128, 2, 48, "Input"],
Cell[311186, 8457, 1222, 24, 227, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[312457, 8487, 611, 8, 87, "Subsection"],
Cell[313071, 8497, 277, 6, 10352, "Text"],
Cell[313351, 8505, 3625, 85, 49481, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[317001, 8594, 134, 2, 6163, "Input"],
Cell[317138, 8598, 488, 11, 4808, "Print"],
Cell[317629, 8611, 101, 1, 6163, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[317767, 8617, 265, 6, 10703, "Input"],
Cell[318035, 8625, 276, 5, 6565, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[318348, 8635, 157, 3, 6163, "Input"],
Cell[318508, 8640, 587, 17, 10352, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[319132, 8662, 223, 5, 6925, "Input"],
Cell[319358, 8669, 70, 1, 6163, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[319465, 8675, 373, 10, 6565, "Input"],
Cell[319841, 8687, 343, 9, 6565, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[320233, 8702, 787, 12, 70, "Subsection"],
Cell[321023, 8716, 160, 2, 72, "Text"],
Cell[321186, 8720, 988, 20, 171, "Text"],
Cell[322177, 8742, 443, 8, 112, "Input",
 InitializationCell->True],
Cell[322623, 8752, 476, 11, 163, "Input",
 InitializationCell->True],
Cell[323102, 8765, 1863, 47, 163, "Input",
 InitializationCell->True],
Cell[324968, 8814, 1247, 33, 163, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[326240, 8851, 188, 4, 72, "Input"],
Cell[326431, 8857, 725, 15, 82, "Output"]
}, Open  ]],
Cell[327171, 8875, 497, 12, 163, "Input",
 InitializationCell->True],
Cell[327671, 8889, 517, 12, 163, "Input",
 InitializationCell->True],
Cell[328191, 8903, 487, 11, 163, "Input",
 InitializationCell->True],
Cell[328681, 8916, 383, 9, 163, "Input",
 InitializationCell->True],
Cell[329067, 8927, 412, 13, 163, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[329504, 8944, 1267, 32, 127, "Input",
 InitializationCell->True],
Cell[330774, 8978, 60, 1, 70, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[330871, 8984, 1162, 35, 127, "Input",
 InitializationCell->True],
Cell[332036, 9021, 60, 1, 70, "Output"]
}, Open  ]],
Cell[332111, 9025, 4923, 127, 571, "Input",
 InitializationCell->True],
Cell[337037, 9154, 549, 15, 116, "Input",
 InitializationCell->True],
Cell[337589, 9171, 420, 13, 116, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[338034, 9188, 624, 17, 137, "Input"],
Cell[338661, 9207, 212, 5, 77, "Output"],
Cell[338876, 9214, 235, 6, 77, "Output"]
}, Open  ]],
Cell[339126, 9223, 1339, 37, 72, "Input"],
Cell[340468, 9262, 1438, 39, 72, "Input"],
Cell[CellGroupData[{
Cell[341931, 9305, 237, 5, 72, "Input"],
Cell[342171, 9312, 823, 24, 77, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[343031, 9341, 368, 11, 72, "Input"],
Cell[343402, 9354, 70, 1, 72, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[343509, 9360, 188, 4, 72, "Input"],
Cell[343700, 9366, 14565, 436, 446, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[358302, 9807, 325, 9, 81, "Input"],
Cell[358630, 9818, 15022, 441, 587, "Output"]
}, Open  ]],
Cell[373667, 10262, 121, 1, 71, "Text"],
Cell[373791, 10265, 433, 11, 112, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[374249, 10280, 260, 8, 81, "Input"],
Cell[374512, 10290, 14976, 440, 60363, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[389525, 10735, 385, 9, 12035, "Input"],
Cell[389913, 10746, 462, 14, 12821, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[390412, 10765, 142, 4, 12035, "Input"],
Cell[390557, 10771, 253, 7, 12821, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[390847, 10783, 581, 17, 13525, "Input"],
Cell[391431, 10802, 12024, 350, 52627, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[403504, 11158, 597, 8, 70, "Subsection"],
Cell[404104, 11168, 412, 8, 171, "Text"],
Cell[404519, 11178, 199, 6, 215, "Text"],
Cell[404721, 11186, 92, 2, 72, "Text"],
Cell[CellGroupData[{
Cell[404838, 11192, 474, 13, 212, "Input",
 InitializationCell->True],
Cell[405315, 11207, 146, 4, 70, "Output"]
}, Open  ]],
Cell[405476, 11214, 112, 1, 72, "Text"],
Cell[405591, 11217, 650, 20, 260, "Input",
 InitializationCell->True],
Cell[406244, 11239, 183, 5, 112, "Input",
 InitializationCell->True],
Cell[406430, 11246, 164, 3, 72, "Text"],
Cell[406597, 11251, 583, 19, 212, "Input",
 InitializationCell->True],
Cell[407183, 11272, 728, 21, 212, "Input",
 InitializationCell->True],
Cell[407914, 11295, 35810, 917, 5663, "Input",
 InitializationCell->True],
Cell[443727, 12214, 407, 8, 120, "Text"],
Cell[CellGroupData[{
Cell[444159, 12226, 388, 9, 81, "Input"],
Cell[444550, 12237, 420, 11, 93, "Output"]
}, Open  ]],
Cell[444985, 12251, 211, 3, 72, "Text"],
Cell[445199, 12256, 671, 18, 81, "Input"],
Cell[445873, 12276, 379, 7, 120, "Text"],
Cell[CellGroupData[{
Cell[446277, 12287, 162, 3, 72, "Input"],
Cell[446442, 12292, 438, 10, 82, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[446917, 12307, 419, 9, 125, "Input"],
Cell[447339, 12318, 626, 15, 82, "Output"],
Cell[447968, 12335, 539, 12, 82, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[448544, 12352, 122, 2, 72, "Input"],
Cell[448669, 12356, 80, 1, 72, "Output"]
}, Open  ]],
Cell[448764, 12360, 1521, 43, 260, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[450310, 12407, 488, 10, 125, "Input"],
Cell[450801, 12419, 1355, 27, 283, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[452193, 12451, 315, 8, 72, "Input"],
Cell[452511, 12461, 1371, 27, 283, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[453919, 12493, 167, 3, 72, "Text",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[454089, 12498, 440, 12, 20902, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[454532, 12512, 510, 13, 13525, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[455045, 12527, 337, 8, 13525, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[455385, 12537, 438, 12, 13525, "Input",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}],
Cell[455826, 12551, 343, 8, 13525, "Output",
 CellGroupingRules->{GroupTogetherGrouping, 10000.}]
}, Closed]],
Cell[456184, 12562, 318, 6, 112, "Text"],
Cell[456505, 12570, 653, 16, 212, "Input",
 InitializationCell->True],
Cell[457161, 12588, 317, 6, 121, "Text"],
Cell[457481, 12596, 17356, 467, 2815, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[474874, 13068, 126, 3, 70, "Subsection"],
Cell[475003, 13073, 2305, 68, 1926, "Text"],
Cell[477311, 13143, 223, 7, 140, "Input"],
Cell[477537, 13152, 559, 18, 218, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[478121, 13174, 94, 2, 140, "Input"],
Cell[478218, 13178, 161, 4, 140, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[478416, 13187, 94, 2, 140, "Input"],
Cell[478513, 13191, 161, 4, 140, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[478711, 13200, 81, 2, 140, "Input"],
Cell[478795, 13204, 32, 0, 140, "Output"]
}, Open  ]],
Cell[478842, 13207, 217, 6, 316, "Input",
 InitializationCell->True],
Cell[479062, 13215, 8845, 226, 3187, "Input",
 InitializationCell->True],
Cell[487910, 13443, 3974, 108, 1660, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[491909, 13555, 65, 1, 140, "Text"],
Cell[CellGroupData[{
Cell[491999, 13560, 276, 8, 2246, "Input"],
Cell[492278, 13570, 256, 5, 932, "Print"],
Cell[492537, 13577, 35, 0, 1293, "Output"]
}, Open  ]],
Cell[492587, 13580, 346, 10, 3103, "Input"],
Cell[CellGroupData[{
Cell[492958, 13594, 311, 10, 1293, "Input"],
Cell[493272, 13606, 681, 20, 4015, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[493990, 13631, 513, 13, 5956, "Input"],
Cell[494506, 13646, 83, 2, 1293, "Output"],
Cell[494592, 13650, 83, 2, 1293, "Output"],
Cell[494678, 13654, 28, 0, 1293, "Output"],
Cell[494709, 13656, 83, 2, 1293, "Output"],
Cell[494795, 13660, 108, 3, 1378, "Output"]
}, Open  ]],
Cell[494918, 13666, 31, 0, 1293, "Text"],
Cell[CellGroupData[{
Cell[494974, 13670, 82, 2, 1293, "Input"],
Cell[495059, 13674, 517, 11, 932, "Print"],
Cell[495579, 13687, 35, 0, 1293, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[495651, 13692, 82, 2, 1293, "Input"],
Cell[495736, 13696, 530, 11, 932, "Print"],
Cell[496269, 13709, 35, 0, 1293, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[496341, 13714, 101, 3, 1293, "Input"],
Cell[496445, 13719, 550, 12, 932, "Print"],
Cell[496998, 13733, 35, 0, 1293, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[497070, 13738, 130, 4, 1293, "Input"],
Cell[497203, 13744, 620, 14, 932, "Print"],
Cell[497826, 13760, 35, 0, 1293, "Output"]
}, Open  ]]
}, Closed]],
Cell[497888, 13764, 464, 11, 402, "Text"],
Cell[498355, 13777, 4220, 111, 1721, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[502612, 13893, 235, 3, 70, "Subsection"],
Cell[502850, 13898, 130, 1, 140, "Text"],
Cell[502983, 13901, 792, 19, 218, "Input",
 InitializationCell->True],
Cell[503778, 13922, 781, 18, 218, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[504596, 13945, 129, 1, 70, "Subsection"],
Cell[504728, 13948, 634, 11, 235, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[505399, 13964, 791, 10, 70, "Subsection"],
Cell[506193, 13976, 1520, 26, 207450, "Text"],
Cell[507716, 14004, 4006, 84, 232025, "Input"],
Cell[511725, 14090, 866, 13, 49358, "Text"],
Cell[CellGroupData[{
Cell[512616, 14107, 747, 24, 151731, "Input"],
Cell[513366, 14133, 350, 13, 29378, "Output"]
}, Open  ]],
Cell[513731, 14149, 926, 15, 49358, "Text"],
Cell[514660, 14166, 240, 5, 29378, "Input"],
Cell[514903, 14173, 2246, 45, 132141, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[517186, 14223, 209, 3, 45, "Subsection"],
Cell[517398, 14228, 389, 9, 87, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}
]
*)

